import{S as B,i as F,s as O,b as I,c as d,j as U,d as q,k as V,t as G,f as p,E as X,F as J,C as M,q as K,r as Q,e as k,m as $,a as C,o as H,y as W,p as L,z as w,x as v,A as E,n as T,v as D,D as R,h as N,u as Z,l as x}from"./index.1ca4c1c7.js";import{A as ee}from"./AdventureLogo.a315a9d5.js";import{S as te}from"./Spinner.80176497.js";function P(r,e,l){const n=r.slice();return n[13]=e[l],n}function ne(r){let e,l,n,a,i,o;function u(t){r[8](t)}let f={};r[1].adventures.name!==void 0&&(f.name=r[1].adventures.name),l=new ee({props:f}),K.push(()=>Q(l,"name",u));function s(t,_){if(t[1].status==="EXPIRED")return ie;if(t[1].status==="PAID")return re;if(t[1].status==="ACTIVE")return se}let m=s(r),c=m&&m(r);return{c(){e=k("h1"),$(l.$$.fragment),a=C(),c&&c.c(),i=I()},m(t,_){d(t,e,_),H(l,e,null),d(t,a,_),c&&c.m(t,_),d(t,i,_),o=!0},p(t,_){const h={};!n&&_&2&&(n=!0,h.name=t[1].adventures.name,W(()=>n=!1)),l.$set(h),m===(m=s(t))&&c?c.p(t,_):(c&&c.d(1),c=m&&m(t),c&&(c.c(),c.m(i.parentNode,i)))},i(t){o||(G(l.$$.fragment,t),o=!0)},o(t){q(l.$$.fragment,t),o=!1},d(t){t&&p(e),L(l),t&&p(a),c&&c.d(t),t&&p(i)}}}function le(r){let e,l,n,a;return{c(){e=k("h1"),e.textContent="Error finding game",l=C(),n=k("p"),a=w(r[4])},m(i,o){d(i,e,o),d(i,l,o),d(i,n,o),v(n,a)},p(i,o){o&16&&E(a,i[4])},i:T,o:T,d(i){i&&p(e),i&&p(l),i&&p(n)}}}function oe(r){let e,l;return e=new te({}),{c(){$(e.$$.fragment)},m(n,a){H(e,n,a),l=!0},p:T,i(n){l||(G(e.$$.fragment,n),l=!0)},o(n){q(e.$$.fragment,n),l=!1},d(n){L(e,n)}}}function se(r){let e,l,n,a,i;return{c(){e=k("p"),e.textContent="This adventure is already in progress!",l=C(),n=k("button"),n.textContent="Go to the current puzzle",D(n,"class","svelte-11i0xjd")},m(o,u){d(o,e,u),d(o,l,u),d(o,n,u),a||(i=R(n,"click",r[10]),a=!0)},p:T,d(o){o&&p(e),o&&p(l),o&&p(n),a=!1,i()}}}function re(r){let e,l,n,a=r[0].code+"",i,o,u,f,s,m,c;return{c(){e=k("p"),e.textContent=`You've not yet started your adventure! Remember, it's dangerous to go alone.
            Take this if you want to recruit others to help you:`,l=C(),n=k("code"),i=w(a),o=C(),u=k("p"),u.textContent="Once you're ready, press below to go to the first puzzle in the adventure!",f=C(),s=k("button"),s.textContent="Begin the adventure!",D(n,"class","svelte-11i0xjd"),D(s,"class","svelte-11i0xjd")},m(t,_){d(t,e,_),d(t,l,_),d(t,n,_),v(n,i),d(t,o,_),d(t,u,_),d(t,f,_),d(t,s,_),m||(c=R(s,"click",r[9]),m=!0)},p(t,_){_&1&&a!==(a=t[0].code+"")&&E(i,a)},d(t){t&&p(e),t&&p(l),t&&p(n),t&&p(o),t&&p(u),t&&p(f),t&&p(s),m=!1,c()}}}function ie(r){let e,l,n,a,i=r[7](r[1].startTime,r[1].endTime)+"",o,u,f,s,m,c={ctx:r,current:null,token:null,hasCatch:!1,pending:fe,then:ue,catch:ae,value:12};return N(m=r[3],c),{c(){e=k("p"),e.textContent="Congratulations! You finished the adventure!",l=C(),n=k("p"),a=w("You took "),o=w(i),u=w("!"),f=C(),s=I(),c.block.c()},m(t,_){d(t,e,_),d(t,l,_),d(t,n,_),v(n,a),v(n,o),v(n,u),d(t,f,_),d(t,s,_),c.block.m(t,c.anchor=_),c.mount=()=>s.parentNode,c.anchor=s},p(t,_){r=t,_&2&&i!==(i=r[7](r[1].startTime,r[1].endTime)+"")&&E(o,i),c.ctx=r,_&8&&m!==(m=r[3])&&N(m,c)||Z(c,r,_)},d(t){t&&p(e),t&&p(l),t&&p(n),t&&p(f),t&&p(s),c.block.d(t),c.token=null,c=null}}}function ae(r){return{c:T,m:T,p:T,d:T}}function ue(r){let e,l,n,a,i=r[12],o=[];for(let u=0;u<i.length;u+=1)o[u]=Y(P(r,i,u));return{c(){e=k("table"),l=k("thead"),l.innerHTML=`<tr><th>Puzzle</th> 
                    <th>Time</th> 
                    <th>Hints</th></tr>`,n=C(),a=k("tbody");for(let u=0;u<o.length;u+=1)o[u].c();D(e,"class","stats")},m(u,f){d(u,e,f),v(e,l),v(e,n),v(e,a);for(let s=0;s<o.length;s+=1)o[s].m(a,null)},p(u,f){if(f&8){i=u[12];let s;for(s=0;s<i.length;s+=1){const m=P(u,i,s);o[s]?o[s].p(m,f):(o[s]=Y(m),o[s].c(),o[s].m(a,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=i.length}},d(u){u&&p(e),x(o,u)}}}function Y(r){let e,l,n=r[13].title+"",a,i,o,u=r[13].time+"",f,s,m,c=r[13].hints+"",t,_;return{c(){e=k("tr"),l=k("td"),a=w(n),i=C(),o=k("td"),f=w(u),s=C(),m=k("td"),t=w(c),_=C(),D(o,"class","time")},m(h,b){d(h,e,b),v(e,l),v(l,a),v(e,i),v(e,o),v(o,f),v(e,s),v(e,m),v(m,t),v(e,_)},p(h,b){b&8&&n!==(n=h[13].title+"")&&E(a,n),b&8&&u!==(u=h[13].time+"")&&E(f,u),b&8&&c!==(c=h[13].hints+"")&&E(t,c)},d(h){h&&p(e)}}}function fe(r){return{c:T,m:T,p:T,d:T}}function ce(r){let e,l,n,a;const i=[oe,le,ne],o=[];function u(f,s){return f[2]?0:f[4]||!f[1]?1:2}return e=u(r),l=o[e]=i[e](r),{c(){l.c(),n=I()},m(f,s){o[e].m(f,s),d(f,n,s),a=!0},p(f,[s]){let m=e;e=u(f),e===m?o[e].p(f,s):(U(),q(o[m],1,1,()=>{o[m]=null}),V(),l=o[e],l?l.p(f,s):(l=o[e]=i[e](f),l.c()),G(l,1),l.m(n.parentNode,n))},i(f){a||(G(l),a=!0)},o(f){q(l),a=!1},d(f){o[e].d(f),f&&p(n)}}}function _e(r,e,l){let{params:n={}}=e,a={},i=!0,o,u,f;X(async function(){var g;try{f=await J(n.code)}catch(y){l(4,u=y.message||y),l(2,i=!1);return}let{data:b,error:j}=await f.from("games").select("status, puzzle, startTime, endTime, adventures ( name, description)").eq("code",n.code);(g=b[0])!=null&&g.adventures?(l(1,a=b[0]),l(3,o=f.rpc("getstats",{gamecode:n.code}).then(({data:y,error:z})=>z?[]:y).then(y=>{let z=a.startTime;return y.forEach(A=>{A.time=c(z,A.solvetime),z=A.solvetime}),y}))):j="Unable to find game",j&&l(4,u=j),l(2,i=!1)});const s=async function(){let{data:b}=await f.rpc("startadventure");b&&await M("/game/"+n.code+"/"+b)},m=async function(){await M("/game/"+n.code+"/"+a.puzzle)},c=function(b,j){const g=(new Date(j).getTime()-new Date(b).getTime())/1e3,y=(z,A)=>{const S=Math.floor(z);return S===1?`${S} ${A}`:S>1?`${S} ${A}s`:""};return[y(g%60,"second"),y(g/60%60,"minute"),y(g/3600%24,"hour"),y(g/86400,"day")].filter(z=>z!=="").reverse().join(", ")};function t(b){r.$$.not_equal(a.adventures.name,b)&&(a.adventures.name=b,l(1,a))}const _=()=>s(),h=()=>m();return r.$$set=b=>{"params"in b&&l(0,n=b.params)},[n,a,i,o,u,s,m,c,t,_,h]}class be extends B{constructor(e){super(),F(this,e,_e,ce,O,{params:0})}}export{be as default};
