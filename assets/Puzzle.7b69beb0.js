import{S as le,i as ie,s as oe,b as X,c as h,n as H,f as b,H as Ne,e as C,w,J as Q,q as Te,x as y,k as L,a as G,y as S,m as U,K as Me,L as De,t as N,d as T,l as W,A as F,M as me,B as te,I as ne,C as V,h as Ae,u as He,N as Oe,o as Se,p as Ie,j as de,O as Ee,P as ee,Q as Be,R as Le,r as ae,v as _e,T as ge,D as Ue,z as he,U as We}from"./index.cdc379a1.js";import{R as qe}from"./RandomText.417e9fac.js";import{S as Pe}from"./Spinner.d3f544dd.js";import{E as Ye}from"./Error.cbd5a083.js";function be(l,e,n){const t=l.slice();return t[18]=e[n],t}function ze(l){let e,n={length:l[6]},t=[];for(let i=0;i<n.length;i+=1)t[i]=ke(be(l,n,i));return{c(){e=C("div");for(let i=0;i<t.length;i+=1)t[i].c();w(e,"class","confetti-holder svelte-io58ff"),Q(e,"rounded",l[9]),Q(e,"cone",l[10]),Q(e,"no-gravity",l[11])},m(i,s){h(i,e,s);for(let o=0;o<t.length;o+=1)t[o].m(e,null)},p(i,s){if(s&20991){n={length:i[6]};let o;for(o=0;o<n.length;o+=1){const a=be(i,n,o);t[o]?t[o].p(a,s):(t[o]=ke(a),t[o].c(),t[o].m(e,null))}for(;o<t.length;o+=1)t[o].d(1);t.length=n.length}s&512&&Q(e,"rounded",i[9]),s&1024&&Q(e,"cone",i[10]),s&2048&&Q(e,"no-gravity",i[11])},d(i){i&&b(e),Te(t,i)}}}function ke(l){let e;return{c(){e=C("div"),w(e,"class","confetti svelte-io58ff"),y(e,"--fall-distance",l[8]),y(e,"--size",l[0]+"px"),y(e,"--color",l[14]()),y(e,"--skew",R(-45,45)+"deg,"+R(-45,45)+"deg"),y(e,"--rotation-xyz",R(-10,10)+", "+R(-10,10)+", "+R(-10,10)),y(e,"--rotation-deg",R(0,360)+"deg"),y(e,"--translate-y-multiplier",R(l[2][0],l[2][1])),y(e,"--translate-x-multiplier",R(l[1][0],l[1][1])),y(e,"--scale",.1*R(2,10)),y(e,"--transition-duration",l[4]?`calc(${l[3]}ms * var(--scale))`:`${l[3]}ms`),y(e,"--transition-delay",R(l[5][0],l[5][1])+"ms"),y(e,"--transition-iteration-count",l[4]?"infinite":l[7]),y(e,"--x-spread",1-l[12])},m(n,t){h(n,e,t)},p(n,t){t&256&&y(e,"--fall-distance",n[8]),t&1&&y(e,"--size",n[0]+"px"),t&4&&y(e,"--translate-y-multiplier",R(n[2][0],n[2][1])),t&2&&y(e,"--translate-x-multiplier",R(n[1][0],n[1][1])),t&24&&y(e,"--transition-duration",n[4]?`calc(${n[3]}ms * var(--scale))`:`${n[3]}ms`),t&32&&y(e,"--transition-delay",R(n[5][0],n[5][1])+"ms"),t&144&&y(e,"--transition-iteration-count",n[4]?"infinite":n[7]),t&4096&&y(e,"--x-spread",1-n[12])},d(n){n&&b(e)}}}function je(l){let e,n=!l[13]&&ze(l);return{c(){n&&n.c(),e=X()},m(t,i){n&&n.m(t,i),h(t,e,i)},p(t,[i]){t[13]?n&&(n.d(1),n=null):n?n.p(t,i):(n=ze(t),n.c(),n.m(e.parentNode,e))},i:H,o:H,d(t){n&&n.d(t),t&&b(e)}}}function R(l,e){return Math.random()*(e-l)+l}function Qe(l,e,n){let{size:t=10}=e,{x:i=[-.5,.5]}=e,{y:s=[.25,1]}=e,{duration:o=2e3}=e,{infinite:a=!1}=e,{delay:f=[0,50]}=e,{colorRange:d=[0,360]}=e,{colorArray:r=[]}=e,{amount:m=50}=e,{iterationCount:_=1}=e,{fallDistance:p="100px"}=e,{rounded:v=!1}=e,{cone:z=!1}=e,{noGravity:I=!1}=e,{xSpread:M=.15}=e,{destroyOnComplete:O=!0}=e,P=!1;Ne(()=>{!O||a||_=="infinite"||setTimeout(()=>n(13,P=!0),(o+f[1])*_)});function Y(){return r.length?r[Math.round(Math.random()*(r.length-1))]:`hsl(${Math.round(R(d[0],d[1]))}, 75%, 50%`}return l.$$set=c=>{"size"in c&&n(0,t=c.size),"x"in c&&n(1,i=c.x),"y"in c&&n(2,s=c.y),"duration"in c&&n(3,o=c.duration),"infinite"in c&&n(4,a=c.infinite),"delay"in c&&n(5,f=c.delay),"colorRange"in c&&n(15,d=c.colorRange),"colorArray"in c&&n(16,r=c.colorArray),"amount"in c&&n(6,m=c.amount),"iterationCount"in c&&n(7,_=c.iterationCount),"fallDistance"in c&&n(8,p=c.fallDistance),"rounded"in c&&n(9,v=c.rounded),"cone"in c&&n(10,z=c.cone),"noGravity"in c&&n(11,I=c.noGravity),"xSpread"in c&&n(12,M=c.xSpread),"destroyOnComplete"in c&&n(17,O=c.destroyOnComplete)},[t,i,s,o,a,f,m,_,p,v,z,I,M,P,Y,d,r,O]}class Fe extends le{constructor(e){super(),ie(this,e,Qe,je,oe,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function pe(l,e,n){const t=l.slice();return t[7]=e[n],t}function Je(l){let e=l[7].message+"",n;return{c(){n=F(e)},m(t,i){h(t,n,i)},p(t,i){i&1&&e!==(e=t[7].message+"")&&te(n,e)},d(t){t&&b(n)}}}function Ke(l){let e;return{c(){e=F(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                    labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                    laboris nisi ut aliquip ex ea commodo consequat.`)},m(n,t){h(n,e,t)},p:H,d(n){n&&b(e)}}}function ve(l){let e,n,t;function i(){return l[6](l[7])}return{c(){e=C("button"),e.textContent="Reveal this hint",w(e,"class","svelte-6e5e0o")},m(s,o){h(s,e,o),n||(t=V(e,"click",i),n=!0)},p(s,o){l=s},d(s){s&&b(e),n=!1,t()}}}function Ce(l,e){let n,t=e[7].title+"",i,s,o,a,f,d,r;function m(z,I){return z[7].locked?Ke:Je}let _=m(e),p=_(e),v=e[7].locked&&ve(e);return{key:l,first:null,c(){n=C("h4"),i=F(t),s=G(),o=C("div"),a=C("p"),p.c(),d=G(),v&&v.c(),r=G(),w(n,"class","svelte-6e5e0o"),w(a,"class",f=me(e[7].locked?"locked":"")+" svelte-6e5e0o"),w(o,"class","svelte-6e5e0o"),this.first=n},m(z,I){h(z,n,I),S(n,i),h(z,s,I),h(z,o,I),S(o,a),p.m(a,null),S(o,d),v&&v.m(o,null),S(o,r)},p(z,I){e=z,I&1&&t!==(t=e[7].title+"")&&te(i,t),_===(_=m(e))&&p?p.p(e,I):(p.d(1),p=_(e),p&&(p.c(),p.m(a,null))),I&1&&f!==(f=me(e[7].locked?"locked":"")+" svelte-6e5e0o")&&w(a,"class",f),e[7].locked?v?v.p(e,I):(v=ve(e),v.c(),v.m(o,r)):v&&(v.d(1),v=null)},d(z){z&&b(n),z&&b(s),z&&b(o),p.d(),v&&v.d()}}}function Ve(l){let e,n,t,i,s=[],o=new Map,a;t=new qe({props:{options:l[2]}});let f=l[0];const d=r=>r[7].id;for(let r=0;r<f.length;r+=1){let m=pe(l,f,r),_=d(m);o.set(_,s[r]=Ce(_,m))}return{c(){e=C("section"),n=C("p"),L(t.$$.fragment),i=G();for(let r=0;r<s.length;r+=1)s[r].c();w(e,"class","svelte-6e5e0o")},m(r,m){h(r,e,m),S(e,n),U(t,n,null),S(e,i);for(let _=0;_<s.length;_+=1)s[_].m(e,null);a=!0},p(r,[m]){m&3&&(f=r[0],s=Me(s,m,d,1,r,f,o,e,De,Ce,null,pe))},i(r){a||(N(t.$$.fragment,r),a=!0)},o(r){T(t.$$.fragment,r),a=!1},d(r){r&&b(e),W(t);for(let m=0;m<s.length;m+=1)s[m].d()}}}function Xe(l,e,n){let{gameCode:t=""}=e,{puzzleId:i=0}=e;const s=async()=>{const r=await ne(t),{data:m,error:_}=await r.rpc("gethints",{puzzleid:i,gamecode:t});if(_)throw _;n(0,a=m)},o=async function(r){await(await ne(t)).rpc("requesthint",{puzzleid:i,gamecode:t,hintid:r})};let a=[];const f=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],d=r=>o(r.id);return l.$$set=r=>{"gameCode"in r&&n(3,t=r.gameCode),"puzzleId"in r&&n(4,i=r.puzzleId)},l.$$.update=()=>{l.$$.dirty&24&&t&&i&&s()},[a,o,f,t,i,s,d]}class Ze extends le{constructor(e){super(),ie(this,e,Xe,Ve,oe,{gameCode:3,puzzleId:4,refresh:5})}get refresh(){return this.$$.ctx[5]}}function xe(l){let e,n;return e=new Ye({props:{error:l[4]}}),{c(){L(e.$$.fragment)},m(t,i){U(e,t,i),n=!0},p:H,i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){T(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function $e(l){let e,n=l[0]+"",t;return{c(){e=new Oe(!1),t=X(),e.a=t},m(i,s){e.m(n,i,s),h(i,t,s)},p:H,i:H,o:H,d(i){i&&b(t),i&&e.d()}}}function et(l){let e,n;return e=new Pe({}),{c(){L(e.$$.fragment)},m(t,i){U(e,t,i),n=!0},p:H,i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){T(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function tt(l){let e,n,t={ctx:l,current:null,token:null,hasCatch:!0,pending:et,then:$e,catch:xe,value:0,error:4,blocks:[,,,]};return Ae(l[0],t),{c(){e=X(),t.block.c()},m(i,s){h(i,e,s),t.block.m(i,t.anchor=s),t.mount=()=>e.parentNode,t.anchor=e,n=!0},p(i,[s]){l=i,He(t,l,s)},i(i){n||(N(t.block),n=!0)},o(i){for(let s=0;s<3;s+=1){const o=t.blocks[s];T(o)}n=!1},d(i){i&&b(e),t.block.d(i),t.token=null,t=null}}}const ye=/\$[^$]+?\$/g;function nt(l,e,n){let{gameCode:t=""}=e,{storageSlug:i=""}=e,{content:s=""}=e,o=Promise.all([ne(t),i,s]).then(([a,f,d])=>{const r=d.match(ye)||[];return Promise.all([d,...r.map(m=>m.substring(1,m.length-1)).map(m=>a.storage.from("puzzles").createSignedUrl(`${f}/${m}`,60*60).then(({data:{signedUrl:_},error:p})=>{if(p)throw p;return _}))])}).then(([a,...f])=>a.replace(ye,()=>f.shift()));return l.$$set=a=>{"gameCode"in a&&n(1,t=a.gameCode),"storageSlug"in a&&n(2,i=a.storageSlug),"content"in a&&n(3,s=a.content)},[o,t,i,s]}class lt extends le{constructor(e){super(),ie(this,e,nt,tt,oe,{gameCode:1,storageSlug:2,content:3})}}function it(l){let e,n=l[1].adventure.name+"",t,i,s=l[1].title+"",o,a,f,d,r,m,_,p,v,z,I,M,O,P,Y,c,J,D,j,B,Z,K,g,A,se,fe;f=new lt({props:{gameCode:l[0].code,storageSlug:l[1].storage_slug,content:l[1].content}});function Re(u){l[13](u)}function Ge(u){l[14](u)}let re={};l[0].code!==void 0&&(re.gameCode=l[0].code),l[0].puzzle!==void 0&&(re.puzzleId=l[0].puzzle),P=new Ze({props:re}),ae.push(()=>_e(P,"gameCode",Re)),ae.push(()=>_e(P,"puzzleId",Ge)),l[15](P),B=new qe({props:{options:l[10]}});function ce(u,k){return u[1].next?rt:st}let x=ce(l),E=x(l),q=l[3]&&we();return{c(){e=C("h2"),t=F(n),i=F(": "),o=F(s),a=G(),L(f.$$.fragment),d=G(),r=C("section"),m=C("form"),_=C("fieldset"),p=C("legend"),p.textContent="Enter a guess",v=G(),z=C("input"),I=G(),M=C("input"),O=G(),L(P.$$.fragment),J=G(),D=C("dialog"),j=C("h3"),L(B.$$.fragment),Z=G(),E.c(),K=G(),q&&q.c(),g=X(),w(z,"type","text"),z.disabled=l[4],w(z,"class","svelte-vm928o"),w(M,"type","submit"),M.value="Submit",M.disabled=l[4],w(_,"class","svelte-vm928o"),w(r,"class","answer svelte-vm928o"),w(j,"class","svelte-vm928o"),D.open=l[3],w(D,"class","svelte-vm928o")},m(u,k){h(u,e,k),S(e,t),S(e,i),S(e,o),h(u,a,k),U(f,u,k),h(u,d,k),h(u,r,k),S(r,m),S(m,_),S(_,p),S(_,v),S(_,z),ge(z,l[2]),S(_,I),S(_,M),h(u,O,k),U(P,u,k),h(u,J,k),h(u,D,k),S(D,j),U(B,j,null),S(D,Z),E.m(D,null),h(u,K,k),q&&q.m(u,k),h(u,g,k),A=!0,se||(fe=[V(z,"input",l[11]),V(m,"submit",Ue(l[12]))],se=!0)},p(u,k){(!A||k&2)&&n!==(n=u[1].adventure.name+"")&&te(t,n),(!A||k&2)&&s!==(s=u[1].title+"")&&te(o,s);const $={};k&1&&($.gameCode=u[0].code),k&2&&($.storageSlug=u[1].storage_slug),k&2&&($.content=u[1].content),f.$set($),(!A||k&16)&&(z.disabled=u[4]),k&4&&z.value!==u[2]&&ge(z,u[2]),(!A||k&16)&&(M.disabled=u[4]);const ue={};!Y&&k&1&&(Y=!0,ue.gameCode=u[0].code,he(()=>Y=!1)),!c&&k&1&&(c=!0,ue.puzzleId=u[0].puzzle,he(()=>c=!1)),P.$set(ue),x===(x=ce(u))&&E?E.p(u,k):(E.d(1),E=x(u),E&&(E.c(),E.m(D,null))),(!A||k&8)&&(D.open=u[3]),u[3]?q?k&8&&N(q,1):(q=we(),q.c(),N(q,1),q.m(g.parentNode,g)):q&&(Se(),T(q,1,1,()=>{q=null}),Ie())},i(u){A||(N(f.$$.fragment,u),N(P.$$.fragment,u),N(B.$$.fragment,u),N(q),A=!0)},o(u){T(f.$$.fragment,u),T(P.$$.fragment,u),T(B.$$.fragment,u),T(q),A=!1},d(u){u&&b(e),u&&b(a),W(f,u),u&&b(d),u&&b(r),u&&b(O),l[15](null),W(P,u),u&&b(J),u&&b(D),W(B),E.d(),u&&b(K),q&&q.d(u),u&&b(g),se=!1,We(fe)}}}function ot(l){let e,n;return e=new Pe({}),{c(){L(e.$$.fragment)},m(t,i){U(e,t,i),n=!0},p:H,i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){T(e.$$.fragment,t),n=!1},d(t){W(e,t)}}}function st(l){let e,n,t,i,s;return{c(){e=C("p"),e.textContent="You have completed the adventure!",n=G(),t=C("button"),t.textContent="Continue \xBB",w(e,"class","svelte-vm928o"),w(t,"class","svelte-vm928o")},m(o,a){h(o,e,a),h(o,n,a),h(o,t,a),i||(s=V(t,"click",l[17]),i=!0)},p:H,d(o){o&&b(e),o&&b(n),o&&b(t),i=!1,s()}}}function rt(l){let e,n,t,i,s;return{c(){e=C("p"),e.textContent="You have completed this step in the adventure!",n=G(),t=C("button"),t.textContent="Next puzzle \xBB",w(e,"class","svelte-vm928o"),w(t,"class","svelte-vm928o")},m(o,a){h(o,e,a),h(o,n,a),h(o,t,a),i||(s=V(t,"click",l[16]),i=!0)},p:H,d(o){o&&b(e),o&&b(n),o&&b(t),i=!1,s()}}}function we(l){let e,n,t;return n=new Fe({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=C("div"),L(n.$$.fragment),w(e,"class","confetti-bg svelte-vm928o")},m(i,s){h(i,e,s),U(n,e,null),t=!0},i(i){t||(N(n.$$.fragment,i),t=!0)},o(i){T(n.$$.fragment,i),t=!1},d(i){i&&b(e),W(n)}}}function ut(l){let e,n,t,i;const s=[ot,it],o=[];function a(f,d){return f[5]?0:1}return e=a(l),n=o[e]=s[e](l),{c(){n.c(),t=X()},m(f,d){o[e].m(f,d),h(f,t,d),i=!0},p(f,[d]){let r=e;e=a(f),e===r?o[e].p(f,d):(Se(),T(o[r],1,1,()=>{o[r]=null}),Ie(),n=o[e],n?n.p(f,d):(n=o[e]=s[e](f),n.c()),N(n,1),n.m(t.parentNode,t))},i(f){i||(N(n),i=!0)},o(f){T(n),i=!1},d(f){o[e].d(f),f&&b(t)}}}function at(l,e,n){let{params:t={}}=e,i={},s="",o=!1,a=!1,f=!0,d=null,r=null,m;de.set("Puzzad: Loading...");const _=()=>{try{p(),ne(t.code).then(g=>(r=g,g.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",t.puzzle))).then(v).then(g=>n(1,i=g)).then(()=>{de.set("Puzzad: "+i.adventure.name+": "+i.title),z(),n(5,f=!1)}).catch(()=>ee("/game/"+t.code))}catch{ee("/game/"+t.code)}},p=()=>{console.log("Resetting..."),n(5,f=!0),n(3,o=!1),n(2,s=""),n(4,a=!1)},v=({data:g,error:A})=>{if(A)throw A;if(g.length===0)throw"Puzzle not found";return g[0]};Ee(function(){d&&d.disconnect()});const z=async function(){d||(d=await Be(t.code),await d.channel("public:guesses:game=eq."+t.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+t.code},I).subscribe())},I=function(g){g.record.puzzle.toString()===t.puzzle&&(g.record.content==="*hint"?m.refresh():g.record.correct?n(3,o=!0):Le.add({title:"Incorrect guess",description:g.record.content,duration:1e4,type:"error"}))},M=async function(){n(4,a=!0),await r.from("guesses").insert({content:s,puzzle:t.puzzle,game:t.code}),n(4,a=!1),n(2,s="")},O=async function(){await ee("/game/"+t.code+"/"+i.next)},P=async function(){await ee("/game/"+t.code)},Y=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function c(){s=this.value,n(2,s)}const J=()=>M();function D(g){l.$$.not_equal(t.code,g)&&(t.code=g,n(0,t))}function j(g){l.$$.not_equal(t.puzzle,g)&&(t.puzzle=g,n(0,t))}function B(g){ae[g?"unshift":"push"](()=>{m=g,n(6,m)})}const Z=()=>O(),K=()=>P();return l.$$set=g=>{"params"in g&&n(0,t=g.params)},l.$$.update=()=>{l.$$.dirty&1&&t.code&&t.puzzle&&_()},[t,i,s,o,a,f,m,M,O,P,Y,c,J,D,j,B,Z,K]}class _t extends le{constructor(e){super(),ie(this,e,at,ut,oe,{params:0})}}export{_t as default};
