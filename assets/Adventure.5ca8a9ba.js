import{S as C,i as A,s as U,z as w,e as v,a as f,A as S,b as $,t as q,d as p,f as b,B as H,h as d,x as h,v as L,w as k,n as u,j as y,q as M,r as g,l as N,m as T,p as j,C as z}from"./index.b3f45f55.js";import{S as B}from"./Spinner.a83b4eec.js";function I(r){let e,a=r[7].message+"",t;return{c(){e=d("p"),t=h(a),L(e,"color","red")},m(l,n){f(l,e,n),k(e,t)},p:u,i:u,o:u,d(l){l&&p(e)}}}function P(r){let e,a,t,l,n,i=r[3].description+"",m,s,o={ctx:r,current:null,token:null,hasCatch:!1,pending:G,then:D,catch:Y,value:6};return w(r[0],o),{c(){e=d("h2"),a=d("img"),l=y(),n=d("section"),m=y(),s=v(),o.block.c(),M(a.src,t=r[2])||g(a,"src",t),g(a,"alt",r[3].name)},m(c,_){f(c,e,_),k(e,a),f(c,l,_),f(c,n,_),n.innerHTML=i,f(c,m,_),f(c,s,_),o.block.m(c,o.anchor=_),o.mount=()=>s.parentNode,o.anchor=s},p(c,_){r=c,S(o,r,_)},i:u,o:u,d(c){c&&p(e),c&&p(l),c&&p(n),c&&p(m),c&&p(s),o.block.d(c),o.token=null,o=null}}}function Y(r){return{c:u,m:u,p:u,d:u}}function D(r){let e;function a(n,i){return n[6]?F:E}let l=a(r)(r);return{c(){l.c(),e=v()},m(n,i){l.m(n,i),f(n,e,i)},p(n,i){l.p(n,i)},d(n){l.d(n),n&&p(e)}}}function E(r){let e;return{c(){e=d("p"),e.innerHTML='You must <a href="/#/login">login</a> before you can start an adventure.'},m(a,t){f(a,e,t)},p:u,d(a){a&&p(e)}}}function F(r){let e,a,t=r[3].price===0?"free":"\xA3"+r[3].price,l,n,i;function m(){return r[5](r[3])}return{c(){e=d("button"),a=h("Start this adventure for "),l=h(t)},m(s,o){f(s,e,o),k(e,a),k(e,l),n||(i=z(e,"click",m),n=!0)},p(s,o){r=s},d(s){s&&p(e),n=!1,i()}}}function G(r){return{c:u,m:u,p:u,d:u}}function J(r){let e,a;return e=new B({}),{c(){N(e.$$.fragment)},m(t,l){T(e,t,l),a=!0},p:u,i(t){a||($(e.$$.fragment,t),a=!0)},o(t){q(e.$$.fragment,t),a=!1},d(t){j(e,t)}}}function K(r){let e,a,t={ctx:r,current:null,token:null,hasCatch:!0,pending:J,then:P,catch:I,value:3,error:7,blocks:[,,,]};return w(r[3],t),{c(){e=v(),t.block.c()},m(l,n){f(l,e,n),t.block.m(l,t.anchor=n),t.mount=()=>e.parentNode,t.anchor=e,a=!0},p(l,[n]){r=l,S(t,r,n)},i(l){a||($(t.block),a=!0)},o(l){for(let n=0;n<3;n+=1){const i=t.blocks[n];q(i)}a=!1},d(l){l&&p(e),t.block.d(l),t.token=null,t=null}}}function O(r,e,a){let{params:t={}}=e,l=b.from("adventures").select("id,name,description,price").eq("name",t.name).then(({data:o,error:c})=>{if(c)throw c;return o[0]}),n=b.auth.getSession().then(({data:{session:o}})=>!!(o!=null&&o.user));const i=async o=>{if(o.price===0){let{data:c,error:_}=await b.rpc("addfreeadventure",{adventureid:o.id});c&&await H("/game/"+c)}};let m=t.name&&b.storage.from("adventures").getPublicUrl(t.name+"/logo.png").data.publicUrl;const s=o=>i(o);return r.$$set=o=>{"params"in o&&a(4,t=o.params)},[n,i,m,l,t,s]}class V extends C{constructor(e){super(),A(this,e,O,K,U,{params:4})}}export{V as default};
