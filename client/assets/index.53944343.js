import{S as j,i as X,s as Z,o as G,d as p,q as F,v as M,u as J,t as N,g as d,h as I,x as K,a3 as Q,a4 as W,e as b,M as L,a as y,N as O,a5 as x,O as R,U as w,f as k,V as P,n as z,b as q,l as V,Z as U,$ as ee,w as te}from"./index.b92c290c.js";import{A as ne}from"./AdventureLogo.91b8d310.js";import{g as le}from"./db.737282b8.js";import{S as oe}from"./Spinner.14b883af.js";import{t as Y}from"./title.a27f956a.js";import{g as se,p as re}from"./index.404ba498.js";function B(r,e,n){const l=r.slice();return l[15]=e[n],l}function ie(r){let e,n,l,c,i,t;function f(o){r[9](o)}let a={};r[0].adventures.name!==void 0&&(a.name=r[0].adventures.name),n=new ne({props:a}),Q.push(()=>W(n,"name",f));function u(o,_){if(o[0].status==="EXPIRED")return me;if(o[0].status==="PAID")return ce;if(o[0].status==="ACTIVE")return fe}let m=u(r),s=m&&m(r);return{c(){e=b("h1"),L(n.$$.fragment),c=y(),s&&s.c(),i=G()},m(o,_){p(o,e,_),O(n,e,null),p(o,c,_),s&&s.m(o,_),p(o,i,_),t=!0},p(o,_){const h={};!l&&_&1&&(l=!0,h.name=o[0].adventures.name,x(()=>l=!1)),n.$set(h),m===(m=u(o))&&s?s.p(o,_):(s&&s.d(1),s=m&&m(o),s&&(s.c(),s.m(i.parentNode,i)))},i(o){t||(N(n.$$.fragment,o),t=!0)},o(o){M(n.$$.fragment,o),t=!1},d(o){o&&d(e),R(n),o&&d(c),s&&s.d(o),o&&d(i)}}}function ue(r){let e,n,l,c;return{c(){e=b("h1"),e.textContent="Error finding game",n=y(),l=b("p"),c=w(r[3])},m(i,t){p(i,e,t),p(i,n,t),p(i,l,t),k(l,c)},p(i,t){t&8&&P(c,i[3])},i:z,o:z,d(i){i&&d(e),i&&d(n),i&&d(l)}}}function ae(r){let e,n;return e=new oe({}),{c(){L(e.$$.fragment)},m(l,c){O(e,l,c),n=!0},p:z,i(l){n||(N(e.$$.fragment,l),n=!0)},o(l){M(e.$$.fragment,l),n=!1},d(l){R(e,l)}}}function fe(r){let e,n,l,c,i;return{c(){e=b("p"),e.textContent="This adventure is already in progress!",n=y(),l=b("button"),l.textContent="Go to the current puzzle",q(l,"class","svelte-dm8wmn")},m(t,f){p(t,e,f),p(t,n,f),p(t,l,f),c||(i=V(l,"click",r[11]),c=!0)},p:z,d(t){t&&d(e),t&&d(n),t&&d(l),c=!1,i()}}}function ce(r){let e,n,l,c,i,t,f,a,u,m;return{c(){e=b("p"),e.textContent=`You've not yet started your adventure! Remember, it's dangerous to go alone.
            Take this if you want to recruit others to help you:`,n=y(),l=b("code"),c=w(r[4]),i=y(),t=b("p"),t.textContent="Once you're ready, press below to go to the first puzzle in the adventure!",f=y(),a=b("button"),a.textContent="Begin the adventure!",q(l,"class","svelte-dm8wmn"),q(a,"class","svelte-dm8wmn")},m(s,o){p(s,e,o),p(s,n,o),p(s,l,o),k(l,c),p(s,i,o),p(s,t,o),p(s,f,o),p(s,a,o),u||(m=V(a,"click",r[10]),u=!0)},p(s,o){o&16&&P(c,s[4])},d(s){s&&d(e),s&&d(n),s&&d(l),s&&d(i),s&&d(t),s&&d(f),s&&d(a),u=!1,m()}}}function me(r){let e,n,l,c,i=r[7](r[0].startTime,r[0].endTime)+"",t,f,a,u,m,s={ctx:r,current:null,token:null,hasCatch:!1,pending:de,then:pe,catch:_e,value:14};return U(m=r[2],s),{c(){e=b("p"),e.textContent="Congratulations! You finished the adventure!",n=y(),l=b("p"),c=w("You took "),t=w(i),f=w("!"),a=y(),u=G(),s.block.c()},m(o,_){p(o,e,_),p(o,n,_),p(o,l,_),k(l,c),k(l,t),k(l,f),p(o,a,_),p(o,u,_),s.block.m(o,s.anchor=_),s.mount=()=>u.parentNode,s.anchor=u},p(o,_){r=o,_&1&&i!==(i=r[7](r[0].startTime,r[0].endTime)+"")&&P(t,i),s.ctx=r,_&4&&m!==(m=r[2])&&U(m,s)||ee(s,r,_)},d(o){o&&d(e),o&&d(n),o&&d(l),o&&d(a),o&&d(u),s.block.d(o),s.token=null,s=null}}}function _e(r){return{c:z,m:z,p:z,d:z}}function pe(r){let e,n,l,c,i=r[14],t=[];for(let f=0;f<i.length;f+=1)t[f]=H(B(r,i,f));return{c(){e=b("table"),n=b("thead"),n.innerHTML=`<tr><th>Puzzle</th> 
                    <th>Time</th> 
                    <th>Hints</th></tr>`,l=y(),c=b("tbody");for(let f=0;f<t.length;f+=1)t[f].c();q(e,"class","stats")},m(f,a){p(f,e,a),k(e,n),k(e,l),k(e,c);for(let u=0;u<t.length;u+=1)t[u].m(c,null)},p(f,a){if(a&4){i=f[14];let u;for(u=0;u<i.length;u+=1){const m=B(f,i,u);t[u]?t[u].p(m,a):(t[u]=H(m),t[u].c(),t[u].m(c,null))}for(;u<t.length;u+=1)t[u].d(1);t.length=i.length}},d(f){f&&d(e),te(t,f)}}}function H(r){let e,n,l=r[15].title+"",c,i,t,f=r[15].time+"",a,u,m,s=r[15].hints+"",o,_;return{c(){e=b("tr"),n=b("td"),c=w(l),i=y(),t=b("td"),a=w(f),u=y(),m=b("td"),o=w(s),_=y(),q(t,"class","time")},m(h,C){p(h,e,C),k(e,n),k(n,c),k(e,i),k(e,t),k(t,a),k(e,u),k(e,m),k(m,o),k(e,_)},p(h,C){C&4&&l!==(l=h[15].title+"")&&P(c,l),C&4&&f!==(f=h[15].time+"")&&P(a,f),C&4&&s!==(s=h[15].hints+"")&&P(o,s)},d(h){h&&d(e)}}}function de(r){return{c:z,m:z,p:z,d:z}}function be(r){let e,n,l,c;const i=[ae,ue,ie],t=[];function f(a,u){return a[1]?0:a[3]||!a[0]?1:2}return e=f(r),n=t[e]=i[e](r),{c(){n.c(),l=G()},m(a,u){t[e].m(a,u),p(a,l,u),c=!0},p(a,[u]){let m=e;e=f(a),e===m?t[e].p(a,u):(F(),M(t[m],1,1,()=>{t[m]=null}),J(),n=t[e],n?n.p(a,u):(n=t[e]=i[e](a),n.c()),N(n,1),n.m(l.parentNode,l))},i(a){c||(N(n),c=!0)},o(a){M(n),c=!1},d(a){t[e].d(a),a&&d(l)}}}function ke(r,e,n){let l,c,i;I(r,se,v=>n(13,c=v)),I(r,re,v=>n(8,i=v));let t={},f=!0,a,u,m;K(async function(){var A,E;try{m=await le(l)}catch(g){n(3,u=g.message||g),n(1,f=!1);return}let{data:v,error:S}=await m.from("games").select("status, puzzle, startTime, endTime, adventures ( name, description)").eq("code",l);(A=v[0])!=null&&A.adventures?(n(0,t=v[0]),n(2,a=m.rpc("getstats",{gamecode:l}).then(({data:g,error:D})=>D?[]:g).then(g=>{let D=t.startTime;return g.forEach(T=>{T.time=_(D,T.solvetime),D=T.solvetime}),g})),Y.set("Puzzad: "+((E=v[0])==null?void 0:E.adventures.name)+" - "+l)):(Y.set("Puzzad: Game not found"),S="Unable to find game"),S&&n(3,u=S),n(1,f=!1)});const s=async function(){let{data:v}=await m.rpc("startadventure");console.log(v),v&&c("/games/[code]/[puzzle]",{code:l,puzzle:v})},o=async function(){c("/games/[code]/[puzzle]",{code:l,puzzle:t.puzzle})},_=function(v,S){const A=(new Date(S).getTime()-new Date(v).getTime())/1e3,E=(g,D)=>{const T=Math.floor(g);return T===1?`${T} ${D}`:T>1?`${T} ${D}s`:""};return[E(A%60,"second"),E(A/60%60,"minute"),E(A/3600%24,"hour"),E(A/86400,"day")].filter(g=>g!=="").reverse().join(", ")};function h(v){r.$$.not_equal(t.adventures.name,v)&&(t.adventures.name=v,n(0,t))}const C=()=>s(),$=()=>o();return r.$$.update=()=>{r.$$.dirty&256&&n(4,l=i.code)},[t,f,a,u,l,s,o,_,i,h,C,$]}class we extends j{constructor(e){super(),X(this,e,ke,be,Z,{})}}export{we as default};
