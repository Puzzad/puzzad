import{S as H,i as R,s as L,e as P,a as p,g as O,t as q,c as V,b as G,d,o as X,D as F,f as J,B as U,h as b,j as T,q as I,r as z,w as k,n as v,x as g,y as A,l as K,m as Q,p as W,C as B,z as M,A as Z,k as $}from"./index.64bd5727.js";import{S as x}from"./Spinner.0a3723a3.js";function N(r,e,l){const t=r.slice();return t[13]=e[l],t}function ee(r){let e,l,t,u,f,n;function i(a,_){if(a[1].status==="EXPIRED")return oe;if(a[1].status==="PAID")return se;if(a[1].status==="ACTIVE")return ne}let o=i(r),s=o&&o(r);return{c(){e=b("h1"),l=b("img"),f=T(),s&&s.c(),n=P(),I(l.src,t=r[2])||z(l,"src",t),z(l,"alt",u=r[1].adventures.name)},m(a,_){p(a,e,_),k(e,l),p(a,f,_),s&&s.m(a,_),p(a,n,_)},p(a,_){_&4&&!I(l.src,t=a[2])&&z(l,"src",t),_&2&&u!==(u=a[1].adventures.name)&&z(l,"alt",u),o===(o=i(a))&&s?s.p(a,_):(s&&s.d(1),s=o&&o(a),s&&(s.c(),s.m(n.parentNode,n)))},i:v,o:v,d(a){a&&d(e),a&&d(f),s&&s.d(a),a&&d(n)}}}function te(r){let e,l,t,u;return{c(){e=b("h1"),e.textContent="Error finding game",l=T(),t=b("p"),u=g(r[5])},m(f,n){p(f,e,n),p(f,l,n),p(f,t,n),k(t,u)},p(f,n){n&32&&A(u,f[5])},i:v,o:v,d(f){f&&d(e),f&&d(l),f&&d(t)}}}function le(r){let e,l;return e=new x({}),{c(){K(e.$$.fragment)},m(t,u){Q(e,t,u),l=!0},p:v,i(t){l||(G(e.$$.fragment,t),l=!0)},o(t){q(e.$$.fragment,t),l=!1},d(t){W(e,t)}}}function ne(r){let e,l,t,u,f;return{c(){e=b("p"),e.textContent="This adventure is already in progress!",l=T(),t=b("button"),t.textContent="Go to the current puzzle",z(t,"class","svelte-11i0xjd")},m(n,i){p(n,e,i),p(n,l,i),p(n,t,i),u||(f=B(t,"click",r[10]),u=!0)},p:v,d(n){n&&d(e),n&&d(l),n&&d(t),u=!1,f()}}}function se(r){let e,l,t,u=r[0].code+"",f,n,i,o,s,a,_;return{c(){e=b("p"),e.textContent=`You've not yet started your adventure! Remember, it's dangerous to go alone.
            Take this if you want to recruit others to help you:`,l=T(),t=b("code"),f=g(u),n=T(),i=b("p"),i.textContent="Once you're ready, press below to go to the first puzzle in the adventure!",o=T(),s=b("button"),s.textContent="Begin the adventure!",z(t,"class","svelte-11i0xjd"),z(s,"class","svelte-11i0xjd")},m(c,m){p(c,e,m),p(c,l,m),p(c,t,m),k(t,f),p(c,n,m),p(c,i,m),p(c,o,m),p(c,s,m),a||(_=B(s,"click",r[9]),a=!0)},p(c,m){m&1&&u!==(u=c[0].code+"")&&A(f,u)},d(c){c&&d(e),c&&d(l),c&&d(t),c&&d(n),c&&d(i),c&&d(o),c&&d(s),a=!1,_()}}}function oe(r){let e,l,t,u,f=r[8](r[1].startTime,r[1].endTime)+"",n,i,o,s,a,_={ctx:r,current:null,token:null,hasCatch:!1,pending:ae,then:ie,catch:re,value:12};return M(a=r[4],_),{c(){e=b("p"),e.textContent="Congratulations! You finished the adventure!",l=T(),t=b("p"),u=g("You took "),n=g(f),i=g("!"),o=T(),s=P(),_.block.c()},m(c,m){p(c,e,m),p(c,l,m),p(c,t,m),k(t,u),k(t,n),k(t,i),p(c,o,m),p(c,s,m),_.block.m(c,_.anchor=m),_.mount=()=>s.parentNode,_.anchor=s},p(c,m){r=c,m&2&&f!==(f=r[8](r[1].startTime,r[1].endTime)+"")&&A(n,f),_.ctx=r,m&16&&a!==(a=r[4])&&M(a,_)||Z(_,r,m)},d(c){c&&d(e),c&&d(l),c&&d(t),c&&d(o),c&&d(s),_.block.d(c),_.token=null,_=null}}}function re(r){return{c:v,m:v,p:v,d:v}}function ie(r){let e,l,t,u,f=r[12],n=[];for(let i=0;i<f.length;i+=1)n[i]=Y(N(r,f,i));return{c(){e=b("table"),l=b("thead"),l.innerHTML=`<tr><th>Puzzle</th> 
                    <th>Time</th> 
                    <th>Hints</th></tr>`,t=T(),u=b("tbody");for(let i=0;i<n.length;i+=1)n[i].c();z(e,"class","stats")},m(i,o){p(i,e,o),k(e,l),k(e,t),k(e,u);for(let s=0;s<n.length;s+=1)n[s].m(u,null)},p(i,o){if(o&16){f=i[12];let s;for(s=0;s<f.length;s+=1){const a=N(i,f,s);n[s]?n[s].p(a,o):(n[s]=Y(a),n[s].c(),n[s].m(u,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=f.length}},d(i){i&&d(e),$(n,i)}}}function Y(r){let e,l,t=r[13].title+"",u,f,n,i=r[13].time+"",o,s,a,_=r[13].hints+"",c,m;return{c(){e=b("tr"),l=b("td"),u=g(t),f=T(),n=b("td"),o=g(i),s=T(),a=b("td"),c=g(_),m=T(),z(n,"class","time")},m(C,h){p(C,e,h),k(e,l),k(l,u),k(e,f),k(e,n),k(n,o),k(e,s),k(e,a),k(a,c),k(e,m)},p(C,h){h&16&&t!==(t=C[13].title+"")&&A(u,t),h&16&&i!==(i=C[13].time+"")&&A(o,i),h&16&&_!==(_=C[13].hints+"")&&A(c,_)},d(C){C&&d(e)}}}function ae(r){return{c:v,m:v,p:v,d:v}}function ue(r){let e,l,t,u;const f=[le,te,ee],n=[];function i(o,s){return o[3]?0:o[5]||!o[1]?1:2}return e=i(r),l=n[e]=f[e](r),{c(){l.c(),t=P()},m(o,s){n[e].m(o,s),p(o,t,s),u=!0},p(o,[s]){let a=e;e=i(o),e===a?n[e].p(o,s):(O(),q(n[a],1,1,()=>{n[a]=null}),V(),l=n[e],l?l.p(o,s):(l=n[e]=f[e](o),l.c()),G(l,1),l.m(t.parentNode,t))},i(o){u||(G(l),u=!0)},o(o){q(l),u=!1},d(o){n[e].d(o),o&&d(t)}}}function fe(r,e,l){let{params:t={}}=e,u={},f,n=!0,i,o,s;X(async function(){var E;try{s=await F(t.code)}catch(y){l(5,o=y.message||y),l(3,n=!1);return}let{data:h,error:D}=await s.from("games").select("status, puzzle, startTime, endTime, adventures ( name, description)").eq("code",t.code);(E=h[0])!=null&&E.adventures?(l(2,f=J.storage.from("adventures").getPublicUrl(h[0].adventures.name+"/logo.png").data.publicUrl),l(1,u=h[0]),l(4,i=s.rpc("getstats",{gamecode:t.code}).then(({data:y,error:w})=>w?[]:y).then(y=>{let w=u.startTime;return y.forEach(j=>{j.time=c(w,j.solvetime),w=j.solvetime}),y}))):D="Unable to find game",D&&l(5,o=D),l(3,n=!1)});const a=async function(){let{data:h}=await s.rpc("startadventure");h&&await U("/game/"+t.code+"/"+h)},_=async function(){await U("/game/"+t.code+"/"+u.puzzle)},c=function(h,D){const E=(new Date(D).getTime()-new Date(h).getTime())/1e3,y=(w,j)=>{const S=Math.floor(w);return S===1?`${S} ${j}`:S>1?`${S} ${j}s`:""};return[y(E%60,"second"),y(E/60%60,"minute"),y(E/3600%24,"hour"),y(E/86400,"day")].filter(w=>w!=="").reverse().join(", ")},m=()=>a(),C=()=>_();return r.$$set=h=>{"params"in h&&l(0,t=h.params)},[t,u,f,n,i,o,a,_,c,m,C]}class me extends H{constructor(e){super(),R(this,e,fe,ue,L,{params:0})}}export{me as default};
