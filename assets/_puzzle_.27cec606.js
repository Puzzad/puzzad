import{S as F,i as Q,s as V,o as Z,d as h,n as I,g as z,x as he,e as y,b as w,a6 as U,w as ze,y as v,M as O,a as P,f as S,N as A,z as be,a7 as ke,t as R,v as G,O as E,U as B,j as ee,V as X,l as Y,Z as pe,$ as Ce,a8 as ye,a9 as te,p as ve,r as we,q as me,u as de,h as ne,aa as Se,a3 as Ne}from"./index.aa591650.js";import{R as _e}from"./RandomText.76f6fa23.js";import{g as L,a as Re}from"./db.e7b887d9.js";import{S as ge}from"./Spinner.4b3ebbdf.js";import{t as le}from"./title.7da3147b.js";import{p as qe,g as Pe}from"./index.1a0edc91.js";import{t as Ge}from"./FlatToast.svelte_svelte_type_style_lang.3dcaa4ae.js";import{E as Ie}from"./Error.3b805893.js";function oe(o,e,n){const t=o.slice();return t[18]=e[n],t}function ie(o){let e,n={length:o[6]},t=[];for(let l=0;l<n.length;l+=1)t[l]=se(oe(o,n,l));return{c(){e=y("div");for(let l=0;l<t.length;l+=1)t[l].c();w(e,"class","confetti-holder svelte-io58ff"),U(e,"rounded",o[9]),U(e,"cone",o[10]),U(e,"no-gravity",o[11])},m(l,s){h(l,e,s);for(let i=0;i<t.length;i+=1)t[i].m(e,null)},p(l,s){if(s&20991){n={length:l[6]};let i;for(i=0;i<n.length;i+=1){const u=oe(l,n,i);t[i]?t[i].p(u,s):(t[i]=se(u),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}s&512&&U(e,"rounded",l[9]),s&1024&&U(e,"cone",l[10]),s&2048&&U(e,"no-gravity",l[11])},d(l){l&&z(e),ze(t,l)}}}function se(o){let e;return{c(){e=y("div"),w(e,"class","confetti svelte-io58ff"),v(e,"--fall-distance",o[8]),v(e,"--size",o[0]+"px"),v(e,"--color",o[14]()),v(e,"--skew",q(-45,45)+"deg,"+q(-45,45)+"deg"),v(e,"--rotation-xyz",q(-10,10)+", "+q(-10,10)+", "+q(-10,10)),v(e,"--rotation-deg",q(0,360)+"deg"),v(e,"--translate-y-multiplier",q(o[2][0],o[2][1])),v(e,"--translate-x-multiplier",q(o[1][0],o[1][1])),v(e,"--scale",.1*q(2,10)),v(e,"--transition-duration",o[4]?`calc(${o[3]}ms * var(--scale))`:`${o[3]}ms`),v(e,"--transition-delay",q(o[5][0],o[5][1])+"ms"),v(e,"--transition-iteration-count",o[4]?"infinite":o[7]),v(e,"--x-spread",1-o[12])},m(n,t){h(n,e,t)},p(n,t){t&256&&v(e,"--fall-distance",n[8]),t&1&&v(e,"--size",n[0]+"px"),t&4&&v(e,"--translate-y-multiplier",q(n[2][0],n[2][1])),t&2&&v(e,"--translate-x-multiplier",q(n[1][0],n[1][1])),t&24&&v(e,"--transition-duration",n[4]?`calc(${n[3]}ms * var(--scale))`:`${n[3]}ms`),t&32&&v(e,"--transition-delay",q(n[5][0],n[5][1])+"ms"),t&144&&v(e,"--transition-iteration-count",n[4]?"infinite":n[7]),t&4096&&v(e,"--x-spread",1-n[12])},d(n){n&&z(e)}}}function Me(o){let e,n=!o[13]&&ie(o);return{c(){n&&n.c(),e=Z()},m(t,l){n&&n.m(t,l),h(t,e,l)},p(t,[l]){t[13]?n&&(n.d(1),n=null):n?n.p(t,l):(n=ie(t),n.c(),n.m(e.parentNode,e))},i:I,o:I,d(t){n&&n.d(t),t&&z(e)}}}function q(o,e){return Math.random()*(e-o)+o}function Te(o,e,n){let{size:t=10}=e,{x:l=[-.5,.5]}=e,{y:s=[.25,1]}=e,{duration:i=2e3}=e,{infinite:u=!1}=e,{delay:a=[0,50]}=e,{colorRange:m=[0,360]}=e,{colorArray:r=[]}=e,{amount:d=50}=e,{iterationCount:_=1}=e,{fallDistance:k="100px"}=e,{rounded:g=!1}=e,{cone:p=!1}=e,{noGravity:C=!1}=e,{xSpread:H=.15}=e,{destroyOnComplete:D=!0}=e,T=!1;he(()=>{!D||u||_=="infinite"||setTimeout(()=>n(13,T=!0),(i+a[1])*_)});function M(){return r.length?r[Math.round(Math.random()*(r.length-1))]:`hsl(${Math.round(q(m[0],m[1]))}, 75%, 50%`}return o.$$set=f=>{"size"in f&&n(0,t=f.size),"x"in f&&n(1,l=f.x),"y"in f&&n(2,s=f.y),"duration"in f&&n(3,i=f.duration),"infinite"in f&&n(4,u=f.infinite),"delay"in f&&n(5,a=f.delay),"colorRange"in f&&n(15,m=f.colorRange),"colorArray"in f&&n(16,r=f.colorArray),"amount"in f&&n(6,d=f.amount),"iterationCount"in f&&n(7,_=f.iterationCount),"fallDistance"in f&&n(8,k=f.fallDistance),"rounded"in f&&n(9,g=f.rounded),"cone"in f&&n(10,p=f.cone),"noGravity"in f&&n(11,C=f.noGravity),"xSpread"in f&&n(12,H=f.xSpread),"destroyOnComplete"in f&&n(17,D=f.destroyOnComplete)},[t,l,s,i,u,a,d,_,k,g,p,C,H,T,M,m,r,D]}class je extends F{constructor(e){super(),Q(this,e,Te,Me,V,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function re(o,e,n){const t=o.slice();return t[7]=e[n],t}function De(o){let e=o[7].message+"",n;return{c(){n=B(e)},m(t,l){h(t,n,l)},p(t,l){l&1&&e!==(e=t[7].message+"")&&X(n,e)},d(t){t&&z(n)}}}function Oe(o){let e;return{c(){e=B(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                    labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                    laboris nisi ut aliquip ex ea commodo consequat.`)},m(n,t){h(n,e,t)},p:I,d(n){n&&z(e)}}}function ae(o){let e,n,t;function l(){return o[6](o[7])}return{c(){e=y("button"),e.textContent="Reveal this hint",w(e,"class","svelte-6e5e0o")},m(s,i){h(s,e,i),n||(t=Y(e,"click",l),n=!0)},p(s,i){o=s},d(s){s&&z(e),n=!1,t()}}}function ue(o,e){let n,t=e[7].title+"",l,s,i,u,a,m,r;function d(p,C){return p[7].locked?Oe:De}let _=d(e),k=_(e),g=e[7].locked&&ae(e);return{key:o,first:null,c(){n=y("h4"),l=B(t),s=P(),i=y("div"),u=y("p"),k.c(),m=P(),g&&g.c(),r=P(),w(n,"class","svelte-6e5e0o"),w(u,"class",a=ee(e[7].locked?"locked":"")+" svelte-6e5e0o"),w(i,"class","svelte-6e5e0o"),this.first=n},m(p,C){h(p,n,C),S(n,l),h(p,s,C),h(p,i,C),S(i,u),k.m(u,null),S(i,m),g&&g.m(i,null),S(i,r)},p(p,C){e=p,C&1&&t!==(t=e[7].title+"")&&X(l,t),_===(_=d(e))&&k?k.p(e,C):(k.d(1),k=_(e),k&&(k.c(),k.m(u,null))),C&1&&a!==(a=ee(e[7].locked?"locked":"")+" svelte-6e5e0o")&&w(u,"class",a),e[7].locked?g?g.p(e,C):(g=ae(e),g.c(),g.m(i,r)):g&&(g.d(1),g=null)},d(p){p&&z(n),p&&z(s),p&&z(i),k.d(),g&&g.d()}}}function Ae(o){let e,n,t,l,s=[],i=new Map,u;t=new _e({props:{options:o[2]}});let a=o[0];const m=r=>r[7].id;for(let r=0;r<a.length;r+=1){let d=re(o,a,r),_=m(d);i.set(_,s[r]=ue(_,d))}return{c(){e=y("section"),n=y("p"),O(t.$$.fragment),l=P();for(let r=0;r<s.length;r+=1)s[r].c();w(e,"class","svelte-6e5e0o")},m(r,d){h(r,e,d),S(e,n),A(t,n,null),S(e,l);for(let _=0;_<s.length;_+=1)s[_].m(e,null);u=!0},p(r,[d]){d&3&&(a=r[0],s=be(s,d,m,1,r,a,i,e,ke,ue,null,re))},i(r){u||(R(t.$$.fragment,r),u=!0)},o(r){G(t.$$.fragment,r),u=!1},d(r){r&&z(e),E(t);for(let d=0;d<s.length;d+=1)s[d].d()}}}function Ee(o,e,n){let{gameCode:t=""}=e,{puzzleId:l=0}=e;const s=async()=>{const r=await L(t),{data:d,error:_}=await r.rpc("gethints",{puzzleid:l,gamecode:t});if(_)throw _;n(0,u=d)},i=async function(r){await(await L(t)).rpc("requesthint",{puzzleid:l,gamecode:t,hintid:r})};let u=[];const a=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],m=r=>i(r.id);return o.$$set=r=>{"gameCode"in r&&n(3,t=r.gameCode),"puzzleId"in r&&n(4,l=r.puzzleId)},o.$$.update=()=>{o.$$.dirty&24&&t&&l&&s()},[u,i,a,t,l,s,m]}class He extends F{constructor(e){super(),Q(this,e,Ee,Ae,V,{gameCode:3,puzzleId:4,refresh:5})}get refresh(){return this.$$.ctx[5]}}function Ue(o){let e,n;return e=new Ie({props:{error:o[4]}}),{c(){O(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:I,i(t){n||(R(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Be(o){let e,n=o[0]+"",t;return{c(){e=new ye(!1),t=Z(),e.a=t},m(l,s){e.m(n,l,s),h(l,t,s)},p:I,i:I,o:I,d(l){l&&z(t),l&&e.d()}}}function We(o){let e,n;return e=new ge({}),{c(){O(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:I,i(t){n||(R(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ye(o){let e,n,t={ctx:o,current:null,token:null,hasCatch:!0,pending:We,then:Be,catch:Ue,value:0,error:4,blocks:[,,,]};return pe(o[0],t),{c(){e=Z(),t.block.c()},m(l,s){h(l,e,s),t.block.m(l,t.anchor=s),t.mount=()=>e.parentNode,t.anchor=e,n=!0},p(l,[s]){o=l,Ce(t,o,s)},i(l){n||(R(t.block),n=!0)},o(l){for(let s=0;s<3;s+=1){const i=t.blocks[s];G(i)}n=!1},d(l){l&&z(e),t.block.d(l),t.token=null,t=null}}}const fe=/\$[^$]+?\$/g;function Le(o,e,n){let{gameCode:t=""}=e,{storageSlug:l=""}=e,{content:s=""}=e,i=Promise.all([L(t),l,s]).then(([u,a,m])=>{const r=m.match(fe)||[];return Promise.all([m,...r.map(d=>d.substring(1,d.length-1)).map(d=>u.storage.from("puzzles").createSignedUrl(`${a}/${d}`,60*60).then(({data:{signedUrl:_},error:k})=>{if(k)throw k;return _}))])}).then(([u,...a])=>u.replace(fe,()=>a.shift()));return o.$$set=u=>{"gameCode"in u&&n(1,t=u.gameCode),"storageSlug"in u&&n(2,l=u.storageSlug),"content"in u&&n(3,s=u.content)},[i,t,l,s]}class Fe extends F{constructor(e){super(),Q(this,e,Le,Ye,V,{gameCode:1,storageSlug:2,content:3})}}function Qe(o){let e,n,t,l,s,i,u,a,m,r;return{c(){e=y("section"),n=y("form"),t=y("fieldset"),l=y("legend"),l.textContent="Enter a guess",s=P(),i=y("input"),u=P(),a=y("input"),w(i,"type","text"),i.disabled=o[1],w(i,"class","svelte-1z90x0"),w(a,"type","submit"),a.value="Submit",a.disabled=o[1],w(t,"class","svelte-1z90x0")},m(d,_){h(d,e,_),S(e,n),S(n,t),S(t,l),S(t,s),S(t,i),te(i,o[0]),S(t,u),S(t,a),m||(r=[Y(i,"input",o[5]),Y(n,"submit",ve(o[2]))],m=!0)},p(d,[_]){_&2&&(i.disabled=d[1]),_&1&&i.value!==d[0]&&te(i,d[0]),_&2&&(a.disabled=d[1])},i:I,o:I,d(d){d&&z(e),m=!1,we(r)}}}function Ve(o,e,n){let{puzzle:t=0}=e,{gameCode:l=""}=e,s="",i=!1;const u=async()=>{n(1,i=!0),await L(l).then(m=>m.from("guesses").insert({content:s,puzzle:t,game:l}).throwOnError()).then(()=>n(0,s="")).finally(()=>n(1,i=!1))};function a(){s=this.value,n(0,s)}return o.$$set=m=>{"puzzle"in m&&n(3,t=m.puzzle),"gameCode"in m&&n(4,l=m.gameCode)},[s,i,u,t,l,a]}class Ze extends F{constructor(e){super(),Q(this,e,Ve,Qe,V,{puzzle:3,gameCode:4})}}function Je(o){let e,n=o[1].adventure.name+"",t,l,s=o[1].title+"",i,u,a,m,r,d,_,k,g,p,C,H,D,T,M;a=new Fe({props:{gameCode:o[0].code,storageSlug:o[1].storage_slug,content:o[1].content}}),r=new Ze({props:{gameCode:o[0].code,puzzle:o[0].puzzle}});let f={gameCode:o[0].code,puzzleId:o[0].puzzle};_=new He({props:f}),o[8](_),C=new _e({props:{options:o[7]}});function W(c,b){return c[1].next?xe:Xe}let J=W(o),j=J(o),N=o[2]&&ce();return{c(){e=y("h2"),t=B(n),l=B(": "),i=B(s),u=P(),O(a.$$.fragment),m=P(),O(r.$$.fragment),d=P(),O(_.$$.fragment),k=P(),g=y("dialog"),p=y("h3"),O(C.$$.fragment),H=P(),j.c(),D=P(),N&&N.c(),T=Z(),w(p,"class","svelte-j9ca2a"),g.open=o[2],w(g,"class","svelte-j9ca2a")},m(c,b){h(c,e,b),S(e,t),S(e,l),S(e,i),h(c,u,b),A(a,c,b),h(c,m,b),A(r,c,b),h(c,d,b),A(_,c,b),h(c,k,b),h(c,g,b),S(g,p),A(C,p,null),S(g,H),j.m(g,null),h(c,D,b),N&&N.m(c,b),h(c,T,b),M=!0},p(c,b){(!M||b&2)&&n!==(n=c[1].adventure.name+"")&&X(t,n),(!M||b&2)&&s!==(s=c[1].title+"")&&X(i,s);const K={};b&1&&(K.gameCode=c[0].code),b&2&&(K.storageSlug=c[1].storage_slug),b&2&&(K.content=c[1].content),a.$set(K);const x={};b&1&&(x.gameCode=c[0].code),b&1&&(x.puzzle=c[0].puzzle),r.$set(x);const $={};b&1&&($.gameCode=c[0].code),b&1&&($.puzzleId=c[0].puzzle),_.$set($),J===(J=W(c))&&j?j.p(c,b):(j.d(1),j=J(c),j&&(j.c(),j.m(g,null))),(!M||b&4)&&(g.open=c[2]),c[2]?N?b&4&&R(N,1):(N=ce(),N.c(),R(N,1),N.m(T.parentNode,T)):N&&(me(),G(N,1,1,()=>{N=null}),de())},i(c){M||(R(a.$$.fragment,c),R(r.$$.fragment,c),R(_.$$.fragment,c),R(C.$$.fragment,c),R(N),M=!0)},o(c){G(a.$$.fragment,c),G(r.$$.fragment,c),G(_.$$.fragment,c),G(C.$$.fragment,c),G(N),M=!1},d(c){c&&z(e),c&&z(u),E(a,c),c&&z(m),E(r,c),c&&z(d),o[8](null),E(_,c),c&&z(k),c&&z(g),E(C),j.d(),c&&z(D),N&&N.d(c),c&&z(T)}}}function Ke(o){let e,n;return e=new ge({}),{c(){O(e.$$.fragment)},m(t,l){A(e,t,l),n=!0},p:I,i(t){n||(R(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Xe(o){let e,n,t,l,s;return{c(){e=y("p"),e.textContent="You have completed the adventure!",n=P(),t=y("button"),t.textContent="Continue \xBB",w(e,"class","svelte-j9ca2a"),w(t,"class","svelte-j9ca2a")},m(i,u){h(i,e,u),h(i,n,u),h(i,t,u),l||(s=Y(t,"click",o[10]),l=!0)},p:I,d(i){i&&z(e),i&&z(n),i&&z(t),l=!1,s()}}}function xe(o){let e,n,t,l,s;return{c(){e=y("p"),e.textContent="You have completed this step in the adventure!",n=P(),t=y("button"),t.textContent="Next puzzle \xBB",w(e,"class","svelte-j9ca2a"),w(t,"class","svelte-j9ca2a")},m(i,u){h(i,e,u),h(i,n,u),h(i,t,u),l||(s=Y(t,"click",o[9]),l=!0)},p:I,d(i){i&&z(e),i&&z(n),i&&z(t),l=!1,s()}}}function ce(o){let e,n,t;return n=new je({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=y("div"),O(n.$$.fragment),w(e,"class","confetti-bg svelte-j9ca2a")},m(l,s){h(l,e,s),A(n,e,null),t=!0},i(l){t||(R(n.$$.fragment,l),t=!0)},o(l){G(n.$$.fragment,l),t=!1},d(l){l&&z(e),E(n)}}}function $e(o){let e,n,t,l;const s=[Ke,Je],i=[];function u(a,m){return a[3]?0:1}return e=u(o),n=i[e]=s[e](o),{c(){n.c(),t=Z()},m(a,m){i[e].m(a,m),h(a,t,m),l=!0},p(a,[m]){let r=e;e=u(a),e===r?i[e].p(a,m):(me(),G(i[r],1,1,()=>{i[r]=null}),de(),n=i[e],n?n.p(a,m):(n=i[e]=s[e](a),n.c()),R(n,1),n.m(t.parentNode,t))},i(a){l||(R(n),l=!0)},o(a){G(n),l=!1},d(a){i[e].d(a),a&&z(t)}}}function et(o,e,n){let t,l;ne(o,qe,f=>n(0,t=f)),ne(o,Pe,f=>n(12,l=f));let s={},i=!1,u=!0,a=null,m;le.set("Puzzad: Loading...");const r=()=>{d(),L(t.code).then(f=>f.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",t.puzzle).throwOnError()).then(_).then(f=>n(1,s=f)).then(()=>{le.set("Puzzad: "+s.adventure.name+": "+s.title),k(),n(3,u=!1)}).catch(()=>l("/games/[code]",{code:t.code}))},d=()=>{console.log("Resetting..."),n(3,u=!0),n(2,i=!1)},_=({data:f,error:W})=>{if(W)throw W;if(f.length===0)throw"Puzzle not found";return f[0]};Se(function(){a&&a.disconnect()});const k=async function(){a||(a=await Re(t.code),await a.channel("public:guesses:game=eq."+t.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+t.code},g).subscribe())},g=function(f){f.record.puzzle.toString()===t.puzzle&&(f.record.content==="*hint"?m.refresh():f.record.correct?n(2,i=!0):Ge.add({title:"Incorrect guess",description:f.record.content,duration:1e4,type:"error"}))},p=async function(){l("/games/[code]/[puzzle]",{code:t.code,puzzle:s.next})},C=async function(){l("/games/[code]",{code:t.code})},H=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function D(f){Ne[f?"unshift":"push"](()=>{m=f,n(4,m)})}const T=()=>p(),M=()=>C();return o.$$.update=()=>{o.$$.dirty&1&&t.puzzle&&t.code&&r()},[t,s,i,u,m,p,C,H,D,T,M]}class ut extends F{constructor(e){super(),Q(this,e,et,$e,V,{})}}export{ut as default};
