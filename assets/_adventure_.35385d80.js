import{S as M,i as N,s as q,Z as C,o as v,d as p,$ as L,t as b,v as k,g as d,h as z,M as $,N as g,n as s,O as w,e as _,a as y,U as S,f as A,l as E}from"./index.f7bc07cf.js";import{s as h}from"./db.6e9db042.js";import{S as H}from"./Spinner.d298f838.js";import{A as T}from"./AdventureLogo.6c42964b.js";import{t as U}from"./title.a72c6b81.js";import{E as B}from"./Error.85e7ee3e.js";import{g as D}from"./index.4d5a1717.js";function I(r){let e,n;return e=new B({props:{error:r[7]}}),{c(){$(e.$$.fragment)},m(t,o){g(e,t,o),n=!0},p:s,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){w(e,t)}}}function O(r){let e,n,t,o,l=r[2].description+"",u,f,i;n=new T({props:{name:r[2].name}});let a={ctx:r,current:null,token:null,hasCatch:!1,pending:F,then:Y,catch:P,value:6};return C(r[0],a),{c(){e=_("h2"),$(n.$$.fragment),t=y(),o=_("section"),u=y(),f=v(),a.block.c()},m(c,m){p(c,e,m),g(n,e,null),p(c,t,m),p(c,o,m),o.innerHTML=l,p(c,u,m),p(c,f,m),a.block.m(c,a.anchor=m),a.mount=()=>f.parentNode,a.anchor=f,i=!0},p(c,m){r=c,L(a,r,m)},i(c){i||(b(n.$$.fragment,c),i=!0)},o(c){k(n.$$.fragment,c),i=!1},d(c){c&&d(e),w(n),c&&d(t),c&&d(o),c&&d(u),c&&d(f),a.block.d(c),a.token=null,a=null}}}function P(r){return{c:s,m:s,p:s,d:s}}function Y(r){let e;function n(l,u){return l[6]?j:Z}let o=n(r)(r);return{c(){o.c(),e=v()},m(l,u){o.m(l,u),p(l,e,u)},p(l,u){o.p(l,u)},d(l){o.d(l),l&&d(e)}}}function Z(r){let e;return{c(){e=_("p"),e.innerHTML='You must <a href="/login">login</a> before you can start an adventure.'},m(n,t){p(n,e,t)},p:s,d(n){n&&d(e)}}}function j(r){let e,n,t=r[2].price===0?"free":"\xA3"+r[2].price,o,l,u;function f(){return r[4](r[2])}return{c(){e=_("button"),n=S("Start this adventure for "),o=S(t)},m(i,a){p(i,e,a),A(e,n),A(e,o),l||(u=E(e,"click",f),l=!0)},p(i,a){r=i},d(i){i&&d(e),l=!1,u()}}}function F(r){return{c:s,m:s,p:s,d:s}}function G(r){let e,n;return e=new H({}),{c(){$(e.$$.fragment)},m(t,o){g(e,t,o),n=!0},p:s,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){w(e,t)}}}function J(r){let e,n,t={ctx:r,current:null,token:null,hasCatch:!0,pending:G,then:O,catch:I,value:2,error:7,blocks:[,,,]};return C(r[2],t),{c(){e=v(),t.block.c()},m(o,l){p(o,e,l),t.block.m(o,t.anchor=l),t.mount=()=>e.parentNode,t.anchor=e,n=!0},p(o,[l]){r=o,L(t,r,l)},i(o){n||(b(t.block),n=!0)},o(o){for(let l=0;l<3;l+=1){const u=t.blocks[l];k(u)}n=!1},d(o){o&&d(e),t.block.d(o),t.token=null,t=null}}}function K(r,e,n){let t;z(r,D,a=>n(5,t=a));let{adventure:o=""}=e,l=h.from("adventures").select("id,name,description,price").eq("name",o).then(({data:a,error:c})=>{if(c)throw c;return U.set("Puzzad: "+a[0].name),a[0]}),u=h.auth.getSession().then(({data:{session:a}})=>!!(a!=null&&a.user));const f=async a=>{if(a.price===0){let{data:c,error:m}=await h.rpc("addfreeadventure",{adventureid:a.id});c&&t("/games/[code]",{code:c})}},i=a=>f(a);return r.$$set=a=>{"adventure"in a&&n(3,o=a.adventure)},[u,f,l,o,i]}class te extends M{constructor(e){super(),N(this,e,K,J,q,{adventure:3})}}export{te as default};
