import{S as fe,i as ce,s as me,e as Se,a as h,n as V,d as z,o as Te,h as C,u as I,G as J,k as Me,v,l as j,j as T,w as q,m as B,H as Ne,I as Pe,b as D,t as O,p as L,y as K,J as ge,z as ie,F as re,E as $,g as qe,c as Ge,K as De,L as le,M as He,q as ue,r as he,N as ze,O as Oe,x as pe,P as Ue,Q as Ae}from"./index.bc9733a8.js";import{R as Re}from"./RandomText.f8e0c7fd.js";import{S as Ee}from"./Spinner.6c619fdd.js";import{t as Fe,T as We,F as Ye}from"./FlatToast.a57a97a2.js";function ke(l,e,t){const n=l.slice();return n[18]=e[t],n}function be(l){let e,t={length:l[6]},n=[];for(let i=0;i<t.length;i+=1)n[i]=ye(ke(l,t,i));return{c(){e=C("div");for(let i=0;i<n.length;i+=1)n[i].c();I(e,"class","confetti-holder svelte-io58ff"),J(e,"rounded",l[9]),J(e,"cone",l[10]),J(e,"no-gravity",l[11])},m(i,a){h(i,e,a);for(let s=0;s<n.length;s+=1)n[s].m(e,null)},p(i,a){if(a&20991){t={length:i[6]};let s;for(s=0;s<t.length;s+=1){const u=ke(i,t,s);n[s]?n[s].p(u,a):(n[s]=ye(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}a&512&&J(e,"rounded",i[9]),a&1024&&J(e,"cone",i[10]),a&2048&&J(e,"no-gravity",i[11])},d(i){i&&z(e),Me(n,i)}}}function ye(l){let e;return{c(){e=C("div"),I(e,"class","confetti svelte-io58ff"),v(e,"--fall-distance",l[8]),v(e,"--size",l[0]+"px"),v(e,"--color",l[14]()),v(e,"--skew",M(-45,45)+"deg,"+M(-45,45)+"deg"),v(e,"--rotation-xyz",M(-10,10)+", "+M(-10,10)+", "+M(-10,10)),v(e,"--rotation-deg",M(0,360)+"deg"),v(e,"--translate-y-multiplier",M(l[2][0],l[2][1])),v(e,"--translate-x-multiplier",M(l[1][0],l[1][1])),v(e,"--scale",.1*M(2,10)),v(e,"--transition-duration",l[4]?`calc(${l[3]}ms * var(--scale))`:`${l[3]}ms`),v(e,"--transition-delay",M(l[5][0],l[5][1])+"ms"),v(e,"--transition-iteration-count",l[4]?"infinite":l[7]),v(e,"--x-spread",1-l[12])},m(t,n){h(t,e,n)},p(t,n){n&256&&v(e,"--fall-distance",t[8]),n&1&&v(e,"--size",t[0]+"px"),n&4&&v(e,"--translate-y-multiplier",M(t[2][0],t[2][1])),n&2&&v(e,"--translate-x-multiplier",M(t[1][0],t[1][1])),n&24&&v(e,"--transition-duration",t[4]?`calc(${t[3]}ms * var(--scale))`:`${t[3]}ms`),n&32&&v(e,"--transition-delay",M(t[5][0],t[5][1])+"ms"),n&144&&v(e,"--transition-iteration-count",t[4]?"infinite":t[7]),n&4096&&v(e,"--x-spread",1-t[12])},d(t){t&&z(e)}}}function je(l){let e,t=!l[13]&&be(l);return{c(){t&&t.c(),e=Se()},m(n,i){t&&t.m(n,i),h(n,e,i)},p(n,[i]){n[13]?t&&(t.d(1),t=null):t?t.p(n,i):(t=be(n),t.c(),t.m(e.parentNode,e))},i:V,o:V,d(n){t&&t.d(n),n&&z(e)}}}function M(l,e){return Math.random()*(e-l)+l}function Be(l,e,t){let{size:n=10}=e,{x:i=[-.5,.5]}=e,{y:a=[.25,1]}=e,{duration:s=2e3}=e,{infinite:u=!1}=e,{delay:f=[0,50]}=e,{colorRange:_=[0,360]}=e,{colorArray:r=[]}=e,{amount:d=50}=e,{iterationCount:p=1}=e,{fallDistance:b="100px"}=e,{rounded:y=!1}=e,{cone:S=!1}=e,{noGravity:k=!1}=e,{xSpread:W=.15}=e,{destroyOnComplete:N=!0}=e,E=!1;Te(()=>{!N||u||p=="infinite"||setTimeout(()=>t(13,E=!0),(s+f[1])*p)});function R(){return r.length?r[Math.round(Math.random()*(r.length-1))]:`hsl(${Math.round(M(_[0],_[1]))}, 75%, 50%`}return l.$$set=c=>{"size"in c&&t(0,n=c.size),"x"in c&&t(1,i=c.x),"y"in c&&t(2,a=c.y),"duration"in c&&t(3,s=c.duration),"infinite"in c&&t(4,u=c.infinite),"delay"in c&&t(5,f=c.delay),"colorRange"in c&&t(15,_=c.colorRange),"colorArray"in c&&t(16,r=c.colorArray),"amount"in c&&t(6,d=c.amount),"iterationCount"in c&&t(7,p=c.iterationCount),"fallDistance"in c&&t(8,b=c.fallDistance),"rounded"in c&&t(9,y=c.rounded),"cone"in c&&t(10,S=c.cone),"noGravity"in c&&t(11,k=c.noGravity),"xSpread"in c&&t(12,W=c.xSpread),"destroyOnComplete"in c&&t(17,N=c.destroyOnComplete)},[n,i,a,s,u,f,d,p,b,y,S,k,W,E,R,_,r,N]}class Le extends fe{constructor(e){super(),ce(this,e,Be,je,me,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function Ce(l,e,t){const n=l.slice();return n[7]=e[t],n}function Qe(l){let e=l[7].message+"",t;return{c(){t=K(e)},m(n,i){h(n,t,i)},p(n,i){i&1&&e!==(e=n[7].message+"")&&ie(t,e)},d(n){n&&z(t)}}}function Je(l){let e;return{c(){e=K(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                    labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                    laboris nisi ut aliquip ex ea commodo consequat.`)},m(t,n){h(t,e,n)},p:V,d(t){t&&z(e)}}}function ve(l){let e,t,n;function i(){return l[6](l[7])}return{c(){e=C("button"),e.textContent="Reveal this hint",I(e,"class","svelte-6e5e0o")},m(a,s){h(a,e,s),t||(n=$(e,"click",i),t=!0)},p(a,s){l=a},d(a){a&&z(e),t=!1,n()}}}function we(l,e){let t,n=e[7].title+"",i,a,s,u,f,_,r;function d(S,k){return S[7].locked?Je:Qe}let p=d(e),b=p(e),y=e[7].locked&&ve(e);return{key:l,first:null,c(){t=C("h4"),i=K(n),a=T(),s=C("div"),u=C("p"),b.c(),_=T(),y&&y.c(),r=T(),I(t,"class","svelte-6e5e0o"),I(u,"class",f=ge(e[7].locked?"locked":"")+" svelte-6e5e0o"),I(s,"class","svelte-6e5e0o"),this.first=t},m(S,k){h(S,t,k),q(t,i),h(S,a,k),h(S,s,k),q(s,u),b.m(u,null),q(s,_),y&&y.m(s,null),q(s,r)},p(S,k){e=S,k&1&&n!==(n=e[7].title+"")&&ie(i,n),p===(p=d(e))&&b?b.p(e,k):(b.d(1),b=p(e),b&&(b.c(),b.m(u,null))),k&1&&f!==(f=ge(e[7].locked?"locked":"")+" svelte-6e5e0o")&&I(u,"class",f),e[7].locked?y?y.p(e,k):(y=ve(e),y.c(),y.m(s,r)):y&&(y.d(1),y=null)},d(S){S&&z(t),S&&z(a),S&&z(s),b.d(),y&&y.d()}}}function Ke(l){let e,t,n,i,a=[],s=new Map,u;n=new Re({props:{options:l[2]}});let f=l[0];const _=r=>r[7].id;for(let r=0;r<f.length;r+=1){let d=Ce(l,f,r),p=_(d);s.set(p,a[r]=we(p,d))}return{c(){e=C("section"),t=C("p"),j(n.$$.fragment),i=T();for(let r=0;r<a.length;r+=1)a[r].c();I(e,"class","svelte-6e5e0o")},m(r,d){h(r,e,d),q(e,t),B(n,t,null),q(e,i);for(let p=0;p<a.length;p+=1)a[p].m(e,null);u=!0},p(r,[d]){d&3&&(f=r[0],a=Ne(a,d,_,1,r,f,s,e,Pe,we,null,Ce))},i(r){u||(D(n.$$.fragment,r),u=!0)},o(r){O(n.$$.fragment,r),u=!1},d(r){r&&z(e),L(n);for(let d=0;d<a.length;d+=1)a[d].d()}}}function Ve(l,e,t){let{gameCode:n=""}=e,{puzzleId:i=0}=e;const a=async()=>{const r=await re(n),{data:d,error:p}=await r.rpc("gethints",{puzzleid:i,gamecode:n});if(p)throw p;t(0,u=d)},s=async function(r){await(await re(n)).rpc("requesthint",{puzzleid:i,gamecode:n,hintid:r})};let u=[];const f=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],_=r=>s(r.id);return l.$$set=r=>{"gameCode"in r&&t(3,n=r.gameCode),"puzzleId"in r&&t(4,i=r.puzzleId)},l.$$.update=()=>{l.$$.dirty&24&&n&&i&&a()},[u,s,f,n,i,a,_]}class Xe extends fe{constructor(e){super(),ce(this,e,Ve,Ke,me,{gameCode:3,puzzleId:4,refresh:5})}get refresh(){return this.$$.ctx[5]}}function Ze(l){let e,t=l[6].adventure.name+"",n,i,a=l[6].title+"",s,u,f,_=l[6].content+"",r,d,p,b,y,S,k,W,N,E,R,c,X,Z,P,Q,F,ee,x,Y,m,w,U,H;function se(o){l[13](o)}function te(o){l[14](o)}let oe={};l[0].code!==void 0&&(oe.gameCode=l[0].code),l[0].puzzle!==void 0&&(oe.puzzleId=l[0].puzzle),R=new Xe({props:oe}),ue.push(()=>he(R,"gameCode",se)),ue.push(()=>he(R,"puzzleId",te)),l[15](R),F=new Re({props:{options:l[10]}});function de(o,g){return o[6].next?et:$e}let ne=de(l),A=ne(l),G=l[2]&&Ie();return m=new We({props:{placement:"bottom-right",theme:"dark",$$slots:{default:[tt,({data:o})=>({6:o}),({data:o})=>o?64:0]},$$scope:{ctx:l}}}),{c(){e=C("h2"),n=K(t),i=K(": "),s=K(a),u=T(),f=new Ae(!1),r=T(),d=C("section"),p=C("form"),b=C("fieldset"),y=C("legend"),y.textContent="Enter a guess",S=T(),k=C("input"),W=T(),N=C("input"),E=T(),j(R.$$.fragment),Z=T(),P=C("dialog"),Q=C("h3"),j(F.$$.fragment),ee=T(),A.c(),x=T(),G&&G.c(),Y=T(),j(m.$$.fragment),f.a=r,I(k,"type","text"),k.disabled=l[3],I(k,"class","svelte-6zlkam"),I(N,"type","submit"),N.value="Submit",N.disabled=l[3],I(b,"class","svelte-6zlkam"),I(d,"class","answer svelte-6zlkam"),I(Q,"class","svelte-6zlkam"),P.open=l[2],I(P,"class","svelte-6zlkam")},m(o,g){h(o,e,g),q(e,n),q(e,i),q(e,s),h(o,u,g),f.m(_,o,g),h(o,r,g),h(o,d,g),q(d,p),q(p,b),q(b,y),q(b,S),q(b,k),ze(k,l[1]),q(b,W),q(b,N),h(o,E,g),B(R,o,g),h(o,Z,g),h(o,P,g),q(P,Q),B(F,Q,null),q(P,ee),A.m(P,null),h(o,x,g),G&&G.m(o,g),h(o,Y,g),B(m,o,g),w=!0,U||(H=[$(k,"input",l[11]),$(p,"submit",Oe(l[12]))],U=!0)},p(o,g){(!w||g&64)&&t!==(t=o[6].adventure.name+"")&&ie(n,t),(!w||g&64)&&a!==(a=o[6].title+"")&&ie(s,a),(!w||g&64)&&_!==(_=o[6].content+"")&&f.p(_),(!w||g&8)&&(k.disabled=o[3]),g&2&&k.value!==o[1]&&ze(k,o[1]),(!w||g&8)&&(N.disabled=o[3]);const ae={};!c&&g&1&&(c=!0,ae.gameCode=o[0].code,pe(()=>c=!1)),!X&&g&1&&(X=!0,ae.puzzleId=o[0].puzzle,pe(()=>X=!1)),R.$set(ae),ne===(ne=de(o))&&A?A.p(o,g):(A.d(1),A=ne(o),A&&(A.c(),A.m(P,null))),(!w||g&4)&&(P.open=o[2]),o[2]?G?g&4&&D(G,1):(G=Ie(),G.c(),D(G,1),G.m(Y.parentNode,Y)):G&&(qe(),O(G,1,1,()=>{G=null}),Ge());const _e={};g&134217792&&(_e.$$scope={dirty:g,ctx:o}),m.$set(_e)},i(o){w||(D(R.$$.fragment,o),D(F.$$.fragment,o),D(G),D(m.$$.fragment,o),w=!0)},o(o){O(R.$$.fragment,o),O(F.$$.fragment,o),O(G),O(m.$$.fragment,o),w=!1},d(o){o&&z(e),o&&z(u),o&&f.d(),o&&z(r),o&&z(d),o&&z(E),l[15](null),L(R,o),o&&z(Z),o&&z(P),L(F),A.d(),o&&z(x),G&&G.d(o),o&&z(Y),L(m,o),U=!1,Ue(H)}}}function xe(l){let e,t;return e=new Ee({}),{c(){j(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p:V,i(n){t||(D(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){L(e,n)}}}function $e(l){let e,t,n,i,a;return{c(){e=C("p"),e.textContent="You have completed the adventure!",t=T(),n=C("button"),n.textContent="Continue \xBB",I(e,"class","svelte-6zlkam"),I(n,"class","svelte-6zlkam")},m(s,u){h(s,e,u),h(s,t,u),h(s,n,u),i||(a=$(n,"click",l[17]),i=!0)},p:V,d(s){s&&z(e),s&&z(t),s&&z(n),i=!1,a()}}}function et(l){let e,t,n,i,a;return{c(){e=C("p"),e.textContent="You have completed this step in the adventure!",t=T(),n=C("button"),n.textContent="Next puzzle \xBB",I(e,"class","svelte-6zlkam"),I(n,"class","svelte-6zlkam")},m(s,u){h(s,e,u),h(s,t,u),h(s,n,u),i||(a=$(n,"click",l[16]),i=!0)},p:V,d(s){s&&z(e),s&&z(t),s&&z(n),i=!1,a()}}}function Ie(l){let e,t,n;return t=new Le({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=C("div"),j(t.$$.fragment),I(e,"class","confetti-bg svelte-6zlkam")},m(i,a){h(i,e,a),B(t,e,null),n=!0},i(i){n||(D(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&z(e),L(t)}}}function tt(l){let e,t;return e=new Ye({props:{data:l[6]}}),{c(){j(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const a={};i&64&&(a.data=n[6]),e.$set(a)},i(n){t||(D(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){L(e,n)}}}function nt(l){let e,t,n,i;const a=[xe,Ze],s=[];function u(f,_){return f[4]?0:1}return e=u(l),t=s[e]=a[e](l),{c(){t.c(),n=Se()},m(f,_){s[e].m(f,_),h(f,n,_),i=!0},p(f,[_]){let r=e;e=u(f),e===r?s[e].p(f,_):(qe(),O(s[r],1,1,()=>{s[r]=null}),Ge(),t=s[e],t?t.p(f,_):(t=s[e]=a[e](f),t.c()),D(t,1),t.m(n.parentNode,n))},i(f){i||(D(t),i=!0)},o(f){O(t),i=!1},d(f){s[e].d(f),f&&z(n)}}}function lt(l,e,t){let{params:n={}}=e,i={},a="",s=!1,u=!1,f=!0,_=null,r=null,d;const p=()=>{try{b(),re(n.code).then(m=>(r=m,m.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",n.puzzle))).then(y).then(S).then(k).then(m=>t(6,i=m)).then(()=>{W(),t(4,f=!1)}).catch(()=>le("/game/"+n.code))}catch{le("/game/"+n.code)}},b=()=>{console.log("Resetting..."),t(4,f=!0),t(2,s=!1),t(1,a=""),t(3,u=!1)},y=({data:m,error:w})=>{if(w)throw w;if(m.length===0)throw"Puzzle not found";return m[0]},S=m=>{let w=[m];const U=m.content.match(/\$[^$]+?\$/g);return U&&U.forEach(H=>{w.push(H,r.storage.from("puzzles").createSignedUrl(m.storage_slug+"/"+H.substring(1,H.length-1),60*60))}),Promise.all(w)},k=m=>{let[w,...U]=m;for(let H=0;H<U.length;H+=2){const{data:{signedUrl:se},error:te}=U[H+1];if(te)throw te;w.content=w.content.replace(U[H],se)}return w};De(function(){_&&_.disconnect()});const W=async function(){_||(_=await He(n.code),await _.channel("public:guesses:game=eq."+n.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+n.code},N).subscribe())},N=function(m){m.record.puzzle.toString()===n.puzzle&&(m.record.content==="*hint"?d.refresh():m.record.correct?t(2,s=!0):Fe.add({title:"Incorrect guess",description:m.record.content,duration:1e4,type:"error"}))},E=async function(){t(3,u=!0),await r.from("guesses").insert({content:a,puzzle:n.puzzle,game:n.code}),t(3,u=!1),t(1,a="")},R=async function(){await le("/game/"+n.code+"/"+i.next)},c=async function(){await le("/game/"+n.code)},X=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function Z(){a=this.value,t(1,a)}const P=()=>E();function Q(m){l.$$.not_equal(n.code,m)&&(n.code=m,t(0,n))}function F(m){l.$$.not_equal(n.puzzle,m)&&(n.puzzle=m,t(0,n))}function ee(m){ue[m?"unshift":"push"](()=>{d=m,t(5,d)})}const x=()=>R(),Y=()=>c();return l.$$set=m=>{"params"in m&&t(0,n=m.params)},l.$$.update=()=>{l.$$.dirty&1&&n.code&&n.puzzle&&p()},[n,a,s,u,f,d,i,E,R,c,X,Z,P,Q,F,ee,x,Y]}class rt extends fe{constructor(e){super(),ce(this,e,lt,nt,me,{params:0})}}export{rt as default};
