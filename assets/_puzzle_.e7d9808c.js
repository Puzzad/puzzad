import{S as F,i as Q,s as V,o as Z,d as h,n as I,g as z,x as he,e as v,b as w,a6 as B,w as ze,y as C,M as A,a as P,f as q,N as E,z as be,a7 as pe,t as N,v as G,O as H,U as W,j as ee,V as X,l as j,Z as ke,$ as ye,a8 as ve,a9 as te,p as Ce,r as we,q as me,u as de,h as ne,aa as qe,a3 as Se}from"./index.f7bc07cf.js";import{R as _e}from"./RandomText.efba7db1.js";import{g as L,a as Ne}from"./db.6e9db042.js";import{S as ge}from"./Spinner.d298f838.js";import{t as le}from"./title.a72c6b81.js";import{p as Re,g as Pe}from"./index.4d5a1717.js";import{t as Ge}from"./FlatToast.svelte_svelte_type_style_lang.b9252562.js";import{E as Ie}from"./Error.85e7ee3e.js";function oe(o,e,n){const t=o.slice();return t[18]=e[n],t}function ie(o){let e,n={length:o[6]},t=[];for(let l=0;l<n.length;l+=1)t[l]=se(oe(o,n,l));return{c(){e=v("div");for(let l=0;l<t.length;l+=1)t[l].c();w(e,"class","confetti-holder svelte-io58ff"),B(e,"rounded",o[9]),B(e,"cone",o[10]),B(e,"no-gravity",o[11])},m(l,s){h(l,e,s);for(let i=0;i<t.length;i+=1)t[i].m(e,null)},p(l,s){if(s&20991){n={length:l[6]};let i;for(i=0;i<n.length;i+=1){const a=oe(l,n,i);t[i]?t[i].p(a,s):(t[i]=se(a),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}s&512&&B(e,"rounded",l[9]),s&1024&&B(e,"cone",l[10]),s&2048&&B(e,"no-gravity",l[11])},d(l){l&&z(e),ze(t,l)}}}function se(o){let e;return{c(){e=v("div"),w(e,"class","confetti svelte-io58ff"),C(e,"--fall-distance",o[8]),C(e,"--size",o[0]+"px"),C(e,"--color",o[14]()),C(e,"--skew",R(-45,45)+"deg,"+R(-45,45)+"deg"),C(e,"--rotation-xyz",R(-10,10)+", "+R(-10,10)+", "+R(-10,10)),C(e,"--rotation-deg",R(0,360)+"deg"),C(e,"--translate-y-multiplier",R(o[2][0],o[2][1])),C(e,"--translate-x-multiplier",R(o[1][0],o[1][1])),C(e,"--scale",.1*R(2,10)),C(e,"--transition-duration",o[4]?`calc(${o[3]}ms * var(--scale))`:`${o[3]}ms`),C(e,"--transition-delay",R(o[5][0],o[5][1])+"ms"),C(e,"--transition-iteration-count",o[4]?"infinite":o[7]),C(e,"--x-spread",1-o[12])},m(n,t){h(n,e,t)},p(n,t){t&256&&C(e,"--fall-distance",n[8]),t&1&&C(e,"--size",n[0]+"px"),t&4&&C(e,"--translate-y-multiplier",R(n[2][0],n[2][1])),t&2&&C(e,"--translate-x-multiplier",R(n[1][0],n[1][1])),t&24&&C(e,"--transition-duration",n[4]?`calc(${n[3]}ms * var(--scale))`:`${n[3]}ms`),t&32&&C(e,"--transition-delay",R(n[5][0],n[5][1])+"ms"),t&144&&C(e,"--transition-iteration-count",n[4]?"infinite":n[7]),t&4096&&C(e,"--x-spread",1-n[12])},d(n){n&&z(e)}}}function Me(o){let e,n=!o[13]&&ie(o);return{c(){n&&n.c(),e=Z()},m(t,l){n&&n.m(t,l),h(t,e,l)},p(t,[l]){t[13]?n&&(n.d(1),n=null):n?n.p(t,l):(n=ie(t),n.c(),n.m(e.parentNode,e))},i:I,o:I,d(t){n&&n.d(t),t&&z(e)}}}function R(o,e){return Math.random()*(e-o)+o}function Te(o,e,n){let{size:t=10}=e,{x:l=[-.5,.5]}=e,{y:s=[.25,1]}=e,{duration:i=2e3}=e,{infinite:a=!1}=e,{delay:u=[0,50]}=e,{colorRange:m=[0,360]}=e,{colorArray:r=[]}=e,{amount:d=50}=e,{iterationCount:_=1}=e,{fallDistance:p="100px"}=e,{rounded:g=!1}=e,{cone:k=!1}=e,{noGravity:y=!1}=e,{xSpread:U=.15}=e,{destroyOnComplete:O=!0}=e,T=!1;he(()=>{!O||a||_=="infinite"||setTimeout(()=>n(13,T=!0),(i+u[1])*_)});function M(){return r.length?r[Math.round(Math.random()*(r.length-1))]:`hsl(${Math.round(R(m[0],m[1]))}, 75%, 50%`}return o.$$set=f=>{"size"in f&&n(0,t=f.size),"x"in f&&n(1,l=f.x),"y"in f&&n(2,s=f.y),"duration"in f&&n(3,i=f.duration),"infinite"in f&&n(4,a=f.infinite),"delay"in f&&n(5,u=f.delay),"colorRange"in f&&n(15,m=f.colorRange),"colorArray"in f&&n(16,r=f.colorArray),"amount"in f&&n(6,d=f.amount),"iterationCount"in f&&n(7,_=f.iterationCount),"fallDistance"in f&&n(8,p=f.fallDistance),"rounded"in f&&n(9,g=f.rounded),"cone"in f&&n(10,k=f.cone),"noGravity"in f&&n(11,y=f.noGravity),"xSpread"in f&&n(12,U=f.xSpread),"destroyOnComplete"in f&&n(17,O=f.destroyOnComplete)},[t,l,s,i,a,u,d,_,p,g,k,y,U,T,M,m,r,O]}class De extends F{constructor(e){super(),Q(this,e,Te,Me,V,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function re(o,e,n){const t=o.slice();return t[7]=e[n],t}function Oe(o){let e=o[7].message+"",n;return{c(){n=W(e)},m(t,l){h(t,n,l)},p(t,l){l&1&&e!==(e=t[7].message+"")&&X(n,e)},d(t){t&&z(n)}}}function Ae(o){let e;return{c(){e=W(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
          labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
          laboris nisi ut aliquip ex ea commodo consequat.`)},m(n,t){h(n,e,t)},p:I,d(n){n&&z(e)}}}function ue(o){let e,n,t;function l(){return o[6](o[7])}return{c(){e=v("button"),e.textContent="Reveal this hint",w(e,"class","svelte-1byopfc")},m(s,i){h(s,e,i),n||(t=j(e,"click",l),n=!0)},p(s,i){o=s},d(s){s&&z(e),n=!1,t()}}}function ae(o,e){let n,t=e[7].title+"",l,s,i,a,u,m,r;function d(k,y){return k[7].locked?Ae:Oe}let _=d(e),p=_(e),g=e[7].locked&&ue(e);return{key:o,first:null,c(){n=v("h4"),l=W(t),s=P(),i=v("div"),a=v("p"),p.c(),m=P(),g&&g.c(),r=P(),w(n,"class","svelte-1byopfc"),w(a,"class",u=ee(e[7].locked?"locked":"")+" svelte-1byopfc"),w(i,"class","svelte-1byopfc"),this.first=n},m(k,y){h(k,n,y),q(n,l),h(k,s,y),h(k,i,y),q(i,a),p.m(a,null),q(i,m),g&&g.m(i,null),q(i,r)},p(k,y){e=k,y&1&&t!==(t=e[7].title+"")&&X(l,t),_===(_=d(e))&&p?p.p(e,y):(p.d(1),p=_(e),p&&(p.c(),p.m(a,null))),y&1&&u!==(u=ee(e[7].locked?"locked":"")+" svelte-1byopfc")&&w(a,"class",u),e[7].locked?g?g.p(e,y):(g=ue(e),g.c(),g.m(i,r)):g&&(g.d(1),g=null)},d(k){k&&z(n),k&&z(s),k&&z(i),p.d(),g&&g.d()}}}function Ee(o){let e,n,t,l,s=[],i=new Map,a;t=new _e({props:{options:o[2]}});let u=o[0];const m=r=>r[7].id;for(let r=0;r<u.length;r+=1){let d=re(o,u,r),_=m(d);i.set(_,s[r]=ae(_,d))}return{c(){e=v("section"),n=v("p"),A(t.$$.fragment),l=P();for(let r=0;r<s.length;r+=1)s[r].c();w(e,"class","svelte-1byopfc")},m(r,d){h(r,e,d),q(e,n),E(t,n,null),q(e,l);for(let _=0;_<s.length;_+=1)s[_].m(e,null);a=!0},p(r,[d]){d&3&&(u=r[0],s=be(s,d,m,1,r,u,i,e,pe,ae,null,re))},i(r){a||(N(t.$$.fragment,r),a=!0)},o(r){G(t.$$.fragment,r),a=!1},d(r){r&&z(e),H(t);for(let d=0;d<s.length;d+=1)s[d].d()}}}function He(o,e,n){let{gameCode:t=""}=e,{puzzleId:l=0}=e;const s=async()=>{const r=await L(t),{data:d,error:_}=await r.rpc("gethints",{puzzleid:l,gamecode:t});if(_)throw _;n(0,a=d)},i=async function(r){await(await L(t)).rpc("requesthint",{puzzleid:l,gamecode:t,hintid:r})};let a=[];const u=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],m=r=>i(r.id);return o.$$set=r=>{"gameCode"in r&&n(3,t=r.gameCode),"puzzleId"in r&&n(4,l=r.puzzleId)},o.$$.update=()=>{o.$$.dirty&24&&t&&l&&s()},[a,i,u,t,l,s,m]}class Ue extends F{constructor(e){super(),Q(this,e,He,Ee,V,{gameCode:3,puzzleId:4,refresh:5})}get refresh(){return this.$$.ctx[5]}}function Be(o){let e,n;return e=new Ie({props:{error:o[4]}}),{c(){A(e.$$.fragment)},m(t,l){E(e,t,l),n=!0},p:I,i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function We(o){let e,n=o[0]+"",t;return{c(){e=new ve(!1),t=Z(),e.a=t},m(l,s){e.m(n,l,s),h(l,t,s)},p:I,i:I,o:I,d(l){l&&z(t),l&&e.d()}}}function Ye(o){let e,n;return e=new ge({}),{c(){A(e.$$.fragment)},m(t,l){E(e,t,l),n=!0},p:I,i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function je(o){let e,n,t={ctx:o,current:null,token:null,hasCatch:!0,pending:Ye,then:We,catch:Be,value:0,error:4,blocks:[,,,]};return ke(o[0],t),{c(){e=Z(),t.block.c()},m(l,s){h(l,e,s),t.block.m(l,t.anchor=s),t.mount=()=>e.parentNode,t.anchor=e,n=!0},p(l,[s]){o=l,ye(t,o,s)},i(l){n||(N(t.block),n=!0)},o(l){for(let s=0;s<3;s+=1){const i=t.blocks[s];G(i)}n=!1},d(l){l&&z(e),t.block.d(l),t.token=null,t=null}}}const fe=/\$[^$]+?\$/g;function Le(o,e,n){let{gameCode:t=""}=e,{storageSlug:l=""}=e,{content:s=""}=e,i=Promise.all([L(t),l,s]).then(([a,u,m])=>{const r=m.match(fe)||[];return Promise.all([m,...r.map(d=>d.substring(1,d.length-1)).map(d=>a.storage.from("puzzles").createSignedUrl(`${u}/${d}`,60*60).then(({data:{signedUrl:_},error:p})=>{if(p)throw p;return _}))])}).then(([a,...u])=>a.replace(fe,()=>u.shift()));return o.$$set=a=>{"gameCode"in a&&n(1,t=a.gameCode),"storageSlug"in a&&n(2,l=a.storageSlug),"content"in a&&n(3,s=a.content)},[i,t,l,s]}class Fe extends F{constructor(e){super(),Q(this,e,Le,je,V,{gameCode:1,storageSlug:2,content:3})}}function Qe(o){let e,n,t,l,s,i,a,u,m,r;return{c(){e=v("section"),n=v("form"),t=v("fieldset"),l=v("legend"),l.textContent="Enter a guess",s=P(),i=v("input"),a=P(),u=v("input"),w(i,"type","text"),i.disabled=o[1],w(i,"class","svelte-yphylg"),w(u,"type","submit"),u.value="Submit",u.disabled=o[1],w(t,"class","svelte-yphylg")},m(d,_){h(d,e,_),q(e,n),q(n,t),q(t,l),q(t,s),q(t,i),te(i,o[0]),q(t,a),q(t,u),m||(r=[j(i,"input",o[5]),j(n,"submit",Ce(o[2]))],m=!0)},p(d,[_]){_&2&&(i.disabled=d[1]),_&1&&i.value!==d[0]&&te(i,d[0]),_&2&&(u.disabled=d[1])},i:I,o:I,d(d){d&&z(e),m=!1,we(r)}}}function Ve(o,e,n){let{puzzle:t=0}=e,{gameCode:l=""}=e,s="",i=!1;const a=async()=>{n(1,i=!0),await L(l).then(m=>m.from("guesses").insert({content:s,puzzle:t,game:l}).throwOnError()).then(()=>n(0,s="")).finally(()=>n(1,i=!1))};function u(){s=this.value,n(0,s)}return o.$$set=m=>{"puzzle"in m&&n(3,t=m.puzzle),"gameCode"in m&&n(4,l=m.gameCode)},[s,i,a,t,l,u]}class Ze extends F{constructor(e){super(),Q(this,e,Ve,Qe,V,{puzzle:3,gameCode:4})}}function Je(o){let e,n=o[1].adventure.name+"",t,l,s=o[1].title+"",i,a,u,m,r,d,_,p,g,k,y,U,O,T,M;u=new Fe({props:{gameCode:o[0].code,storageSlug:o[1].storage_slug,content:o[1].content}}),r=new Ze({props:{gameCode:o[0].code,puzzle:o[0].puzzle}});let f={gameCode:o[0].code,puzzleId:o[0].puzzle};_=new Ue({props:f}),o[8](_),y=new _e({props:{options:o[7]}});function Y(c,b){return c[1].next?xe:Xe}let J=Y(o),D=J(o),S=o[2]&&ce();return{c(){e=v("h2"),t=W(n),l=W(": "),i=W(s),a=P(),A(u.$$.fragment),m=P(),A(r.$$.fragment),d=P(),A(_.$$.fragment),p=P(),g=v("dialog"),k=v("h3"),A(y.$$.fragment),U=P(),D.c(),O=P(),S&&S.c(),T=Z(),w(k,"class","svelte-164yvqq"),g.open=o[2],w(g,"class","svelte-164yvqq")},m(c,b){h(c,e,b),q(e,t),q(e,l),q(e,i),h(c,a,b),E(u,c,b),h(c,m,b),E(r,c,b),h(c,d,b),E(_,c,b),h(c,p,b),h(c,g,b),q(g,k),E(y,k,null),q(g,U),D.m(g,null),h(c,O,b),S&&S.m(c,b),h(c,T,b),M=!0},p(c,b){(!M||b&2)&&n!==(n=c[1].adventure.name+"")&&X(t,n),(!M||b&2)&&s!==(s=c[1].title+"")&&X(i,s);const K={};b&1&&(K.gameCode=c[0].code),b&2&&(K.storageSlug=c[1].storage_slug),b&2&&(K.content=c[1].content),u.$set(K);const x={};b&1&&(x.gameCode=c[0].code),b&1&&(x.puzzle=c[0].puzzle),r.$set(x);const $={};b&1&&($.gameCode=c[0].code),b&1&&($.puzzleId=c[0].puzzle),_.$set($),J===(J=Y(c))&&D?D.p(c,b):(D.d(1),D=J(c),D&&(D.c(),D.m(g,null))),(!M||b&4)&&(g.open=c[2]),c[2]?S?b&4&&N(S,1):(S=ce(),S.c(),N(S,1),S.m(T.parentNode,T)):S&&(me(),G(S,1,1,()=>{S=null}),de())},i(c){M||(N(u.$$.fragment,c),N(r.$$.fragment,c),N(_.$$.fragment,c),N(y.$$.fragment,c),N(S),M=!0)},o(c){G(u.$$.fragment,c),G(r.$$.fragment,c),G(_.$$.fragment,c),G(y.$$.fragment,c),G(S),M=!1},d(c){c&&z(e),c&&z(a),H(u,c),c&&z(m),H(r,c),c&&z(d),o[8](null),H(_,c),c&&z(p),c&&z(g),H(y),D.d(),c&&z(O),S&&S.d(c),c&&z(T)}}}function Ke(o){let e,n;return e=new ge({}),{c(){A(e.$$.fragment)},m(t,l){E(e,t,l),n=!0},p:I,i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function Xe(o){let e,n,t,l,s;return{c(){e=v("p"),e.textContent="You have completed the adventure!",n=P(),t=v("button"),t.textContent="Continue \xBB",w(e,"class","svelte-164yvqq"),w(t,"class","svelte-164yvqq")},m(i,a){h(i,e,a),h(i,n,a),h(i,t,a),l||(s=j(t,"click",o[10]),l=!0)},p:I,d(i){i&&z(e),i&&z(n),i&&z(t),l=!1,s()}}}function xe(o){let e,n,t,l,s;return{c(){e=v("p"),e.textContent="You have completed this step in the adventure!",n=P(),t=v("button"),t.textContent="Next puzzle \xBB",w(e,"class","svelte-164yvqq"),w(t,"class","svelte-164yvqq")},m(i,a){h(i,e,a),h(i,n,a),h(i,t,a),l||(s=j(t,"click",o[9]),l=!0)},p:I,d(i){i&&z(e),i&&z(n),i&&z(t),l=!1,s()}}}function ce(o){let e,n,t;return n=new De({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=v("div"),A(n.$$.fragment),w(e,"class","confetti-bg svelte-164yvqq")},m(l,s){h(l,e,s),E(n,e,null),t=!0},i(l){t||(N(n.$$.fragment,l),t=!0)},o(l){G(n.$$.fragment,l),t=!1},d(l){l&&z(e),H(n)}}}function $e(o){let e,n,t,l;const s=[Ke,Je],i=[];function a(u,m){return u[3]?0:1}return e=a(o),n=i[e]=s[e](o),{c(){n.c(),t=Z()},m(u,m){i[e].m(u,m),h(u,t,m),l=!0},p(u,[m]){let r=e;e=a(u),e===r?i[e].p(u,m):(me(),G(i[r],1,1,()=>{i[r]=null}),de(),n=i[e],n?n.p(u,m):(n=i[e]=s[e](u),n.c()),N(n,1),n.m(t.parentNode,t))},i(u){l||(N(n),l=!0)},o(u){G(n),l=!1},d(u){i[e].d(u),u&&z(t)}}}function et(o,e,n){let t,l;ne(o,Re,f=>n(0,t=f)),ne(o,Pe,f=>n(12,l=f));let s={},i=!1,a=!0,u=null,m;le.set("Puzzad: Loading...");const r=()=>{d(),L(t.code).then(f=>f.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",t.puzzle).throwOnError()).then(_).then(f=>n(1,s=f)).then(()=>{le.set("Puzzad: "+s.adventure.name+": "+s.title),p(),n(3,a=!1)}).catch(()=>l("/games/[code]",{code:t.code}))},d=()=>{console.log("Resetting..."),n(3,a=!0),n(2,i=!1)},_=({data:f,error:Y})=>{if(Y)throw Y;if(f.length===0)throw"Puzzle not found";return f[0]};qe(function(){u&&u.disconnect()});const p=async function(){u||(u=await Ne(t.code),await u.channel("public:guesses:game=eq."+t.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+t.code},g).subscribe())},g=function(f){f.record.puzzle.toString()===t.puzzle&&(f.record.content==="*hint"?m.refresh():f.record.correct?n(2,i=!0):Ge.add({title:"Incorrect guess",description:f.record.content,duration:1e4,type:"error"}))},k=async function(){l("/games/[code]/[puzzle]",{code:t.code,puzzle:s.next})},y=async function(){l("/games/[code]",{code:t.code})},U=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function O(f){Se[f?"unshift":"push"](()=>{m=f,n(4,m)})}const T=()=>k(),M=()=>y();return o.$$.update=()=>{o.$$.dirty&1&&t.puzzle&&t.code&&r()},[t,s,i,a,m,k,y,U,O,T,M]}class at extends F{constructor(e){super(),Q(this,e,et,$e,V,{})}}export{at as default};
