import{S as be,i as ke,s as pe,e as re,a as g,n as ee,d as b,o as Ce,h as k,r as y,E as Q,k as ze,v as p,g as ve,t as Y,c as ye,b as E,F as we,D as qe,G as le,x as $,j as w,l as oe,w as v,H as fe,m as ie,C as te,I as Me,y as se,p as ae,J as Se,K as Ge}from"./index.3b3570c3.js";import{S as Ne}from"./Spinner.15d3d1cf.js";import{t as Re,T as Te,F as De}from"./FlatToast.f8a9fb93.js";function ce(l,e,t){const n=l.slice();return n[18]=e[t],n}function me(l){let e,t={length:l[6]},n=[];for(let s=0;s<t.length;s+=1)n[s]=de(ce(l,t,s));return{c(){e=k("div");for(let s=0;s<n.length;s+=1)n[s].c();y(e,"class","confetti-holder svelte-io58ff"),Q(e,"rounded",l[9]),Q(e,"cone",l[10]),Q(e,"no-gravity",l[11])},m(s,a){g(s,e,a);for(let i=0;i<n.length;i+=1)n[i].m(e,null)},p(s,a){if(a&20991){t={length:s[6]};let i;for(i=0;i<t.length;i+=1){const m=ce(s,t,i);n[i]?n[i].p(m,a):(n[i]=de(m),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}a&512&&Q(e,"rounded",s[9]),a&1024&&Q(e,"cone",s[10]),a&2048&&Q(e,"no-gravity",s[11])},d(s){s&&b(e),ze(n,s)}}}function de(l){let e;return{c(){e=k("div"),y(e,"class","confetti svelte-io58ff"),p(e,"--fall-distance",l[8]),p(e,"--size",l[0]+"px"),p(e,"--color",l[14]()),p(e,"--skew",q(-45,45)+"deg,"+q(-45,45)+"deg"),p(e,"--rotation-xyz",q(-10,10)+", "+q(-10,10)+", "+q(-10,10)),p(e,"--rotation-deg",q(0,360)+"deg"),p(e,"--translate-y-multiplier",q(l[2][0],l[2][1])),p(e,"--translate-x-multiplier",q(l[1][0],l[1][1])),p(e,"--scale",.1*q(2,10)),p(e,"--transition-duration",l[4]?`calc(${l[3]}ms * var(--scale))`:`${l[3]}ms`),p(e,"--transition-delay",q(l[5][0],l[5][1])+"ms"),p(e,"--transition-iteration-count",l[4]?"infinite":l[7]),p(e,"--x-spread",1-l[12])},m(t,n){g(t,e,n)},p(t,n){n&256&&p(e,"--fall-distance",t[8]),n&1&&p(e,"--size",t[0]+"px"),n&4&&p(e,"--translate-y-multiplier",q(t[2][0],t[2][1])),n&2&&p(e,"--translate-x-multiplier",q(t[1][0],t[1][1])),n&24&&p(e,"--transition-duration",t[4]?`calc(${t[3]}ms * var(--scale))`:`${t[3]}ms`),n&32&&p(e,"--transition-delay",q(t[5][0],t[5][1])+"ms"),n&144&&p(e,"--transition-iteration-count",t[4]?"infinite":t[7]),n&4096&&p(e,"--x-spread",1-t[12])},d(t){t&&b(e)}}}function Pe(l){let e,t=!l[13]&&me(l);return{c(){t&&t.c(),e=re()},m(n,s){t&&t.m(n,s),g(n,e,s)},p(n,[s]){n[13]?t&&(t.d(1),t=null):t?t.p(n,s):(t=me(n),t.c(),t.m(e.parentNode,e))},i:ee,o:ee,d(n){t&&t.d(n),n&&b(e)}}}function q(l,e){return Math.random()*(e-l)+l}function He(l,e,t){let{size:n=10}=e,{x:s=[-.5,.5]}=e,{y:a=[.25,1]}=e,{duration:i=2e3}=e,{infinite:m=!1}=e,{delay:u=[0,50]}=e,{colorRange:r=[0,360]}=e,{colorArray:d=[]}=e,{amount:R=50}=e,{iterationCount:I=1}=e,{fallDistance:M="100px"}=e,{rounded:F=!1}=e,{cone:j=!1}=e,{noGravity:C=!1}=e,{xSpread:O=.15}=e,{destroyOnComplete:T=!0}=e,W=!1;Ce(()=>{!T||m||I=="infinite"||setTimeout(()=>t(13,W=!0),(i+u[1])*I)});function S(){return d.length?d[Math.round(Math.random()*(d.length-1))]:`hsl(${Math.round(q(r[0],r[1]))}, 75%, 50%`}return l.$$set=f=>{"size"in f&&t(0,n=f.size),"x"in f&&t(1,s=f.x),"y"in f&&t(2,a=f.y),"duration"in f&&t(3,i=f.duration),"infinite"in f&&t(4,m=f.infinite),"delay"in f&&t(5,u=f.delay),"colorRange"in f&&t(15,r=f.colorRange),"colorArray"in f&&t(16,d=f.colorArray),"amount"in f&&t(6,R=f.amount),"iterationCount"in f&&t(7,I=f.iterationCount),"fallDistance"in f&&t(8,M=f.fallDistance),"rounded"in f&&t(9,F=f.rounded),"cone"in f&&t(10,j=f.cone),"noGravity"in f&&t(11,C=f.noGravity),"xSpread"in f&&t(12,O=f.xSpread),"destroyOnComplete"in f&&t(17,T=f.destroyOnComplete)},[n,s,a,i,m,u,R,I,M,F,j,C,O,W,S,r,d,T]}class Ie extends be{constructor(e){super(),ke(this,e,He,Pe,pe,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function _e(l,e,t){const n=l.slice();return n[30]=e[t],n}function Ue(l){let e,t=l[5].adventure.name+"",n,s,a=l[5].title+"",i,m,u,r=l[5].content+"",d,R,I,M,F,j,C,O,T,W,S,f,V,J,G,K,X,Z,B,U,D,x,ne,c=l[4],h=[];for(let o=0;o<c.length;o+=1)h[o]=he(_e(l,c,o));function A(o,_){return o[5].next?We:Oe}let N=A(l),P=N(l),z=l[1]&&ge();return U=new Te({props:{placement:"bottom-right",theme:"dark",$$slots:{default:[Ye,({data:o})=>({5:o}),({data:o})=>[o?32:0]]},$$scope:{ctx:l}}}),{c(){e=k("h2"),n=$(t),s=$(": "),i=$(a),m=w(),u=new Ge(!1),d=w(),R=k("section"),I=k("form"),M=k("fieldset"),F=k("legend"),F.textContent="Enter a guess",j=w(),C=k("input"),O=w(),T=k("input"),W=w(),S=k("section"),f=k("p"),f.textContent=`${l[10]}`,V=w();for(let o=0;o<h.length;o+=1)h[o].c();J=w(),G=k("dialog"),K=k("h3"),K.textContent=`${l[11]}`,X=w(),P.c(),Z=w(),z&&z.c(),B=w(),oe(U.$$.fragment),u.a=d,y(C,"type","text"),C.disabled=l[2],y(C,"class","svelte-1q6443e"),y(T,"type","submit"),T.value="Submit",T.disabled=l[2],y(M,"class","svelte-1q6443e"),y(R,"class","answer svelte-1q6443e"),y(S,"class","hints svelte-1q6443e"),y(K,"class","svelte-1q6443e"),G.open=l[1],y(G,"class","svelte-1q6443e")},m(o,_){g(o,e,_),v(e,n),v(e,s),v(e,i),g(o,m,_),u.m(r,o,_),g(o,d,_),g(o,R,_),v(R,I),v(I,M),v(M,F),v(M,j),v(M,C),fe(C,l[0]),v(M,O),v(M,T),g(o,W,_),g(o,S,_),v(S,f),v(S,V);for(let L=0;L<h.length;L+=1)h[L].m(S,null);g(o,J,_),g(o,G,_),v(G,K),v(G,X),P.m(G,null),g(o,Z,_),z&&z.m(o,_),g(o,B,_),ie(U,o,_),D=!0,x||(ne=[te(C,"input",l[13]),te(I,"submit",Me(l[14]))],x=!0)},p(o,_){if((!D||_[0]&32)&&t!==(t=o[5].adventure.name+"")&&se(n,t),(!D||_[0]&32)&&a!==(a=o[5].title+"")&&se(i,a),(!D||_[0]&32)&&r!==(r=o[5].content+"")&&u.p(r),(!D||_[0]&4)&&(C.disabled=o[2]),_[0]&1&&C.value!==o[0]&&fe(C,o[0]),(!D||_[0]&4)&&(T.disabled=o[2]),_[0]&144){c=o[4];let H;for(H=0;H<c.length;H+=1){const ue=_e(o,c,H);h[H]?h[H].p(ue,_):(h[H]=he(ue),h[H].c(),h[H].m(S,null))}for(;H<h.length;H+=1)h[H].d(1);h.length=c.length}N===(N=A(o))&&P?P.p(o,_):(P.d(1),P=N(o),P&&(P.c(),P.m(G,null))),(!D||_[0]&2)&&(G.open=o[1]),o[1]?z?_[0]&2&&E(z,1):(z=ge(),z.c(),E(z,1),z.m(B.parentNode,B)):z&&(ve(),Y(z,1,1,()=>{z=null}),ye());const L={};_[0]&32|_[1]&4&&(L.$$scope={dirty:_,ctx:o}),U.$set(L)},i(o){D||(E(z),E(U.$$.fragment,o),D=!0)},o(o){Y(z),Y(U.$$.fragment,o),D=!1},d(o){o&&b(e),o&&b(m),o&&u.d(),o&&b(d),o&&b(R),o&&b(W),o&&b(S),ze(h,o),o&&b(J),o&&b(G),P.d(),o&&b(Z),z&&z.d(o),o&&b(B),ae(U,o),x=!1,Se(ne)}}}function Ae(l){let e,t;return e=new Ne({}),{c(){oe(e.$$.fragment)},m(n,s){ie(e,n,s),t=!0},p:ee,i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ae(e,n)}}}function Ee(l){let e,t=l[30].message+"",n;return{c(){e=k("p"),n=$(t)},m(s,a){g(s,e,a),v(e,n)},p(s,a){a[0]&16&&t!==(t=s[30].message+"")&&se(n,t)},d(s){s&&b(e)}}}function Fe(l){let e,t,n,s,a,i,m;function u(){return l[15](l[30])}return{c(){e=k("div"),t=k("p"),t.textContent=`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                        labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                        laboris nisi ut aliquip ex ea commodo consequat.`,n=w(),s=k("button"),s.textContent="Reveal this hint",a=w(),y(t,"class","svelte-1q6443e"),y(s,"class","svelte-1q6443e"),y(e,"class","locked svelte-1q6443e")},m(r,d){g(r,e,d),v(e,t),v(e,n),v(e,s),v(e,a),i||(m=te(s,"click",u),i=!0)},p(r,d){l=r},d(r){r&&b(e),i=!1,m()}}}function he(l){let e,t=l[30].title+"",n,s,a;function i(r,d){return r[30].locked?Fe:Ee}let m=i(l),u=m(l);return{c(){e=k("h4"),n=$(t),s=w(),u.c(),a=re(),y(e,"class","svelte-1q6443e")},m(r,d){g(r,e,d),v(e,n),g(r,s,d),u.m(r,d),g(r,a,d)},p(r,d){d[0]&16&&t!==(t=r[30].title+"")&&se(n,t),m===(m=i(r))&&u?u.p(r,d):(u.d(1),u=m(r),u&&(u.c(),u.m(a.parentNode,a)))},d(r){r&&b(e),r&&b(s),u.d(r),r&&b(a)}}}function Oe(l){let e,t,n,s,a;return{c(){e=k("p"),e.textContent="You have completed the adventure!",t=w(),n=k("button"),n.textContent="Continue \xBB",y(e,"class","svelte-1q6443e"),y(n,"class","svelte-1q6443e")},m(i,m){g(i,e,m),g(i,t,m),g(i,n,m),s||(a=te(n,"click",l[17]),s=!0)},p:ee,d(i){i&&b(e),i&&b(t),i&&b(n),s=!1,a()}}}function We(l){let e,t,n,s,a;return{c(){e=k("p"),e.textContent="You have completed this step in the adventure!",t=w(),n=k("button"),n.textContent="Next puzzle \xBB",y(e,"class","svelte-1q6443e"),y(n,"class","svelte-1q6443e")},m(i,m){g(i,e,m),g(i,t,m),g(i,n,m),s||(a=te(n,"click",l[16]),s=!0)},p:ee,d(i){i&&b(e),i&&b(t),i&&b(n),s=!1,a()}}}function ge(l){let e,t,n;return t=new Ie({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=k("div"),oe(t.$$.fragment),y(e,"class","confetti-bg svelte-1q6443e")},m(s,a){g(s,e,a),ie(t,e,null),n=!0},i(s){n||(E(t.$$.fragment,s),n=!0)},o(s){Y(t.$$.fragment,s),n=!1},d(s){s&&b(e),ae(t)}}}function Ye(l){let e,t;return e=new De({props:{data:l[5]}}),{c(){oe(e.$$.fragment)},m(n,s){ie(e,n,s),t=!0},p(n,s){const a={};s[0]&32&&(a.data=n[5]),e.$set(a)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){ae(e,n)}}}function je(l){let e,t,n,s;const a=[Ae,Ue],i=[];function m(u,r){return u[3]?0:1}return e=m(l),t=i[e]=a[e](l),{c(){t.c(),n=re()},m(u,r){i[e].m(u,r),g(u,n,r),s=!0},p(u,r){let d=e;e=m(u),e===d?i[e].p(u,r):(ve(),Y(i[d],1,1,()=>{i[d]=null}),ye(),t=i[e],t?t.p(u,r):(t=i[e]=a[e](u),t.c()),E(t,1),t.m(n.parentNode,n))},i(u){s||(E(t),s=!0)},o(u){Y(t),s=!1},d(u){i[e].d(u),u&&b(n)}}}function Be(l,e,t){let{params:n={}}=e,s={},a="",i=!1,m=!1,u=!0,r=null,d=null,R=[];const I=()=>{try{M(),qe(n.code).then(c=>(d=c,c.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",n.puzzle))).then(F).then(j).then(C).then(c=>t(5,s=c)).then(()=>{r||T(),t(3,u=!1)}).then(O).catch(()=>le("/game/"+n.code))}catch{le("/game/"+n.code)}},M=()=>{console.log("Resetting..."),t(3,u=!0),t(1,i=!1),t(0,a=""),t(2,m=!1),t(4,R=[])},F=({data:c,error:h})=>{if(h)throw h;if(c.length===0)throw"Puzzle not found";return c[0]},j=c=>{let h=[c];const A=c.content.match(/\$[^$]+?\$/g);return A&&A.forEach(N=>{h.push(N,d.storage.from("puzzles").createSignedUrl(c.storage_slug+"/"+N.substring(1,N.length-1),60*60))}),Promise.all(h)},C=c=>{let[h,...A]=c;for(let N=0;N<A.length;N+=2){const{data:{signedUrl:P},error:z}=A[N+1];if(z)throw z;h.content=h.content.replace(A[N],P)}return h},O=async()=>{const{data:c,error:h}=await d.rpc("gethints",{puzzleid:n.puzzle,gamecode:n.code});if(h)throw h;t(4,R=c)};we(async function(){r&&await d.removeChannel(r)});const T=async function(){r=await d.channel("public:guesses:game=eq."+n.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+n.code},W).subscribe()},W=function(c){c.new.puzzle.toString()===n.puzzle&&(c.new.content==="*hint"?O():c.new.correct?t(1,i=!0):Re.add({title:"Incorrect guess",description:c.new.content,duration:1e4,type:"error"}))},S=async function(){t(2,m=!0),await d.from("guesses").insert({content:a,puzzle:n.puzzle,game:n.code}),t(2,m=!1),t(0,a="")},f=async function(c){await d.rpc("requesthint",{puzzleid:n.puzzle,gamecode:n.code,hintid:c})},V=async function(){await le("/game/"+n.code+"/"+s.next)},J=async function(){await le("/game/"+n.code)},G=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],K=G[Math.floor(Math.random()*G.length)],X=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"],Z=X[Math.floor(Math.random()*X.length)];function B(){a=this.value,t(0,a)}const U=()=>S(),D=c=>f(c.id),x=()=>V(),ne=()=>J();return l.$$set=c=>{"params"in c&&t(12,n=c.params)},l.$$.update=()=>{l.$$.dirty[0]&4096&&n.code&&n.puzzle&&I()},[a,i,m,u,R,s,S,f,V,J,K,Z,n,B,U,D,x,ne]}class Qe extends be{constructor(e){super(),ke(this,e,Be,je,pe,{params:12},null,[-1,-1])}}export{Qe as default};
