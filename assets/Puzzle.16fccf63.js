import{S as fe,i as ce,s as me,b as Se,c as h,n as V,f as z,F as Me,e as v,w as I,H as J,m as Ne,x as C,o as W,a as T,y as S,p as Y,I as Pe,J as De,t as D,d as H,q as j,A as K,K as ge,B as ie,G as re,E as $,k as qe,l as Ge,j as he,L as Ae,M as le,N as He,r as ue,v as ze,O as pe,P as Oe,z as ke,Q as Ue,R as Ee}from"./index.80ca9f16.js";import{R as Te}from"./RandomText.df9d9223.js";import{S as Fe}from"./Spinner.0421d1f1.js";import{t as Be,T as Le,F as We}from"./FlatToast.f8a490e0.js";function be(l,e,t){const n=l.slice();return n[18]=e[t],n}function ye(l){let e,t={length:l[6]},n=[];for(let i=0;i<t.length;i+=1)n[i]=ve(be(l,t,i));return{c(){e=v("div");for(let i=0;i<n.length;i+=1)n[i].c();I(e,"class","confetti-holder svelte-io58ff"),J(e,"rounded",l[9]),J(e,"cone",l[10]),J(e,"no-gravity",l[11])},m(i,a){h(i,e,a);for(let s=0;s<n.length;s+=1)n[s].m(e,null)},p(i,a){if(a&20991){t={length:i[6]};let s;for(s=0;s<t.length;s+=1){const u=be(i,t,s);n[s]?n[s].p(u,a):(n[s]=ve(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}a&512&&J(e,"rounded",i[9]),a&1024&&J(e,"cone",i[10]),a&2048&&J(e,"no-gravity",i[11])},d(i){i&&z(e),Ne(n,i)}}}function ve(l){let e;return{c(){e=v("div"),I(e,"class","confetti svelte-io58ff"),C(e,"--fall-distance",l[8]),C(e,"--size",l[0]+"px"),C(e,"--color",l[14]()),C(e,"--skew",M(-45,45)+"deg,"+M(-45,45)+"deg"),C(e,"--rotation-xyz",M(-10,10)+", "+M(-10,10)+", "+M(-10,10)),C(e,"--rotation-deg",M(0,360)+"deg"),C(e,"--translate-y-multiplier",M(l[2][0],l[2][1])),C(e,"--translate-x-multiplier",M(l[1][0],l[1][1])),C(e,"--scale",.1*M(2,10)),C(e,"--transition-duration",l[4]?`calc(${l[3]}ms * var(--scale))`:`${l[3]}ms`),C(e,"--transition-delay",M(l[5][0],l[5][1])+"ms"),C(e,"--transition-iteration-count",l[4]?"infinite":l[7]),C(e,"--x-spread",1-l[12])},m(t,n){h(t,e,n)},p(t,n){n&256&&C(e,"--fall-distance",t[8]),n&1&&C(e,"--size",t[0]+"px"),n&4&&C(e,"--translate-y-multiplier",M(t[2][0],t[2][1])),n&2&&C(e,"--translate-x-multiplier",M(t[1][0],t[1][1])),n&24&&C(e,"--transition-duration",t[4]?`calc(${t[3]}ms * var(--scale))`:`${t[3]}ms`),n&32&&C(e,"--transition-delay",M(t[5][0],t[5][1])+"ms"),n&144&&C(e,"--transition-iteration-count",t[4]?"infinite":t[7]),n&4096&&C(e,"--x-spread",1-t[12])},d(t){t&&z(e)}}}function Ye(l){let e,t=!l[13]&&ye(l);return{c(){t&&t.c(),e=Se()},m(n,i){t&&t.m(n,i),h(n,e,i)},p(n,[i]){n[13]?t&&(t.d(1),t=null):t?t.p(n,i):(t=ye(n),t.c(),t.m(e.parentNode,e))},i:V,o:V,d(n){t&&t.d(n),n&&z(e)}}}function M(l,e){return Math.random()*(e-l)+l}function je(l,e,t){let{size:n=10}=e,{x:i=[-.5,.5]}=e,{y:a=[.25,1]}=e,{duration:s=2e3}=e,{infinite:u=!1}=e,{delay:f=[0,50]}=e,{colorRange:_=[0,360]}=e,{colorArray:r=[]}=e,{amount:d=50}=e,{iterationCount:p=1}=e,{fallDistance:b="100px"}=e,{rounded:y=!1}=e,{cone:R=!1}=e,{noGravity:k=!1}=e,{xSpread:B=.15}=e,{destroyOnComplete:N=!0}=e,E=!1;Me(()=>{!N||u||p=="infinite"||setTimeout(()=>t(13,E=!0),(s+f[1])*p)});function G(){return r.length?r[Math.round(Math.random()*(r.length-1))]:`hsl(${Math.round(M(_[0],_[1]))}, 75%, 50%`}return l.$$set=c=>{"size"in c&&t(0,n=c.size),"x"in c&&t(1,i=c.x),"y"in c&&t(2,a=c.y),"duration"in c&&t(3,s=c.duration),"infinite"in c&&t(4,u=c.infinite),"delay"in c&&t(5,f=c.delay),"colorRange"in c&&t(15,_=c.colorRange),"colorArray"in c&&t(16,r=c.colorArray),"amount"in c&&t(6,d=c.amount),"iterationCount"in c&&t(7,p=c.iterationCount),"fallDistance"in c&&t(8,b=c.fallDistance),"rounded"in c&&t(9,y=c.rounded),"cone"in c&&t(10,R=c.cone),"noGravity"in c&&t(11,k=c.noGravity),"xSpread"in c&&t(12,B=c.xSpread),"destroyOnComplete"in c&&t(17,N=c.destroyOnComplete)},[n,i,a,s,u,f,d,p,b,y,R,k,B,E,G,_,r,N]}class Qe extends fe{constructor(e){super(),ce(this,e,je,Ye,me,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function Ce(l,e,t){const n=l.slice();return n[7]=e[t],n}function Je(l){let e=l[7].message+"",t;return{c(){t=K(e)},m(n,i){h(n,t,i)},p(n,i){i&1&&e!==(e=n[7].message+"")&&ie(t,e)},d(n){n&&z(t)}}}function Ke(l){let e;return{c(){e=K(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                    labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                    laboris nisi ut aliquip ex ea commodo consequat.`)},m(t,n){h(t,e,n)},p:V,d(t){t&&z(e)}}}function we(l){let e,t,n;function i(){return l[6](l[7])}return{c(){e=v("button"),e.textContent="Reveal this hint",I(e,"class","svelte-6e5e0o")},m(a,s){h(a,e,s),t||(n=$(e,"click",i),t=!0)},p(a,s){l=a},d(a){a&&z(e),t=!1,n()}}}function Ie(l,e){let t,n=e[7].title+"",i,a,s,u,f,_,r;function d(R,k){return R[7].locked?Ke:Je}let p=d(e),b=p(e),y=e[7].locked&&we(e);return{key:l,first:null,c(){t=v("h4"),i=K(n),a=T(),s=v("div"),u=v("p"),b.c(),_=T(),y&&y.c(),r=T(),I(t,"class","svelte-6e5e0o"),I(u,"class",f=ge(e[7].locked?"locked":"")+" svelte-6e5e0o"),I(s,"class","svelte-6e5e0o"),this.first=t},m(R,k){h(R,t,k),S(t,i),h(R,a,k),h(R,s,k),S(s,u),b.m(u,null),S(s,_),y&&y.m(s,null),S(s,r)},p(R,k){e=R,k&1&&n!==(n=e[7].title+"")&&ie(i,n),p===(p=d(e))&&b?b.p(e,k):(b.d(1),b=p(e),b&&(b.c(),b.m(u,null))),k&1&&f!==(f=ge(e[7].locked?"locked":"")+" svelte-6e5e0o")&&I(u,"class",f),e[7].locked?y?y.p(e,k):(y=we(e),y.c(),y.m(s,r)):y&&(y.d(1),y=null)},d(R){R&&z(t),R&&z(a),R&&z(s),b.d(),y&&y.d()}}}function Ve(l){let e,t,n,i,a=[],s=new Map,u;n=new Te({props:{options:l[2]}});let f=l[0];const _=r=>r[7].id;for(let r=0;r<f.length;r+=1){let d=Ce(l,f,r),p=_(d);s.set(p,a[r]=Ie(p,d))}return{c(){e=v("section"),t=v("p"),W(n.$$.fragment),i=T();for(let r=0;r<a.length;r+=1)a[r].c();I(e,"class","svelte-6e5e0o")},m(r,d){h(r,e,d),S(e,t),Y(n,t,null),S(e,i);for(let p=0;p<a.length;p+=1)a[p].m(e,null);u=!0},p(r,[d]){d&3&&(f=r[0],a=Pe(a,d,_,1,r,f,s,e,De,Ie,null,Ce))},i(r){u||(D(n.$$.fragment,r),u=!0)},o(r){H(n.$$.fragment,r),u=!1},d(r){r&&z(e),j(n);for(let d=0;d<a.length;d+=1)a[d].d()}}}function Xe(l,e,t){let{gameCode:n=""}=e,{puzzleId:i=0}=e;const a=async()=>{const r=await re(n),{data:d,error:p}=await r.rpc("gethints",{puzzleid:i,gamecode:n});if(p)throw p;t(0,u=d)},s=async function(r){await(await re(n)).rpc("requesthint",{puzzleid:i,gamecode:n,hintid:r})};let u=[];const f=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],_=r=>s(r.id);return l.$$set=r=>{"gameCode"in r&&t(3,n=r.gameCode),"puzzleId"in r&&t(4,i=r.puzzleId)},l.$$.update=()=>{l.$$.dirty&24&&n&&i&&a()},[u,s,f,n,i,a,_]}class Ze extends fe{constructor(e){super(),ce(this,e,Xe,Ve,me,{gameCode:3,puzzleId:4,refresh:5})}get refresh(){return this.$$.ctx[5]}}function xe(l){let e,t=l[6].adventure.name+"",n,i,a=l[6].title+"",s,u,f,_=l[6].content+"",r,d,p,b,y,R,k,B,N,E,G,c,X,Z,P,Q,F,ee,x,L,m,w,O,A;function se(o){l[13](o)}function te(o){l[14](o)}let oe={};l[0].code!==void 0&&(oe.gameCode=l[0].code),l[0].puzzle!==void 0&&(oe.puzzleId=l[0].puzzle),G=new Ze({props:oe}),ue.push(()=>ze(G,"gameCode",se)),ue.push(()=>ze(G,"puzzleId",te)),l[15](G),F=new Te({props:{options:l[10]}});function de(o,g){return o[6].next?tt:et}let ne=de(l),U=ne(l),q=l[2]&&Re();return m=new Le({props:{placement:"bottom-right",theme:"dark",$$slots:{default:[nt,({data:o})=>({6:o}),({data:o})=>o?64:0]},$$scope:{ctx:l}}}),{c(){e=v("h2"),n=K(t),i=K(": "),s=K(a),u=T(),f=new Ee(!1),r=T(),d=v("section"),p=v("form"),b=v("fieldset"),y=v("legend"),y.textContent="Enter a guess",R=T(),k=v("input"),B=T(),N=v("input"),E=T(),W(G.$$.fragment),Z=T(),P=v("dialog"),Q=v("h3"),W(F.$$.fragment),ee=T(),U.c(),x=T(),q&&q.c(),L=T(),W(m.$$.fragment),f.a=r,I(k,"type","text"),k.disabled=l[3],I(k,"class","svelte-6zlkam"),I(N,"type","submit"),N.value="Submit",N.disabled=l[3],I(b,"class","svelte-6zlkam"),I(d,"class","answer svelte-6zlkam"),I(Q,"class","svelte-6zlkam"),P.open=l[2],I(P,"class","svelte-6zlkam")},m(o,g){h(o,e,g),S(e,n),S(e,i),S(e,s),h(o,u,g),f.m(_,o,g),h(o,r,g),h(o,d,g),S(d,p),S(p,b),S(b,y),S(b,R),S(b,k),pe(k,l[1]),S(b,B),S(b,N),h(o,E,g),Y(G,o,g),h(o,Z,g),h(o,P,g),S(P,Q),Y(F,Q,null),S(P,ee),U.m(P,null),h(o,x,g),q&&q.m(o,g),h(o,L,g),Y(m,o,g),w=!0,O||(A=[$(k,"input",l[11]),$(p,"submit",Oe(l[12]))],O=!0)},p(o,g){(!w||g&64)&&t!==(t=o[6].adventure.name+"")&&ie(n,t),(!w||g&64)&&a!==(a=o[6].title+"")&&ie(s,a),(!w||g&64)&&_!==(_=o[6].content+"")&&f.p(_),(!w||g&8)&&(k.disabled=o[3]),g&2&&k.value!==o[1]&&pe(k,o[1]),(!w||g&8)&&(N.disabled=o[3]);const ae={};!c&&g&1&&(c=!0,ae.gameCode=o[0].code,ke(()=>c=!1)),!X&&g&1&&(X=!0,ae.puzzleId=o[0].puzzle,ke(()=>X=!1)),G.$set(ae),ne===(ne=de(o))&&U?U.p(o,g):(U.d(1),U=ne(o),U&&(U.c(),U.m(P,null))),(!w||g&4)&&(P.open=o[2]),o[2]?q?g&4&&D(q,1):(q=Re(),q.c(),D(q,1),q.m(L.parentNode,L)):q&&(qe(),H(q,1,1,()=>{q=null}),Ge());const _e={};g&134217792&&(_e.$$scope={dirty:g,ctx:o}),m.$set(_e)},i(o){w||(D(G.$$.fragment,o),D(F.$$.fragment,o),D(q),D(m.$$.fragment,o),w=!0)},o(o){H(G.$$.fragment,o),H(F.$$.fragment,o),H(q),H(m.$$.fragment,o),w=!1},d(o){o&&z(e),o&&z(u),o&&f.d(),o&&z(r),o&&z(d),o&&z(E),l[15](null),j(G,o),o&&z(Z),o&&z(P),j(F),U.d(),o&&z(x),q&&q.d(o),o&&z(L),j(m,o),O=!1,Ue(A)}}}function $e(l){let e,t;return e=new Fe({}),{c(){W(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p:V,i(n){t||(D(e.$$.fragment,n),t=!0)},o(n){H(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function et(l){let e,t,n,i,a;return{c(){e=v("p"),e.textContent="You have completed the adventure!",t=T(),n=v("button"),n.textContent="Continue \xBB",I(e,"class","svelte-6zlkam"),I(n,"class","svelte-6zlkam")},m(s,u){h(s,e,u),h(s,t,u),h(s,n,u),i||(a=$(n,"click",l[17]),i=!0)},p:V,d(s){s&&z(e),s&&z(t),s&&z(n),i=!1,a()}}}function tt(l){let e,t,n,i,a;return{c(){e=v("p"),e.textContent="You have completed this step in the adventure!",t=T(),n=v("button"),n.textContent="Next puzzle \xBB",I(e,"class","svelte-6zlkam"),I(n,"class","svelte-6zlkam")},m(s,u){h(s,e,u),h(s,t,u),h(s,n,u),i||(a=$(n,"click",l[16]),i=!0)},p:V,d(s){s&&z(e),s&&z(t),s&&z(n),i=!1,a()}}}function Re(l){let e,t,n;return t=new Qe({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=v("div"),W(t.$$.fragment),I(e,"class","confetti-bg svelte-6zlkam")},m(i,a){h(i,e,a),Y(t,e,null),n=!0},i(i){n||(D(t.$$.fragment,i),n=!0)},o(i){H(t.$$.fragment,i),n=!1},d(i){i&&z(e),j(t)}}}function nt(l){let e,t;return e=new We({props:{data:l[6]}}),{c(){W(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const a={};i&64&&(a.data=n[6]),e.$set(a)},i(n){t||(D(e.$$.fragment,n),t=!0)},o(n){H(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function lt(l){let e,t,n,i;const a=[$e,xe],s=[];function u(f,_){return f[4]?0:1}return e=u(l),t=s[e]=a[e](l),{c(){t.c(),n=Se()},m(f,_){s[e].m(f,_),h(f,n,_),i=!0},p(f,[_]){let r=e;e=u(f),e===r?s[e].p(f,_):(qe(),H(s[r],1,1,()=>{s[r]=null}),Ge(),t=s[e],t?t.p(f,_):(t=s[e]=a[e](f),t.c()),D(t,1),t.m(n.parentNode,n))},i(f){i||(D(t),i=!0)},o(f){H(t),i=!1},d(f){s[e].d(f),f&&z(n)}}}function it(l,e,t){let{params:n={}}=e,i={},a="",s=!1,u=!1,f=!0,_=null,r=null,d;he.set("Puzzad: Loading...");const p=()=>{try{b(),re(n.code).then(m=>(r=m,m.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",n.puzzle))).then(y).then(R).then(k).then(m=>t(6,i=m)).then(()=>{he.set("Puzzad: "+i.adventure.name+" :"+i.title),B(),t(4,f=!1)}).catch(()=>le("/game/"+n.code))}catch{le("/game/"+n.code)}},b=()=>{console.log("Resetting..."),t(4,f=!0),t(2,s=!1),t(1,a=""),t(3,u=!1)},y=({data:m,error:w})=>{if(w)throw w;if(m.length===0)throw"Puzzle not found";return m[0]},R=m=>{let w=[m];const O=m.content.match(/\$[^$]+?\$/g);return O&&O.forEach(A=>{w.push(A,r.storage.from("puzzles").createSignedUrl(m.storage_slug+"/"+A.substring(1,A.length-1),60*60))}),Promise.all(w)},k=m=>{let[w,...O]=m;for(let A=0;A<O.length;A+=2){const{data:{signedUrl:se},error:te}=O[A+1];if(te)throw te;w.content=w.content.replace(O[A],se)}return w};Ae(function(){_&&_.disconnect()});const B=async function(){_||(_=await He(n.code),await _.channel("public:guesses:game=eq."+n.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+n.code},N).subscribe())},N=function(m){m.record.puzzle.toString()===n.puzzle&&(m.record.content==="*hint"?d.refresh():m.record.correct?t(2,s=!0):Be.add({title:"Incorrect guess",description:m.record.content,duration:1e4,type:"error"}))},E=async function(){t(3,u=!0),await r.from("guesses").insert({content:a,puzzle:n.puzzle,game:n.code}),t(3,u=!1),t(1,a="")},G=async function(){await le("/game/"+n.code+"/"+i.next)},c=async function(){await le("/game/"+n.code)},X=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function Z(){a=this.value,t(1,a)}const P=()=>E();function Q(m){l.$$.not_equal(n.code,m)&&(n.code=m,t(0,n))}function F(m){l.$$.not_equal(n.puzzle,m)&&(n.puzzle=m,t(0,n))}function ee(m){ue[m?"unshift":"push"](()=>{d=m,t(5,d)})}const x=()=>G(),L=()=>c();return l.$$set=m=>{"params"in m&&t(0,n=m.params)},l.$$.update=()=>{l.$$.dirty&1&&n.code&&n.puzzle&&p()},[n,a,s,u,f,d,i,E,G,c,X,Z,P,Q,F,ee,x,L]}class ut extends fe{constructor(e){super(),ce(this,e,it,lt,me,{params:0})}}export{ut as default};
