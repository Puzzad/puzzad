import{S as le,i as oe,s as ie,b as se,c as b,n as A,f as z,H as Me,e as C,w,J as U,q as De,x as y,k as B,a as R,y as S,m as F,K as Ae,L as He,t as P,d as G,l as L,A as J,M as _e,B as te,I as ne,C as X,h as Oe,u as Ee,N as Be,o as Te,p as qe,j as ge,O as Fe,P as ee,Q as Le,r as fe,v as he,R as be,D as We,z as ze,T as Ye}from"./index.12c2d67e.js";import{R as Pe}from"./RandomText.c5d920eb.js";import{S as Re}from"./Spinner.f8b392e5.js";import{t as je,T as Qe,F as Ue}from"./FlatToast.580d3e3d.js";import{E as Je}from"./Error.32eefbd7.js";function pe(l,e,n){const t=l.slice();return t[18]=e[n],t}function ke(l){let e,n={length:l[6]},t=[];for(let o=0;o<n.length;o+=1)t[o]=ve(pe(l,n,o));return{c(){e=C("div");for(let o=0;o<t.length;o+=1)t[o].c();w(e,"class","confetti-holder svelte-io58ff"),U(e,"rounded",l[9]),U(e,"cone",l[10]),U(e,"no-gravity",l[11])},m(o,s){b(o,e,s);for(let i=0;i<t.length;i+=1)t[i].m(e,null)},p(o,s){if(s&20991){n={length:o[6]};let i;for(i=0;i<n.length;i+=1){const u=pe(o,n,i);t[i]?t[i].p(u,s):(t[i]=ve(u),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}s&512&&U(e,"rounded",o[9]),s&1024&&U(e,"cone",o[10]),s&2048&&U(e,"no-gravity",o[11])},d(o){o&&z(e),De(t,o)}}}function ve(l){let e;return{c(){e=C("div"),w(e,"class","confetti svelte-io58ff"),y(e,"--fall-distance",l[8]),y(e,"--size",l[0]+"px"),y(e,"--color",l[14]()),y(e,"--skew",N(-45,45)+"deg,"+N(-45,45)+"deg"),y(e,"--rotation-xyz",N(-10,10)+", "+N(-10,10)+", "+N(-10,10)),y(e,"--rotation-deg",N(0,360)+"deg"),y(e,"--translate-y-multiplier",N(l[2][0],l[2][1])),y(e,"--translate-x-multiplier",N(l[1][0],l[1][1])),y(e,"--scale",.1*N(2,10)),y(e,"--transition-duration",l[4]?`calc(${l[3]}ms * var(--scale))`:`${l[3]}ms`),y(e,"--transition-delay",N(l[5][0],l[5][1])+"ms"),y(e,"--transition-iteration-count",l[4]?"infinite":l[7]),y(e,"--x-spread",1-l[12])},m(n,t){b(n,e,t)},p(n,t){t&256&&y(e,"--fall-distance",n[8]),t&1&&y(e,"--size",n[0]+"px"),t&4&&y(e,"--translate-y-multiplier",N(n[2][0],n[2][1])),t&2&&y(e,"--translate-x-multiplier",N(n[1][0],n[1][1])),t&24&&y(e,"--transition-duration",n[4]?`calc(${n[3]}ms * var(--scale))`:`${n[3]}ms`),t&32&&y(e,"--transition-delay",N(n[5][0],n[5][1])+"ms"),t&144&&y(e,"--transition-iteration-count",n[4]?"infinite":n[7]),t&4096&&y(e,"--x-spread",1-n[12])},d(n){n&&z(e)}}}function Ke(l){let e,n=!l[13]&&ke(l);return{c(){n&&n.c(),e=se()},m(t,o){n&&n.m(t,o),b(t,e,o)},p(t,[o]){t[13]?n&&(n.d(1),n=null):n?n.p(t,o):(n=ke(t),n.c(),n.m(e.parentNode,e))},i:A,o:A,d(t){n&&n.d(t),t&&z(e)}}}function N(l,e){return Math.random()*(e-l)+l}function Ve(l,e,n){let{size:t=10}=e,{x:o=[-.5,.5]}=e,{y:s=[.25,1]}=e,{duration:i=2e3}=e,{infinite:u=!1}=e,{delay:f=[0,50]}=e,{colorRange:d=[0,360]}=e,{colorArray:r=[]}=e,{amount:m=50}=e,{iterationCount:_=1}=e,{fallDistance:k="100px"}=e,{rounded:v=!1}=e,{cone:p=!1}=e,{noGravity:I=!1}=e,{xSpread:M=.15}=e,{destroyOnComplete:H=!0}=e,q=!1;Me(()=>{!H||u||_=="infinite"||setTimeout(()=>n(13,q=!0),(i+f[1])*_)});function j(){return r.length?r[Math.round(Math.random()*(r.length-1))]:`hsl(${Math.round(N(d[0],d[1]))}, 75%, 50%`}return l.$$set=c=>{"size"in c&&n(0,t=c.size),"x"in c&&n(1,o=c.x),"y"in c&&n(2,s=c.y),"duration"in c&&n(3,i=c.duration),"infinite"in c&&n(4,u=c.infinite),"delay"in c&&n(5,f=c.delay),"colorRange"in c&&n(15,d=c.colorRange),"colorArray"in c&&n(16,r=c.colorArray),"amount"in c&&n(6,m=c.amount),"iterationCount"in c&&n(7,_=c.iterationCount),"fallDistance"in c&&n(8,k=c.fallDistance),"rounded"in c&&n(9,v=c.rounded),"cone"in c&&n(10,p=c.cone),"noGravity"in c&&n(11,I=c.noGravity),"xSpread"in c&&n(12,M=c.xSpread),"destroyOnComplete"in c&&n(17,H=c.destroyOnComplete)},[t,o,s,i,u,f,m,_,k,v,p,I,M,q,j,d,r,H]}class Xe extends le{constructor(e){super(),oe(this,e,Ve,Ke,ie,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function Ce(l,e,n){const t=l.slice();return t[7]=e[n],t}function Ze(l){let e=l[7].message+"",n;return{c(){n=J(e)},m(t,o){b(t,n,o)},p(t,o){o&1&&e!==(e=t[7].message+"")&&te(n,e)},d(t){t&&z(n)}}}function xe(l){let e;return{c(){e=J(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                    labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                    laboris nisi ut aliquip ex ea commodo consequat.`)},m(n,t){b(n,e,t)},p:A,d(n){n&&z(e)}}}function ye(l){let e,n,t;function o(){return l[6](l[7])}return{c(){e=C("button"),e.textContent="Reveal this hint",w(e,"class","svelte-6e5e0o")},m(s,i){b(s,e,i),n||(t=X(e,"click",o),n=!0)},p(s,i){l=s},d(s){s&&z(e),n=!1,t()}}}function we(l,e){let n,t=e[7].title+"",o,s,i,u,f,d,r;function m(p,I){return p[7].locked?xe:Ze}let _=m(e),k=_(e),v=e[7].locked&&ye(e);return{key:l,first:null,c(){n=C("h4"),o=J(t),s=R(),i=C("div"),u=C("p"),k.c(),d=R(),v&&v.c(),r=R(),w(n,"class","svelte-6e5e0o"),w(u,"class",f=_e(e[7].locked?"locked":"")+" svelte-6e5e0o"),w(i,"class","svelte-6e5e0o"),this.first=n},m(p,I){b(p,n,I),S(n,o),b(p,s,I),b(p,i,I),S(i,u),k.m(u,null),S(i,d),v&&v.m(i,null),S(i,r)},p(p,I){e=p,I&1&&t!==(t=e[7].title+"")&&te(o,t),_===(_=m(e))&&k?k.p(e,I):(k.d(1),k=_(e),k&&(k.c(),k.m(u,null))),I&1&&f!==(f=_e(e[7].locked?"locked":"")+" svelte-6e5e0o")&&w(u,"class",f),e[7].locked?v?v.p(e,I):(v=ye(e),v.c(),v.m(i,r)):v&&(v.d(1),v=null)},d(p){p&&z(n),p&&z(s),p&&z(i),k.d(),v&&v.d()}}}function $e(l){let e,n,t,o,s=[],i=new Map,u;t=new Pe({props:{options:l[2]}});let f=l[0];const d=r=>r[7].id;for(let r=0;r<f.length;r+=1){let m=Ce(l,f,r),_=d(m);i.set(_,s[r]=we(_,m))}return{c(){e=C("section"),n=C("p"),B(t.$$.fragment),o=R();for(let r=0;r<s.length;r+=1)s[r].c();w(e,"class","svelte-6e5e0o")},m(r,m){b(r,e,m),S(e,n),F(t,n,null),S(e,o);for(let _=0;_<s.length;_+=1)s[_].m(e,null);u=!0},p(r,[m]){m&3&&(f=r[0],s=Ae(s,m,d,1,r,f,i,e,He,we,null,Ce))},i(r){u||(P(t.$$.fragment,r),u=!0)},o(r){G(t.$$.fragment,r),u=!1},d(r){r&&z(e),L(t);for(let m=0;m<s.length;m+=1)s[m].d()}}}function et(l,e,n){let{gameCode:t=""}=e,{puzzleId:o=0}=e;const s=async()=>{const r=await ne(t),{data:m,error:_}=await r.rpc("gethints",{puzzleid:o,gamecode:t});if(_)throw _;n(0,u=m)},i=async function(r){await(await ne(t)).rpc("requesthint",{puzzleid:o,gamecode:t,hintid:r})};let u=[];const f=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],d=r=>i(r.id);return l.$$set=r=>{"gameCode"in r&&n(3,t=r.gameCode),"puzzleId"in r&&n(4,o=r.puzzleId)},l.$$.update=()=>{l.$$.dirty&24&&t&&o&&s()},[u,i,f,t,o,s,d]}class tt extends le{constructor(e){super(),oe(this,e,et,$e,ie,{gameCode:3,puzzleId:4,refresh:5})}get refresh(){return this.$$.ctx[5]}}function nt(l){let e,n;return e=new Je({props:{error:l[4]}}),{c(){B(e.$$.fragment)},m(t,o){F(e,t,o),n=!0},p:A,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function lt(l){let e,n=l[0]+"",t;return{c(){e=new Be(!1),t=se(),e.a=t},m(o,s){e.m(n,o,s),b(o,t,s)},p:A,i:A,o:A,d(o){o&&z(t),o&&e.d()}}}function ot(l){let e,n;return e=new Re({}),{c(){B(e.$$.fragment)},m(t,o){F(e,t,o),n=!0},p:A,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function it(l){let e,n,t={ctx:l,current:null,token:null,hasCatch:!0,pending:ot,then:lt,catch:nt,value:0,error:4,blocks:[,,,]};return Oe(l[0],t),{c(){e=se(),t.block.c()},m(o,s){b(o,e,s),t.block.m(o,t.anchor=s),t.mount=()=>e.parentNode,t.anchor=e,n=!0},p(o,[s]){l=o,Ee(t,l,s)},i(o){n||(P(t.block),n=!0)},o(o){for(let s=0;s<3;s+=1){const i=t.blocks[s];G(i)}n=!1},d(o){o&&z(e),t.block.d(o),t.token=null,t=null}}}const Se=/\$[^$]+?\$/g;function st(l,e,n){let{gameCode:t=""}=e,{storageSlug:o=""}=e,{content:s=""}=e,i=Promise.all([ne(t),o,s]).then(([u,f,d])=>{const r=d.match(Se)||[];return Promise.all([d,...r.map(m=>m.substring(1,m.length-1)).map(m=>u.storage.from("puzzles").createSignedUrl(`${f}/${m}`,60*60).then(({data:{signedUrl:_},error:k})=>{if(k)throw k;return _}))])}).then(([u,...f])=>u.replace(Se,()=>f.shift()));return l.$$set=u=>{"gameCode"in u&&n(1,t=u.gameCode),"storageSlug"in u&&n(2,o=u.storageSlug),"content"in u&&n(3,s=u.content)},[i,t,o,s]}class at extends le{constructor(e){super(),oe(this,e,st,it,ie,{gameCode:1,storageSlug:2,content:3})}}function rt(l){let e,n=l[6].adventure.name+"",t,o,s=l[6].title+"",i,u,f,d,r,m,_,k,v,p,I,M,H,q,j,c,K,D,Q,Y,Z,V,g,O,W,ae,ce;f=new at({props:{gameCode:l[0].code,storageSlug:l[6].storage_slug,content:l[6].content}});function Ge(a){l[13](a)}function Ne(a){l[14](a)}let re={};l[0].code!==void 0&&(re.gameCode=l[0].code),l[0].puzzle!==void 0&&(re.puzzleId=l[0].puzzle),q=new tt({props:re}),fe.push(()=>he(q,"gameCode",Ge)),fe.push(()=>he(q,"puzzleId",Ne)),l[15](q),Y=new Pe({props:{options:l[10]}});function me(a,h){return a[6].next?ct:ft}let x=me(l),E=x(l),T=l[2]&&Ie();return O=new Qe({props:{placement:"bottom-right",theme:"dark",$$slots:{default:[mt,({data:a})=>({6:a}),({data:a})=>a?64:0]},$$scope:{ctx:l}}}),{c(){e=C("h2"),t=J(n),o=J(": "),i=J(s),u=R(),B(f.$$.fragment),d=R(),r=C("section"),m=C("form"),_=C("fieldset"),k=C("legend"),k.textContent="Enter a guess",v=R(),p=C("input"),I=R(),M=C("input"),H=R(),B(q.$$.fragment),K=R(),D=C("dialog"),Q=C("h3"),B(Y.$$.fragment),Z=R(),E.c(),V=R(),T&&T.c(),g=R(),B(O.$$.fragment),w(p,"type","text"),p.disabled=l[3],w(p,"class","svelte-vm928o"),w(M,"type","submit"),M.value="Submit",M.disabled=l[3],w(_,"class","svelte-vm928o"),w(r,"class","answer svelte-vm928o"),w(Q,"class","svelte-vm928o"),D.open=l[2],w(D,"class","svelte-vm928o")},m(a,h){b(a,e,h),S(e,t),S(e,o),S(e,i),b(a,u,h),F(f,a,h),b(a,d,h),b(a,r,h),S(r,m),S(m,_),S(_,k),S(_,v),S(_,p),be(p,l[1]),S(_,I),S(_,M),b(a,H,h),F(q,a,h),b(a,K,h),b(a,D,h),S(D,Q),F(Y,Q,null),S(D,Z),E.m(D,null),b(a,V,h),T&&T.m(a,h),b(a,g,h),F(O,a,h),W=!0,ae||(ce=[X(p,"input",l[11]),X(m,"submit",We(l[12]))],ae=!0)},p(a,h){(!W||h&64)&&n!==(n=a[6].adventure.name+"")&&te(t,n),(!W||h&64)&&s!==(s=a[6].title+"")&&te(i,s);const $={};h&1&&($.gameCode=a[0].code),h&64&&($.storageSlug=a[6].storage_slug),h&64&&($.content=a[6].content),f.$set($),(!W||h&8)&&(p.disabled=a[3]),h&2&&p.value!==a[1]&&be(p,a[1]),(!W||h&8)&&(M.disabled=a[3]);const ue={};!j&&h&1&&(j=!0,ue.gameCode=a[0].code,ze(()=>j=!1)),!c&&h&1&&(c=!0,ue.puzzleId=a[0].puzzle,ze(()=>c=!1)),q.$set(ue),x===(x=me(a))&&E?E.p(a,h):(E.d(1),E=x(a),E&&(E.c(),E.m(D,null))),(!W||h&4)&&(D.open=a[2]),a[2]?T?h&4&&P(T,1):(T=Ie(),T.c(),P(T,1),T.m(g.parentNode,g)):T&&(Te(),G(T,1,1,()=>{T=null}),qe());const de={};h&33554496&&(de.$$scope={dirty:h,ctx:a}),O.$set(de)},i(a){W||(P(f.$$.fragment,a),P(q.$$.fragment,a),P(Y.$$.fragment,a),P(T),P(O.$$.fragment,a),W=!0)},o(a){G(f.$$.fragment,a),G(q.$$.fragment,a),G(Y.$$.fragment,a),G(T),G(O.$$.fragment,a),W=!1},d(a){a&&z(e),a&&z(u),L(f,a),a&&z(d),a&&z(r),a&&z(H),l[15](null),L(q,a),a&&z(K),a&&z(D),L(Y),E.d(),a&&z(V),T&&T.d(a),a&&z(g),L(O,a),ae=!1,Ye(ce)}}}function ut(l){let e,n;return e=new Re({}),{c(){B(e.$$.fragment)},m(t,o){F(e,t,o),n=!0},p:A,i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function ft(l){let e,n,t,o,s;return{c(){e=C("p"),e.textContent="You have completed the adventure!",n=R(),t=C("button"),t.textContent="Continue \xBB",w(e,"class","svelte-vm928o"),w(t,"class","svelte-vm928o")},m(i,u){b(i,e,u),b(i,n,u),b(i,t,u),o||(s=X(t,"click",l[17]),o=!0)},p:A,d(i){i&&z(e),i&&z(n),i&&z(t),o=!1,s()}}}function ct(l){let e,n,t,o,s;return{c(){e=C("p"),e.textContent="You have completed this step in the adventure!",n=R(),t=C("button"),t.textContent="Next puzzle \xBB",w(e,"class","svelte-vm928o"),w(t,"class","svelte-vm928o")},m(i,u){b(i,e,u),b(i,n,u),b(i,t,u),o||(s=X(t,"click",l[16]),o=!0)},p:A,d(i){i&&z(e),i&&z(n),i&&z(t),o=!1,s()}}}function Ie(l){let e,n,t;return n=new Xe({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=C("div"),B(n.$$.fragment),w(e,"class","confetti-bg svelte-vm928o")},m(o,s){b(o,e,s),F(n,e,null),t=!0},i(o){t||(P(n.$$.fragment,o),t=!0)},o(o){G(n.$$.fragment,o),t=!1},d(o){o&&z(e),L(n)}}}function mt(l){let e,n;return e=new Ue({props:{data:l[6]}}),{c(){B(e.$$.fragment)},m(t,o){F(e,t,o),n=!0},p(t,o){const s={};o&64&&(s.data=t[6]),e.$set(s)},i(t){n||(P(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function dt(l){let e,n,t,o;const s=[ut,rt],i=[];function u(f,d){return f[4]?0:1}return e=u(l),n=i[e]=s[e](l),{c(){n.c(),t=se()},m(f,d){i[e].m(f,d),b(f,t,d),o=!0},p(f,[d]){let r=e;e=u(f),e===r?i[e].p(f,d):(Te(),G(i[r],1,1,()=>{i[r]=null}),qe(),n=i[e],n?n.p(f,d):(n=i[e]=s[e](f),n.c()),P(n,1),n.m(t.parentNode,t))},i(f){o||(P(n),o=!0)},o(f){G(n),o=!1},d(f){i[e].d(f),f&&z(t)}}}function _t(l,e,n){let{params:t={}}=e,o={},s="",i=!1,u=!1,f=!0,d=null,r=null,m;ge.set("Puzzad: Loading...");const _=()=>{try{k(),ne(t.code).then(g=>(r=g,g.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",t.puzzle))).then(v).then(g=>n(6,o=g)).then(()=>{ge.set("Puzzad: "+o.adventure.name+": "+o.title),p(),n(4,f=!1)}).catch(()=>ee("/game/"+t.code))}catch{ee("/game/"+t.code)}},k=()=>{console.log("Resetting..."),n(4,f=!0),n(2,i=!1),n(1,s=""),n(3,u=!1)},v=({data:g,error:O})=>{if(O)throw O;if(g.length===0)throw"Puzzle not found";return g[0]};Fe(function(){d&&d.disconnect()});const p=async function(){d||(d=await Le(t.code),await d.channel("public:guesses:game=eq."+t.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+t.code},I).subscribe())},I=function(g){g.record.puzzle.toString()===t.puzzle&&(g.record.content==="*hint"?m.refresh():g.record.correct?n(2,i=!0):je.add({title:"Incorrect guess",description:g.record.content,duration:1e4,type:"error"}))},M=async function(){n(3,u=!0),await r.from("guesses").insert({content:s,puzzle:t.puzzle,game:t.code}),n(3,u=!1),n(1,s="")},H=async function(){await ee("/game/"+t.code+"/"+o.next)},q=async function(){await ee("/game/"+t.code)},j=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function c(){s=this.value,n(1,s)}const K=()=>M();function D(g){l.$$.not_equal(t.code,g)&&(t.code=g,n(0,t))}function Q(g){l.$$.not_equal(t.puzzle,g)&&(t.puzzle=g,n(0,t))}function Y(g){fe[g?"unshift":"push"](()=>{m=g,n(5,m)})}const Z=()=>H(),V=()=>q();return l.$$set=g=>{"params"in g&&n(0,t=g.params)},l.$$.update=()=>{l.$$.dirty&1&&t.code&&t.puzzle&&_()},[t,s,i,u,f,m,o,M,H,q,j,c,K,D,Q,Y,Z,V]}class kt extends le{constructor(e){super(),oe(this,e,_t,dt,ie,{params:0})}}export{kt as default};
