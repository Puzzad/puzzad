import{S as ze,i as ve,s as ye,e as fe,a as h,n as le,d as g,o as Se,h as p,r as v,E as V,k as we,v as k,g as Ce,t as E,c as qe,b as I,F as Ge,D as Re,G as ae,x as ne,j as q,l as X,w as z,H as me,m as Z,C as se,I as Te,y as re,p as x,J as Ne,K as De}from"./index.e5de9d02.js";import{R as de}from"./RandomText.4b38e372.js";import{S as Me}from"./Spinner.1b813185.js";import{t as Pe,T as He,F as Ie}from"./FlatToast.6bbec30d.js";function _e(l,e,t){const n=l.slice();return n[18]=e[t],n}function he(l){let e,t={length:l[6]},n=[];for(let s=0;s<t.length;s+=1)n[s]=ge(_e(l,t,s));return{c(){e=p("div");for(let s=0;s<n.length;s+=1)n[s].c();v(e,"class","confetti-holder svelte-io58ff"),V(e,"rounded",l[9]),V(e,"cone",l[10]),V(e,"no-gravity",l[11])},m(s,a){h(s,e,a);for(let o=0;o<n.length;o+=1)n[o].m(e,null)},p(s,a){if(a&20991){t={length:s[6]};let o;for(o=0;o<t.length;o+=1){const m=_e(s,t,o);n[o]?n[o].p(m,a):(n[o]=ge(m),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=t.length}a&512&&V(e,"rounded",s[9]),a&1024&&V(e,"cone",s[10]),a&2048&&V(e,"no-gravity",s[11])},d(s){s&&g(e),we(n,s)}}}function ge(l){let e;return{c(){e=p("div"),v(e,"class","confetti svelte-io58ff"),k(e,"--fall-distance",l[8]),k(e,"--size",l[0]+"px"),k(e,"--color",l[14]()),k(e,"--skew",S(-45,45)+"deg,"+S(-45,45)+"deg"),k(e,"--rotation-xyz",S(-10,10)+", "+S(-10,10)+", "+S(-10,10)),k(e,"--rotation-deg",S(0,360)+"deg"),k(e,"--translate-y-multiplier",S(l[2][0],l[2][1])),k(e,"--translate-x-multiplier",S(l[1][0],l[1][1])),k(e,"--scale",.1*S(2,10)),k(e,"--transition-duration",l[4]?`calc(${l[3]}ms * var(--scale))`:`${l[3]}ms`),k(e,"--transition-delay",S(l[5][0],l[5][1])+"ms"),k(e,"--transition-iteration-count",l[4]?"infinite":l[7]),k(e,"--x-spread",1-l[12])},m(t,n){h(t,e,n)},p(t,n){n&256&&k(e,"--fall-distance",t[8]),n&1&&k(e,"--size",t[0]+"px"),n&4&&k(e,"--translate-y-multiplier",S(t[2][0],t[2][1])),n&2&&k(e,"--translate-x-multiplier",S(t[1][0],t[1][1])),n&24&&k(e,"--transition-duration",t[4]?`calc(${t[3]}ms * var(--scale))`:`${t[3]}ms`),n&32&&k(e,"--transition-delay",S(t[5][0],t[5][1])+"ms"),n&144&&k(e,"--transition-iteration-count",t[4]?"infinite":t[7]),n&4096&&k(e,"--x-spread",1-t[12])},d(t){t&&g(e)}}}function Ue(l){let e,t=!l[13]&&he(l);return{c(){t&&t.c(),e=fe()},m(n,s){t&&t.m(n,s),h(n,e,s)},p(n,[s]){n[13]?t&&(t.d(1),t=null):t?t.p(n,s):(t=he(n),t.c(),t.m(e.parentNode,e))},i:le,o:le,d(n){t&&t.d(n),n&&g(e)}}}function S(l,e){return Math.random()*(e-l)+l}function Ae(l,e,t){let{size:n=10}=e,{x:s=[-.5,.5]}=e,{y:a=[.25,1]}=e,{duration:o=2e3}=e,{infinite:m=!1}=e,{delay:f=[0,50]}=e,{colorRange:r=[0,360]}=e,{colorArray:d=[]}=e,{amount:T=50}=e,{iterationCount:P=1}=e,{fallDistance:G="100px"}=e,{rounded:O=!1}=e,{cone:J=!1}=e,{noGravity:C=!1}=e,{xSpread:W=.15}=e,{destroyOnComplete:N=!0}=e,Y=!1;Se(()=>{!N||m||P=="infinite"||setTimeout(()=>t(13,Y=!0),(o+f[1])*P)});function R(){return d.length?d[Math.round(Math.random()*(d.length-1))]:`hsl(${Math.round(S(r[0],r[1]))}, 75%, 50%`}return l.$$set=u=>{"size"in u&&t(0,n=u.size),"x"in u&&t(1,s=u.x),"y"in u&&t(2,a=u.y),"duration"in u&&t(3,o=u.duration),"infinite"in u&&t(4,m=u.infinite),"delay"in u&&t(5,f=u.delay),"colorRange"in u&&t(15,r=u.colorRange),"colorArray"in u&&t(16,d=u.colorArray),"amount"in u&&t(6,T=u.amount),"iterationCount"in u&&t(7,P=u.iterationCount),"fallDistance"in u&&t(8,G=u.fallDistance),"rounded"in u&&t(9,O=u.rounded),"cone"in u&&t(10,J=u.cone),"noGravity"in u&&t(11,C=u.noGravity),"xSpread"in u&&t(12,W=u.xSpread),"destroyOnComplete"in u&&t(17,N=u.destroyOnComplete)},[n,s,a,o,m,f,T,P,G,O,J,C,W,Y,R,r,d,N]}class Ee extends ze{constructor(e){super(),ve(this,e,Ae,Ue,ye,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function be(l,e,t){const n=l.slice();return n[28]=e[t],n}function Fe(l){let e,t=l[5].adventure.name+"",n,s,a=l[5].title+"",o,m,f,r=l[5].content+"",d,T,P,G,O,J,C,W,N,Y,R,u,F,$,ee,D,L,j,ie,te,K,c,b,U,H;F=new de({props:{options:l[10]}});let B=l[4],y=[];for(let i=0;i<B.length;i+=1)y[i]=pe(be(l,B,i));j=new de({props:{options:l[11]}});function ue(i,_){return i[5].next?Be:je}let oe=ue(l),A=oe(l),w=l[1]&&ke();return c=new He({props:{placement:"bottom-right",theme:"dark",$$slots:{default:[Je,({data:i})=>({5:i}),({data:i})=>[i?32:0]]},$$scope:{ctx:l}}}),{c(){e=p("h2"),n=ne(t),s=ne(": "),o=ne(a),m=q(),f=new De(!1),d=q(),T=p("section"),P=p("form"),G=p("fieldset"),O=p("legend"),O.textContent="Enter a guess",J=q(),C=p("input"),W=q(),N=p("input"),Y=q(),R=p("section"),u=p("p"),X(F.$$.fragment),$=q();for(let i=0;i<y.length;i+=1)y[i].c();ee=q(),D=p("dialog"),L=p("h3"),X(j.$$.fragment),ie=q(),A.c(),te=q(),w&&w.c(),K=q(),X(c.$$.fragment),f.a=d,v(C,"type","text"),C.disabled=l[2],v(C,"class","svelte-1q6443e"),v(N,"type","submit"),N.value="Submit",N.disabled=l[2],v(G,"class","svelte-1q6443e"),v(T,"class","answer svelte-1q6443e"),v(R,"class","hints svelte-1q6443e"),v(L,"class","svelte-1q6443e"),D.open=l[1],v(D,"class","svelte-1q6443e")},m(i,_){h(i,e,_),z(e,n),z(e,s),z(e,o),h(i,m,_),f.m(r,i,_),h(i,d,_),h(i,T,_),z(T,P),z(P,G),z(G,O),z(G,J),z(G,C),me(C,l[0]),z(G,W),z(G,N),h(i,Y,_),h(i,R,_),z(R,u),Z(F,u,null),z(R,$);for(let Q=0;Q<y.length;Q+=1)y[Q].m(R,null);h(i,ee,_),h(i,D,_),z(D,L),Z(j,L,null),z(D,ie),A.m(D,null),h(i,te,_),w&&w.m(i,_),h(i,K,_),Z(c,i,_),b=!0,U||(H=[se(C,"input",l[13]),se(P,"submit",Te(l[14]))],U=!0)},p(i,_){if((!b||_[0]&32)&&t!==(t=i[5].adventure.name+"")&&re(n,t),(!b||_[0]&32)&&a!==(a=i[5].title+"")&&re(o,a),(!b||_[0]&32)&&r!==(r=i[5].content+"")&&f.p(r),(!b||_[0]&4)&&(C.disabled=i[2]),_[0]&1&&C.value!==i[0]&&me(C,i[0]),(!b||_[0]&4)&&(N.disabled=i[2]),_[0]&144){B=i[4];let M;for(M=0;M<B.length;M+=1){const ce=be(i,B,M);y[M]?y[M].p(ce,_):(y[M]=pe(ce),y[M].c(),y[M].m(R,null))}for(;M<y.length;M+=1)y[M].d(1);y.length=B.length}oe===(oe=ue(i))&&A?A.p(i,_):(A.d(1),A=oe(i),A&&(A.c(),A.m(D,null))),(!b||_[0]&2)&&(D.open=i[1]),i[1]?w?_[0]&2&&I(w,1):(w=ke(),w.c(),I(w,1),w.m(K.parentNode,K)):w&&(Ce(),E(w,1,1,()=>{w=null}),qe());const Q={};_[0]&32|_[1]&1&&(Q.$$scope={dirty:_,ctx:i}),c.$set(Q)},i(i){b||(I(F.$$.fragment,i),I(j.$$.fragment,i),I(w),I(c.$$.fragment,i),b=!0)},o(i){E(F.$$.fragment,i),E(j.$$.fragment,i),E(w),E(c.$$.fragment,i),b=!1},d(i){i&&g(e),i&&g(m),i&&f.d(),i&&g(d),i&&g(T),i&&g(Y),i&&g(R),x(F),we(y,i),i&&g(ee),i&&g(D),x(j),A.d(),i&&g(te),w&&w.d(i),i&&g(K),x(c,i),U=!1,Ne(H)}}}function Oe(l){let e,t;return e=new Me({}),{c(){X(e.$$.fragment)},m(n,s){Z(e,n,s),t=!0},p:le,i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function We(l){let e,t=l[28].message+"",n;return{c(){e=p("p"),n=ne(t)},m(s,a){h(s,e,a),z(e,n)},p(s,a){a[0]&16&&t!==(t=s[28].message+"")&&re(n,t)},d(s){s&&g(e)}}}function Ye(l){let e,t,n,s,a,o,m;function f(){return l[15](l[28])}return{c(){e=p("div"),t=p("p"),t.textContent=`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                        labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                        laboris nisi ut aliquip ex ea commodo consequat.`,n=q(),s=p("button"),s.textContent="Reveal this hint",a=q(),v(t,"class","svelte-1q6443e"),v(s,"class","svelte-1q6443e"),v(e,"class","locked svelte-1q6443e")},m(r,d){h(r,e,d),z(e,t),z(e,n),z(e,s),z(e,a),o||(m=se(s,"click",f),o=!0)},p(r,d){l=r},d(r){r&&g(e),o=!1,m()}}}function pe(l){let e,t=l[28].title+"",n,s,a;function o(r,d){return r[28].locked?Ye:We}let m=o(l),f=m(l);return{c(){e=p("h4"),n=ne(t),s=q(),f.c(),a=fe(),v(e,"class","svelte-1q6443e")},m(r,d){h(r,e,d),z(e,n),h(r,s,d),f.m(r,d),h(r,a,d)},p(r,d){d[0]&16&&t!==(t=r[28].title+"")&&re(n,t),m===(m=o(r))&&f?f.p(r,d):(f.d(1),f=m(r),f&&(f.c(),f.m(a.parentNode,a)))},d(r){r&&g(e),r&&g(s),f.d(r),r&&g(a)}}}function je(l){let e,t,n,s,a;return{c(){e=p("p"),e.textContent="You have completed the adventure!",t=q(),n=p("button"),n.textContent="Continue \xBB",v(e,"class","svelte-1q6443e"),v(n,"class","svelte-1q6443e")},m(o,m){h(o,e,m),h(o,t,m),h(o,n,m),s||(a=se(n,"click",l[17]),s=!0)},p:le,d(o){o&&g(e),o&&g(t),o&&g(n),s=!1,a()}}}function Be(l){let e,t,n,s,a;return{c(){e=p("p"),e.textContent="You have completed this step in the adventure!",t=q(),n=p("button"),n.textContent="Next puzzle \xBB",v(e,"class","svelte-1q6443e"),v(n,"class","svelte-1q6443e")},m(o,m){h(o,e,m),h(o,t,m),h(o,n,m),s||(a=se(n,"click",l[16]),s=!0)},p:le,d(o){o&&g(e),o&&g(t),o&&g(n),s=!1,a()}}}function ke(l){let e,t,n;return t=new Ee({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=p("div"),X(t.$$.fragment),v(e,"class","confetti-bg svelte-1q6443e")},m(s,a){h(s,e,a),Z(t,e,null),n=!0},i(s){n||(I(t.$$.fragment,s),n=!0)},o(s){E(t.$$.fragment,s),n=!1},d(s){s&&g(e),x(t)}}}function Je(l){let e,t;return e=new Ie({props:{data:l[5]}}),{c(){X(e.$$.fragment)},m(n,s){Z(e,n,s),t=!0},p(n,s){const a={};s[0]&32&&(a.data=n[5]),e.$set(a)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){E(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function Ke(l){let e,t,n,s;const a=[Oe,Fe],o=[];function m(f,r){return f[3]?0:1}return e=m(l),t=o[e]=a[e](l),{c(){t.c(),n=fe()},m(f,r){o[e].m(f,r),h(f,n,r),s=!0},p(f,r){let d=e;e=m(f),e===d?o[e].p(f,r):(Ce(),E(o[d],1,1,()=>{o[d]=null}),qe(),t=o[e],t?t.p(f,r):(t=o[e]=a[e](f),t.c()),I(t,1),t.m(n.parentNode,n))},i(f){s||(I(t),s=!0)},o(f){E(t),s=!1},d(f){o[e].d(f),f&&g(n)}}}function Le(l,e,t){let{params:n={}}=e,s={},a="",o=!1,m=!1,f=!0,r=null,d=null,T=[];const P=()=>{try{G(),Re(n.code).then(c=>(d=c,c.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",n.puzzle))).then(O).then(J).then(C).then(c=>t(5,s=c)).then(()=>{r||N(),t(3,f=!1)}).then(W).catch(()=>ae("/game/"+n.code))}catch{ae("/game/"+n.code)}},G=()=>{console.log("Resetting..."),t(3,f=!0),t(1,o=!1),t(0,a=""),t(2,m=!1),t(4,T=[])},O=({data:c,error:b})=>{if(b)throw b;if(c.length===0)throw"Puzzle not found";return c[0]},J=c=>{let b=[c];const U=c.content.match(/\$[^$]+?\$/g);return U&&U.forEach(H=>{b.push(H,d.storage.from("puzzles").createSignedUrl(c.storage_slug+"/"+H.substring(1,H.length-1),60*60))}),Promise.all(b)},C=c=>{let[b,...U]=c;for(let H=0;H<U.length;H+=2){const{data:{signedUrl:B},error:y}=U[H+1];if(y)throw y;b.content=b.content.replace(U[H],B)}return b},W=async()=>{const{data:c,error:b}=await d.rpc("gethints",{puzzleid:n.puzzle,gamecode:n.code});if(b)throw b;t(4,T=c)};Ge(async function(){r&&await d.removeChannel(r)});const N=async function(){r=await d.channel("public:guesses:game=eq."+n.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+n.code},Y).subscribe()},Y=function(c){c.new.puzzle.toString()===n.puzzle&&(c.new.content==="*hint"?W():c.new.correct?t(1,o=!0):Pe.add({title:"Incorrect guess",description:c.new.content,duration:1e4,type:"error"}))},R=async function(){t(2,m=!0),await d.from("guesses").insert({content:a,puzzle:n.puzzle,game:n.code}),t(2,m=!1),t(0,a="")},u=async function(c){await d.rpc("requesthint",{puzzleid:n.puzzle,gamecode:n.code,hintid:c})},F=async function(){await ae("/game/"+n.code+"/"+s.next)},$=async function(){await ae("/game/"+n.code)},ee=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],D=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function L(){a=this.value,t(0,a)}const j=()=>R(),ie=c=>u(c.id),te=()=>F(),K=()=>$();return l.$$set=c=>{"params"in c&&t(12,n=c.params)},l.$$.update=()=>{l.$$.dirty[0]&4096&&n.code&&n.puzzle&&P()},[a,o,m,f,T,s,R,u,F,$,ee,D,n,L,j,ie,te,K]}class xe extends ze{constructor(e){super(),ve(this,e,Le,Ke,ye,{params:12},null,[-1,-1])}}export{xe as default};
