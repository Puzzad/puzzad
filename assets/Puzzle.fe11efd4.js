import{S as le,i as ie,s as oe,b as se,c as z,n as A,f as k,H as Me,e as y,w,J as U,q as De,x as v,k as B,a as G,y as S,m as F,K as Ae,L as He,t as R,d as N,l as L,A as J,M as _e,B as te,I as ne,C as X,h as Oe,u as Ee,N as Be,o as Te,p as qe,j as ge,O as Fe,P as ee,Q as Le,r as fe,v as he,R as ze,D as We,z as ke,T as Ye}from"./index.1653b910.js";import{R as Re}from"./RandomText.f62297d7.js";import{S as Ge}from"./Spinner.df56480e.js";import{t as je,T as Qe,F as Ue}from"./FlatToast.4277c5f5.js";import{E as Je}from"./Error.df41a193.js";function be(l,e,n){const t=l.slice();return t[18]=e[n],t}function pe(l){let e,n={length:l[6]},t=[];for(let i=0;i<n.length;i+=1)t[i]=Ce(be(l,n,i));return{c(){e=y("div");for(let i=0;i<t.length;i+=1)t[i].c();w(e,"class","confetti-holder svelte-io58ff"),U(e,"rounded",l[9]),U(e,"cone",l[10]),U(e,"no-gravity",l[11])},m(i,s){z(i,e,s);for(let o=0;o<t.length;o+=1)t[o].m(e,null)},p(i,s){if(s&20991){n={length:i[6]};let o;for(o=0;o<n.length;o+=1){const u=be(i,n,o);t[o]?t[o].p(u,s):(t[o]=Ce(u),t[o].c(),t[o].m(e,null))}for(;o<t.length;o+=1)t[o].d(1);t.length=n.length}s&512&&U(e,"rounded",i[9]),s&1024&&U(e,"cone",i[10]),s&2048&&U(e,"no-gravity",i[11])},d(i){i&&k(e),De(t,i)}}}function Ce(l){let e;return{c(){e=y("div"),w(e,"class","confetti svelte-io58ff"),v(e,"--fall-distance",l[8]),v(e,"--size",l[0]+"px"),v(e,"--color",l[14]()),v(e,"--skew",P(-45,45)+"deg,"+P(-45,45)+"deg"),v(e,"--rotation-xyz",P(-10,10)+", "+P(-10,10)+", "+P(-10,10)),v(e,"--rotation-deg",P(0,360)+"deg"),v(e,"--translate-y-multiplier",P(l[2][0],l[2][1])),v(e,"--translate-x-multiplier",P(l[1][0],l[1][1])),v(e,"--scale",.1*P(2,10)),v(e,"--transition-duration",l[4]?`calc(${l[3]}ms * var(--scale))`:`${l[3]}ms`),v(e,"--transition-delay",P(l[5][0],l[5][1])+"ms"),v(e,"--transition-iteration-count",l[4]?"infinite":l[7]),v(e,"--x-spread",1-l[12])},m(n,t){z(n,e,t)},p(n,t){t&256&&v(e,"--fall-distance",n[8]),t&1&&v(e,"--size",n[0]+"px"),t&4&&v(e,"--translate-y-multiplier",P(n[2][0],n[2][1])),t&2&&v(e,"--translate-x-multiplier",P(n[1][0],n[1][1])),t&24&&v(e,"--transition-duration",n[4]?`calc(${n[3]}ms * var(--scale))`:`${n[3]}ms`),t&32&&v(e,"--transition-delay",P(n[5][0],n[5][1])+"ms"),t&144&&v(e,"--transition-iteration-count",n[4]?"infinite":n[7]),t&4096&&v(e,"--x-spread",1-n[12])},d(n){n&&k(e)}}}function Ke(l){let e,n=!l[13]&&pe(l);return{c(){n&&n.c(),e=se()},m(t,i){n&&n.m(t,i),z(t,e,i)},p(t,[i]){t[13]?n&&(n.d(1),n=null):n?n.p(t,i):(n=pe(t),n.c(),n.m(e.parentNode,e))},i:A,o:A,d(t){n&&n.d(t),t&&k(e)}}}function P(l,e){return Math.random()*(e-l)+l}function Ve(l,e,n){let{size:t=10}=e,{x:i=[-.5,.5]}=e,{y:s=[.25,1]}=e,{duration:o=2e3}=e,{infinite:u=!1}=e,{delay:f=[0,50]}=e,{colorRange:d=[0,360]}=e,{colorArray:r=[]}=e,{amount:m=50}=e,{iterationCount:_=1}=e,{fallDistance:p="100px"}=e,{rounded:C=!1}=e,{cone:b=!1}=e,{noGravity:I=!1}=e,{xSpread:M=.15}=e,{destroyOnComplete:H=!0}=e,q=!1;Me(()=>{!H||u||_=="infinite"||setTimeout(()=>n(13,q=!0),(o+f[1])*_)});function j(){return r.length?r[Math.round(Math.random()*(r.length-1))]:`hsl(${Math.round(P(d[0],d[1]))}, 75%, 50%`}return l.$$set=c=>{"size"in c&&n(0,t=c.size),"x"in c&&n(1,i=c.x),"y"in c&&n(2,s=c.y),"duration"in c&&n(3,o=c.duration),"infinite"in c&&n(4,u=c.infinite),"delay"in c&&n(5,f=c.delay),"colorRange"in c&&n(15,d=c.colorRange),"colorArray"in c&&n(16,r=c.colorArray),"amount"in c&&n(6,m=c.amount),"iterationCount"in c&&n(7,_=c.iterationCount),"fallDistance"in c&&n(8,p=c.fallDistance),"rounded"in c&&n(9,C=c.rounded),"cone"in c&&n(10,b=c.cone),"noGravity"in c&&n(11,I=c.noGravity),"xSpread"in c&&n(12,M=c.xSpread),"destroyOnComplete"in c&&n(17,H=c.destroyOnComplete)},[t,i,s,o,u,f,m,_,p,C,b,I,M,q,j,d,r,H]}class Xe extends le{constructor(e){super(),ie(this,e,Ve,Ke,oe,{size:0,x:1,y:2,duration:3,infinite:4,delay:5,colorRange:15,colorArray:16,amount:6,iterationCount:7,fallDistance:8,rounded:9,cone:10,noGravity:11,xSpread:12,destroyOnComplete:17})}}function ye(l,e,n){const t=l.slice();return t[7]=e[n],t}function Ze(l){let e=l[7].message+"",n;return{c(){n=J(e)},m(t,i){z(t,n,i)},p(t,i){i&1&&e!==(e=t[7].message+"")&&te(n,e)},d(t){t&&k(n)}}}function xe(l){let e;return{c(){e=J(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                    labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                    laboris nisi ut aliquip ex ea commodo consequat.`)},m(n,t){z(n,e,t)},p:A,d(n){n&&k(e)}}}function ve(l){let e,n,t;function i(){return l[6](l[7])}return{c(){e=y("button"),e.textContent="Reveal this hint",w(e,"class","svelte-6e5e0o")},m(s,o){z(s,e,o),n||(t=X(e,"click",i),n=!0)},p(s,o){l=s},d(s){s&&k(e),n=!1,t()}}}function we(l,e){let n,t=e[7].title+"",i,s,o,u,f,d,r;function m(b,I){return b[7].locked?xe:Ze}let _=m(e),p=_(e),C=e[7].locked&&ve(e);return{key:l,first:null,c(){n=y("h4"),i=J(t),s=G(),o=y("div"),u=y("p"),p.c(),d=G(),C&&C.c(),r=G(),w(n,"class","svelte-6e5e0o"),w(u,"class",f=_e(e[7].locked?"locked":"")+" svelte-6e5e0o"),w(o,"class","svelte-6e5e0o"),this.first=n},m(b,I){z(b,n,I),S(n,i),z(b,s,I),z(b,o,I),S(o,u),p.m(u,null),S(o,d),C&&C.m(o,null),S(o,r)},p(b,I){e=b,I&1&&t!==(t=e[7].title+"")&&te(i,t),_===(_=m(e))&&p?p.p(e,I):(p.d(1),p=_(e),p&&(p.c(),p.m(u,null))),I&1&&f!==(f=_e(e[7].locked?"locked":"")+" svelte-6e5e0o")&&w(u,"class",f),e[7].locked?C?C.p(e,I):(C=ve(e),C.c(),C.m(o,r)):C&&(C.d(1),C=null)},d(b){b&&k(n),b&&k(s),b&&k(o),p.d(),C&&C.d()}}}function $e(l){let e,n,t,i,s=[],o=new Map,u;t=new Re({props:{options:l[2]}});let f=l[0];const d=r=>r[7].id;for(let r=0;r<f.length;r+=1){let m=ye(l,f,r),_=d(m);o.set(_,s[r]=we(_,m))}return{c(){e=y("section"),n=y("p"),B(t.$$.fragment),i=G();for(let r=0;r<s.length;r+=1)s[r].c();w(e,"class","svelte-6e5e0o")},m(r,m){z(r,e,m),S(e,n),F(t,n,null),S(e,i);for(let _=0;_<s.length;_+=1)s[_].m(e,null);u=!0},p(r,[m]){m&3&&(f=r[0],s=Ae(s,m,d,1,r,f,o,e,He,we,null,ye))},i(r){u||(R(t.$$.fragment,r),u=!0)},o(r){N(t.$$.fragment,r),u=!1},d(r){r&&k(e),L(t);for(let m=0;m<s.length;m+=1)s[m].d()}}}function et(l,e,n){let{gameCode:t=""}=e,{puzzleId:i=0}=e;const s=async()=>{const r=await ne(t),{data:m,error:_}=await r.rpc("gethints",{puzzleid:i,gamecode:t});if(_)throw _;n(0,u=m)},o=async function(r){await(await ne(t)).rpc("requesthint",{puzzleid:i,gamecode:t,hintid:r})};let u=[];const f=["Need a hint? Browse our extensive collection below!","Not sure where to go? Try one of our finest hints!","Get your hints here! Freshly plucked from the hint tree!","Psst... Can I interest you in a hint?","We've got the finest hints in all the land. Don't believe me? Try one for free!","Struggling? In a rush? Why not take one of our hand-picked, artisanal hints?"],d=r=>o(r.id);return l.$$set=r=>{"gameCode"in r&&n(3,t=r.gameCode),"puzzleId"in r&&n(4,i=r.puzzleId)},l.$$.update=()=>{l.$$.dirty&24&&t&&i&&s()},[u,o,f,t,i,s,d]}class tt extends le{constructor(e){super(),ie(this,e,et,$e,oe,{gameCode:3,puzzleId:4,refresh:5})}get refresh(){return this.$$.ctx[5]}}function nt(l){let e,n;return e=new Je({props:{error:l[4]}}),{c(){B(e.$$.fragment)},m(t,i){F(e,t,i),n=!0},p:A,i(t){n||(R(e.$$.fragment,t),n=!0)},o(t){N(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function lt(l){let e,n=l[0]+"",t;return{c(){e=new Be(!1),t=se(),e.a=t},m(i,s){e.m(n,i,s),z(i,t,s)},p:A,i:A,o:A,d(i){i&&k(t),i&&e.d()}}}function it(l){let e,n;return e=new Ge({}),{c(){B(e.$$.fragment)},m(t,i){F(e,t,i),n=!0},p:A,i(t){n||(R(e.$$.fragment,t),n=!0)},o(t){N(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function ot(l){let e,n,t={ctx:l,current:null,token:null,hasCatch:!0,pending:it,then:lt,catch:nt,value:0,error:4,blocks:[,,,]};return Oe(l[0],t),{c(){e=se(),t.block.c()},m(i,s){z(i,e,s),t.block.m(i,t.anchor=s),t.mount=()=>e.parentNode,t.anchor=e,n=!0},p(i,[s]){l=i,Ee(t,l,s)},i(i){n||(R(t.block),n=!0)},o(i){for(let s=0;s<3;s+=1){const o=t.blocks[s];N(o)}n=!1},d(i){i&&k(e),t.block.d(i),t.token=null,t=null}}}const Se=/\$[^$]+?\$/g;function st(l,e,n){let{gameCode:t=""}=e,{storageSlug:i=""}=e,{content:s=""}=e,o=Promise.all([ne(t),i,s]).then(([u,f,d])=>{const r=d.match(Se)||[];return Promise.all([d,...r.map(m=>m.substring(1,m.length-1)).map(m=>u.storage.from("puzzles").createSignedUrl(`${f}/${m}`,60*60).then(({data:{signedUrl:_},error:p})=>{if(p)throw p;return _}))])}).then(([u,...f])=>u.replace(Se,()=>f.shift()));return l.$$set=u=>{"gameCode"in u&&n(1,t=u.gameCode),"storageSlug"in u&&n(2,i=u.storageSlug),"content"in u&&n(3,s=u.content)},[o,t,i,s]}class at extends le{constructor(e){super(),ie(this,e,st,ot,oe,{gameCode:1,storageSlug:2,content:3})}}function rt(l){let e,n=l[6].adventure.name+"",t,i,s=l[6].title+"",o,u,f,d,r,m,_,p,C,b,I,M,H,q,j,c,K,D,Q,Y,Z,V,g,O,W,ae,ce;f=new at({props:{gameCode:l[0].code,storageSlug:l[6].storage_slug,content:l[6].content}});function Ne(a){l[13](a)}function Pe(a){l[14](a)}let re={};l[0].code!==void 0&&(re.gameCode=l[0].code),l[0].puzzle!==void 0&&(re.puzzleId=l[0].puzzle),q=new tt({props:re}),fe.push(()=>he(q,"gameCode",Ne)),fe.push(()=>he(q,"puzzleId",Pe)),l[15](q),Y=new Re({props:{options:l[10]}});function me(a,h){return a[6].next?ct:ft}let x=me(l),E=x(l),T=l[2]&&Ie();return O=new Qe({props:{placement:"bottom-right",theme:"dark",$$slots:{default:[mt,({data:a})=>({6:a}),({data:a})=>a?64:0]},$$scope:{ctx:l}}}),{c(){e=y("h2"),t=J(n),i=J(": "),o=J(s),u=G(),B(f.$$.fragment),d=G(),r=y("section"),m=y("form"),_=y("fieldset"),p=y("legend"),p.textContent="Enter a guess",C=G(),b=y("input"),I=G(),M=y("input"),H=G(),B(q.$$.fragment),K=G(),D=y("dialog"),Q=y("h3"),B(Y.$$.fragment),Z=G(),E.c(),V=G(),T&&T.c(),g=G(),B(O.$$.fragment),w(b,"type","text"),b.disabled=l[3],w(b,"class","svelte-6zlkam"),w(M,"type","submit"),M.value="Submit",M.disabled=l[3],w(_,"class","svelte-6zlkam"),w(r,"class","answer svelte-6zlkam"),w(Q,"class","svelte-6zlkam"),D.open=l[2],w(D,"class","svelte-6zlkam")},m(a,h){z(a,e,h),S(e,t),S(e,i),S(e,o),z(a,u,h),F(f,a,h),z(a,d,h),z(a,r,h),S(r,m),S(m,_),S(_,p),S(_,C),S(_,b),ze(b,l[1]),S(_,I),S(_,M),z(a,H,h),F(q,a,h),z(a,K,h),z(a,D,h),S(D,Q),F(Y,Q,null),S(D,Z),E.m(D,null),z(a,V,h),T&&T.m(a,h),z(a,g,h),F(O,a,h),W=!0,ae||(ce=[X(b,"input",l[11]),X(m,"submit",We(l[12]))],ae=!0)},p(a,h){(!W||h&64)&&n!==(n=a[6].adventure.name+"")&&te(t,n),(!W||h&64)&&s!==(s=a[6].title+"")&&te(o,s);const $={};h&1&&($.gameCode=a[0].code),h&64&&($.storageSlug=a[6].storage_slug),h&64&&($.content=a[6].content),f.$set($),(!W||h&8)&&(b.disabled=a[3]),h&2&&b.value!==a[1]&&ze(b,a[1]),(!W||h&8)&&(M.disabled=a[3]);const ue={};!j&&h&1&&(j=!0,ue.gameCode=a[0].code,ke(()=>j=!1)),!c&&h&1&&(c=!0,ue.puzzleId=a[0].puzzle,ke(()=>c=!1)),q.$set(ue),x===(x=me(a))&&E?E.p(a,h):(E.d(1),E=x(a),E&&(E.c(),E.m(D,null))),(!W||h&4)&&(D.open=a[2]),a[2]?T?h&4&&R(T,1):(T=Ie(),T.c(),R(T,1),T.m(g.parentNode,g)):T&&(Te(),N(T,1,1,()=>{T=null}),qe());const de={};h&33554496&&(de.$$scope={dirty:h,ctx:a}),O.$set(de)},i(a){W||(R(f.$$.fragment,a),R(q.$$.fragment,a),R(Y.$$.fragment,a),R(T),R(O.$$.fragment,a),W=!0)},o(a){N(f.$$.fragment,a),N(q.$$.fragment,a),N(Y.$$.fragment,a),N(T),N(O.$$.fragment,a),W=!1},d(a){a&&k(e),a&&k(u),L(f,a),a&&k(d),a&&k(r),a&&k(H),l[15](null),L(q,a),a&&k(K),a&&k(D),L(Y),E.d(),a&&k(V),T&&T.d(a),a&&k(g),L(O,a),ae=!1,Ye(ce)}}}function ut(l){let e,n;return e=new Ge({}),{c(){B(e.$$.fragment)},m(t,i){F(e,t,i),n=!0},p:A,i(t){n||(R(e.$$.fragment,t),n=!0)},o(t){N(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function ft(l){let e,n,t,i,s;return{c(){e=y("p"),e.textContent="You have completed the adventure!",n=G(),t=y("button"),t.textContent="Continue \xBB",w(e,"class","svelte-6zlkam"),w(t,"class","svelte-6zlkam")},m(o,u){z(o,e,u),z(o,n,u),z(o,t,u),i||(s=X(t,"click",l[17]),i=!0)},p:A,d(o){o&&k(e),o&&k(n),o&&k(t),i=!1,s()}}}function ct(l){let e,n,t,i,s;return{c(){e=y("p"),e.textContent="You have completed this step in the adventure!",n=G(),t=y("button"),t.textContent="Next puzzle \xBB",w(e,"class","svelte-6zlkam"),w(t,"class","svelte-6zlkam")},m(o,u){z(o,e,u),z(o,n,u),z(o,t,u),i||(s=X(t,"click",l[16]),i=!0)},p:A,d(o){o&&k(e),o&&k(n),o&&k(t),i=!1,s()}}}function Ie(l){let e,n,t;return n=new Xe({props:{x:[-5,5],y:[0,.1],delay:[0,2e3],infinite:!0,duration:"5000",amount:"400",fallDistance:"110vh"}}),{c(){e=y("div"),B(n.$$.fragment),w(e,"class","confetti-bg svelte-6zlkam")},m(i,s){z(i,e,s),F(n,e,null),t=!0},i(i){t||(R(n.$$.fragment,i),t=!0)},o(i){N(n.$$.fragment,i),t=!1},d(i){i&&k(e),L(n)}}}function mt(l){let e,n;return e=new Ue({props:{data:l[6]}}),{c(){B(e.$$.fragment)},m(t,i){F(e,t,i),n=!0},p(t,i){const s={};i&64&&(s.data=t[6]),e.$set(s)},i(t){n||(R(e.$$.fragment,t),n=!0)},o(t){N(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function dt(l){let e,n,t,i;const s=[ut,rt],o=[];function u(f,d){return f[4]?0:1}return e=u(l),n=o[e]=s[e](l),{c(){n.c(),t=se()},m(f,d){o[e].m(f,d),z(f,t,d),i=!0},p(f,[d]){let r=e;e=u(f),e===r?o[e].p(f,d):(Te(),N(o[r],1,1,()=>{o[r]=null}),qe(),n=o[e],n?n.p(f,d):(n=o[e]=s[e](f),n.c()),R(n,1),n.m(t.parentNode,t))},i(f){i||(R(n),i=!0)},o(f){N(n),i=!1},d(f){o[e].d(f),f&&k(t)}}}function _t(l,e,n){let{params:t={}}=e,i={},s="",o=!1,u=!1,f=!0,d=null,r=null,m;ge.set("Puzzad: Loading...");const _=()=>{try{p(),ne(t.code).then(g=>(r=g,g.from("puzzles").select("title, content, next, storage_slug, adventure (name)").eq("id",t.puzzle))).then(C).then(g=>n(6,i=g)).then(()=>{ge.set("Puzzad: "+i.adventure.name+" :"+i.title),b(),n(4,f=!1)}).catch(()=>ee("/game/"+t.code))}catch{ee("/game/"+t.code)}},p=()=>{console.log("Resetting..."),n(4,f=!0),n(2,o=!1),n(1,s=""),n(3,u=!1)},C=({data:g,error:O})=>{if(O)throw O;if(g.length===0)throw"Puzzle not found";return g[0]};Fe(function(){d&&d.disconnect()});const b=async function(){d||(d=await Le(t.code),await d.channel("public:guesses:game=eq."+t.code).on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:"game=eq."+t.code},I).subscribe())},I=function(g){g.record.puzzle.toString()===t.puzzle&&(g.record.content==="*hint"?m.refresh():g.record.correct?n(2,o=!0):je.add({title:"Incorrect guess",description:g.record.content,duration:1e4,type:"error"}))},M=async function(){n(3,u=!0),await r.from("guesses").insert({content:s,puzzle:t.puzzle,game:t.code}),n(3,u=!1),n(1,s="")},H=async function(){await ee("/game/"+t.code+"/"+i.next)},q=async function(){await ee("/game/"+t.code)},j=["Congratulations!","Well done!","You did it!","Huzzah!","Good job!","Nice work!"];function c(){s=this.value,n(1,s)}const K=()=>M();function D(g){l.$$.not_equal(t.code,g)&&(t.code=g,n(0,t))}function Q(g){l.$$.not_equal(t.puzzle,g)&&(t.puzzle=g,n(0,t))}function Y(g){fe[g?"unshift":"push"](()=>{m=g,n(5,m)})}const Z=()=>H(),V=()=>q();return l.$$set=g=>{"params"in g&&n(0,t=g.params)},l.$$.update=()=>{l.$$.dirty&1&&t.code&&t.puzzle&&_()},[t,s,o,u,f,m,i,M,H,q,j,c,K,D,Q,Y,Z,V]}class pt extends le{constructor(e){super(),ie(this,e,_t,dt,oe,{params:0})}}export{pt as default};
