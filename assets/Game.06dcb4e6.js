import{S as B,i as H,s as R,e as G,a as p,g as O,t as S,c as U,b as q,d,o as V,D as X,B as L,h as b,j as T,q as I,r as z,w as v,n as h,x as E,y as A,l as F,m as J,p as K,C as Y,z as M,A as Q,k as W}from"./index.bf5e7580.js";import{S as Z}from"./Spinner.ced1c203.js";function N(i,e,l){const t=i.slice();return t[12]=e[l],t}function $(i){let e,l,t,f,a,n;function r(u,_){if(u[1].status==="EXPIRED")return ne;if(u[1].status==="PAID")return le;if(u[1].status==="ACTIVE")return te}let s=r(i),o=s&&s(i);return{c(){e=b("h1"),l=b("img"),a=T(),o&&o.c(),n=G(),I(l.src,t=i[1].adventures.promoLogo)||z(l,"src",t),z(l,"alt",f=i[1].adventures.name)},m(u,_){p(u,e,_),v(e,l),p(u,a,_),o&&o.m(u,_),p(u,n,_)},p(u,_){_&2&&!I(l.src,t=u[1].adventures.promoLogo)&&z(l,"src",t),_&2&&f!==(f=u[1].adventures.name)&&z(l,"alt",f),s===(s=r(u))&&o?o.p(u,_):(o&&o.d(1),o=s&&s(u),o&&(o.c(),o.m(n.parentNode,n)))},i:h,o:h,d(u){u&&d(e),u&&d(a),o&&o.d(u),u&&d(n)}}}function x(i){let e,l,t,f;return{c(){e=b("h1"),e.textContent="Error finding game",l=T(),t=b("p"),f=E(i[4])},m(a,n){p(a,e,n),p(a,l,n),p(a,t,n),v(t,f)},p(a,n){n&16&&A(f,a[4])},i:h,o:h,d(a){a&&d(e),a&&d(l),a&&d(t)}}}function ee(i){let e,l;return e=new Z({}),{c(){F(e.$$.fragment)},m(t,f){J(e,t,f),l=!0},p:h,i(t){l||(q(e.$$.fragment,t),l=!0)},o(t){S(e.$$.fragment,t),l=!1},d(t){K(e,t)}}}function te(i){let e,l,t,f,a;return{c(){e=b("p"),e.textContent="This adventure is already in progress!",l=T(),t=b("button"),t.textContent="Go to the current puzzle",z(t,"class","svelte-11i0xjd")},m(n,r){p(n,e,r),p(n,l,r),p(n,t,r),f||(a=Y(t,"click",i[9]),f=!0)},p:h,d(n){n&&d(e),n&&d(l),n&&d(t),f=!1,a()}}}function le(i){let e,l,t,f=i[0].code+"",a,n,r,s,o,u,_;return{c(){e=b("p"),e.textContent=`You've not yet started your adventure! Remember, it's dangerous to go alone.
            Take this if you want to recruit others to help you:`,l=T(),t=b("code"),a=E(f),n=T(),r=b("p"),r.textContent="Once you're ready, press below to go to the first puzzle in the adventure!",s=T(),o=b("button"),o.textContent="Begin the adventure!",z(t,"class","svelte-11i0xjd"),z(o,"class","svelte-11i0xjd")},m(c,m){p(c,e,m),p(c,l,m),p(c,t,m),v(t,a),p(c,n,m),p(c,r,m),p(c,s,m),p(c,o,m),u||(_=Y(o,"click",i[8]),u=!0)},p(c,m){m&1&&f!==(f=c[0].code+"")&&A(a,f)},d(c){c&&d(e),c&&d(l),c&&d(t),c&&d(n),c&&d(r),c&&d(s),c&&d(o),u=!1,_()}}}function ne(i){let e,l,t,f,a=i[7](i[1].startTime,i[1].endTime)+"",n,r,s,o,u,_={ctx:i,current:null,token:null,hasCatch:!1,pending:re,then:se,catch:oe,value:11};return M(u=i[3],_),{c(){e=b("p"),e.textContent="Congratulations! You finished the adventure!",l=T(),t=b("p"),f=E("You took "),n=E(a),r=E("!"),s=T(),o=G(),_.block.c()},m(c,m){p(c,e,m),p(c,l,m),p(c,t,m),v(t,f),v(t,n),v(t,r),p(c,s,m),p(c,o,m),_.block.m(c,_.anchor=m),_.mount=()=>o.parentNode,_.anchor=o},p(c,m){i=c,m&2&&a!==(a=i[7](i[1].startTime,i[1].endTime)+"")&&A(n,a),_.ctx=i,m&8&&u!==(u=i[3])&&M(u,_)||Q(_,i,m)},d(c){c&&d(e),c&&d(l),c&&d(t),c&&d(s),c&&d(o),_.block.d(c),_.token=null,_=null}}}function oe(i){return{c:h,m:h,p:h,d:h}}function se(i){let e,l,t,f,a=i[11],n=[];for(let r=0;r<a.length;r+=1)n[r]=P(N(i,a,r));return{c(){e=b("table"),l=b("thead"),l.innerHTML=`<tr><th>Puzzle</th> 
                    <th>Time</th> 
                    <th>Hints</th></tr>`,t=T(),f=b("tbody");for(let r=0;r<n.length;r+=1)n[r].c();z(e,"class","stats")},m(r,s){p(r,e,s),v(e,l),v(e,t),v(e,f);for(let o=0;o<n.length;o+=1)n[o].m(f,null)},p(r,s){if(s&8){a=r[11];let o;for(o=0;o<a.length;o+=1){const u=N(r,a,o);n[o]?n[o].p(u,s):(n[o]=P(u),n[o].c(),n[o].m(f,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=a.length}},d(r){r&&d(e),W(n,r)}}}function P(i){let e,l,t=i[12].title+"",f,a,n,r=i[12].time+"",s,o,u,_=i[12].hints+"",c,m;return{c(){e=b("tr"),l=b("td"),f=E(t),a=T(),n=b("td"),s=E(r),o=T(),u=b("td"),c=E(_),m=T(),z(n,"class","time")},m(k,C){p(k,e,C),v(e,l),v(l,f),v(e,a),v(e,n),v(n,s),v(e,o),v(e,u),v(u,c),v(e,m)},p(k,C){C&8&&t!==(t=k[12].title+"")&&A(f,t),C&8&&r!==(r=k[12].time+"")&&A(s,r),C&8&&_!==(_=k[12].hints+"")&&A(c,_)},d(k){k&&d(e)}}}function re(i){return{c:h,m:h,p:h,d:h}}function ie(i){let e,l,t,f;const a=[ee,x,$],n=[];function r(s,o){return s[2]?0:s[4]||!s[1]?1:2}return e=r(i),l=n[e]=a[e](i),{c(){l.c(),t=G()},m(s,o){n[e].m(s,o),p(s,t,o),f=!0},p(s,[o]){let u=e;e=r(s),e===u?n[e].p(s,o):(O(),S(n[u],1,1,()=>{n[u]=null}),U(),l=n[e],l?l.p(s,o):(l=n[e]=a[e](s),l.c()),q(l,1),l.m(t.parentNode,t))},i(s){f||(q(l),f=!0)},o(s){S(l),f=!1},d(s){n[e].d(s),s&&d(t)}}}function ae(i,e,l){let{params:t={}}=e,f={},a=!0,n,r,s;V(async function(){var g;try{s=await X(t.code)}catch(y){l(4,r=y.message||y),l(2,a=!1);return}let{data:k,error:C}=await s.from("games").select("status, puzzle, startTime, endTime, adventures ( name, promoLogo, description)").eq("code",t.code);(g=k[0])!=null&&g.adventures?(l(1,f=k[0]),l(3,n=s.rpc("getstats",{gamecode:t.code}).then(({data:y,error:w})=>w?[]:y).then(y=>{let w=f.startTime;return y.forEach(j=>{j.time=_(w,j.solvetime),w=j.solvetime}),y}))):C="Unable to find game",C&&l(4,r=C),l(2,a=!1)});const o=async function(){let{data:k}=await s.rpc("startadventure");k&&await L("/game/"+t.code+"/"+k)},u=async function(){await L("/game/"+t.code+"/"+f.puzzle)},_=function(k,C){const g=(new Date(C).getTime()-new Date(k).getTime())/1e3,y=(w,j)=>{const D=Math.floor(w);return D===1?`${D} ${j}`:D>1?`${D} ${j}s`:""};return[y(g%60,"second"),y(g/60%60,"minute"),y(g/3600%24,"hour"),y(g/86400,"day")].filter(w=>w!=="").reverse().join(", ")},c=()=>o(),m=()=>u();return i.$$set=k=>{"params"in k&&l(0,t=k.params)},[t,f,a,n,r,o,u,_,c,m]}class ce extends B{constructor(e){super(),H(this,e,ae,ie,R,{params:0})}}export{ce as default};
