import{S as C,i as L,s as A,z as g,e as v,a as f,A as S,b as $,t as q,d as p,f as b,B,h as d,x as h,v as H,w as k,n as s,j as y,q as M,r as w,l as N,m as T,p as j,C as z}from"./index.3efb1999.js";import{S as I}from"./Spinner.21e44d2e.js";function Y(r){let e,l=r[6].message+"",t;return{c(){e=d("p"),t=h(l),H(e,"color","red")},m(a,n){f(a,e,n),k(e,t)},p:s,i:s,o:s,d(a){a&&p(e)}}}function D(r){let e,l,t,a,n,u=r[2].description+"",m,o,c={ctx:r,current:null,token:null,hasCatch:!1,pending:K,then:F,catch:E,value:5};return g(r[0],c),{c(){e=d("h2"),l=d("img"),a=y(),n=d("section"),m=y(),o=v(),c.block.c(),M(l.src,t=r[2].promoLogo)||w(l,"src",t),w(l,"alt",r[2].name)},m(i,_){f(i,e,_),k(e,l),f(i,a,_),f(i,n,_),n.innerHTML=u,f(i,m,_),f(i,o,_),c.block.m(i,c.anchor=_),c.mount=()=>o.parentNode,c.anchor=o},p(i,_){r=i,S(c,r,_)},i:s,o:s,d(i){i&&p(e),i&&p(a),i&&p(n),i&&p(m),i&&p(o),c.block.d(i),c.token=null,c=null}}}function E(r){return{c:s,m:s,p:s,d:s}}function F(r){let e;function l(n,u){return n[5]?J:G}let a=l(r)(r);return{c(){a.c(),e=v()},m(n,u){a.m(n,u),f(n,e,u)},p(n,u){a.p(n,u)},d(n){a.d(n),n&&p(e)}}}function G(r){let e;return{c(){e=d("p"),e.innerHTML='You must <a href="/#/login">login</a> before you can start an adventure.'},m(l,t){f(l,e,t)},p:s,d(l){l&&p(e)}}}function J(r){let e,l,t=r[2].price===0?"free":"\xA3"+r[2].price,a,n,u;function m(){return r[4](r[2])}return{c(){e=d("button"),l=h("Start this adventure for "),a=h(t)},m(o,c){f(o,e,c),k(e,l),k(e,a),n||(u=z(e,"click",m),n=!0)},p(o,c){r=o},d(o){o&&p(e),n=!1,u()}}}function K(r){return{c:s,m:s,p:s,d:s}}function O(r){let e,l;return e=new I({}),{c(){N(e.$$.fragment)},m(t,a){T(e,t,a),l=!0},p:s,i(t){l||($(e.$$.fragment,t),l=!0)},o(t){q(e.$$.fragment,t),l=!1},d(t){j(e,t)}}}function P(r){let e,l,t={ctx:r,current:null,token:null,hasCatch:!0,pending:O,then:D,catch:Y,value:2,error:6,blocks:[,,,]};return g(r[2],t),{c(){e=v(),t.block.c()},m(a,n){f(a,e,n),t.block.m(a,t.anchor=n),t.mount=()=>e.parentNode,t.anchor=e,l=!0},p(a,[n]){r=a,S(t,r,n)},i(a){l||($(t.block),l=!0)},o(a){for(let n=0;n<3;n+=1){const u=t.blocks[n];q(u)}l=!1},d(a){a&&p(e),t.block.d(a),t.token=null,t=null}}}function Q(r,e,l){let{params:t={}}=e,a=b.from("adventures").select("id,name,description,promoBackground,promoLogo,price").eq("name",t.name).then(({data:o,error:c})=>{if(c)throw c;return o[0]}),n=b.auth.getSession().then(({data:{session:o}})=>!!(o!=null&&o.user));const u=async o=>{if(o.price===0){let{data:c,error:i}=await b.rpc("addfreeadventure",{adventureid:o.id});c&&await B("/game/"+c)}},m=o=>u(o);return r.$$set=o=>{"params"in o&&l(3,t=o.params)},[n,u,a,t,m]}class V extends C{constructor(e){super(),L(this,e,Q,P,A,{params:3})}}export{V as default};
